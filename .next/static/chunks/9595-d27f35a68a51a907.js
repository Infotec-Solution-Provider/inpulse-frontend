"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9595],{7191:(e,t,s)=>{s.d(t,{A:()=>n});var l=s(95155),a=s(70892);function n(e){let{text:t}=e;return(0,l.jsx)(a.A,{options:{defaultProtocol:"https",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline break-words"},children:t})}},17245:(e,t,s)=>{s.d(t,{A:()=>a});var l=s(42732);function a(e,t,s,a,n){var r,i,o,c;if(!e)return null;let d=null;if(null==e?void 0:null===(r=e.from)||void 0===r?void 0:r.startsWith("user:")){let t=+e.from.split(":")[1],l=s.find(e=>e.CODIGO===t);d=l?l.NOME:null}else if(null==e?void 0:null===(i=e.from)||void 0===i?void 0:i.startsWith("external:")){let t=e.from.split(":"),l=(3===t.length?t[2]:t[1]).split("@")[0].replace(/\D/g,""),a=s.find(e=>e.WHATSAPP===l),r=null==n?void 0:n.get(l);d=a?a.NOME:r||l}if(a&&"contactId"in e){let e=null===(o=a.contact)||void 0===o?void 0:o.phone;d=(null===(c=a.contact)||void 0===c?void 0:c.name)||(e?l.Formatter.phone(e):"N/D")}return{id:e.id,style:t,text:e.body,fileId:e.fileId,fileName:e.fileName,fileType:e.fileType,author:d||e.from}}},25232:(e,t,s)=>{s.d(t,{A:()=>l});let l=new(s(54607)).FilesClient("http://localhost:8003")},39447:(e,t,s)=>{s.d(t,{U:()=>c,A:()=>d});var l=s(95155),a=s(12115),n=s(88702);function r(e,t){let s=!1,l=!1;switch(t.type){case"change-text":return{...e,text:t.text};case"add-emoji":return{...e,text:e.text+t.emoji};case"attach-file":return{sendAsAudio:l,sendAsDocument:s=!["video","image"].some(e=>t.file.type.includes(e)),text:e.text,file:t.file,isEmojiMenuOpen:!1};case"attach-file-id":return{sendAsAudio:l,sendAsDocument:s,text:e.text,fileId:t.fileId,isEmojiMenuOpen:!1};case"set-audio":return{sendAsAudio:l=!0,sendAsDocument:s,text:e.text,file:t.file,isEmojiMenuOpen:!1};case"remove-file":return{sendAsAudio:l,sendAsDocument:s,text:e.text,isEmojiMenuOpen:!1};case"toggle-emoji-menu":return{...e,isEmojiMenuOpen:!e.isEmojiMenuOpen};case"quote-message":return{...e,quotedId:t.id};case"set-mentions":return{...e,mentions:t.mentions};case"toggle-forward-mode":return{...e,forwardMode:!e.forwardMode,selectedMessages:[]};case"select-message":var a;return{...e,selectedMessages:(null===(a=e.selectedMessages)||void 0===a?void 0:a.includes(t.messageId))?e.selectedMessages.filter(e=>e!==t.messageId):[...e.selectedMessages||[],t.messageId]};case"clear-forward":return{...e,forwardMode:!1,selectedMessages:[]};case"remove-quoted-message":return delete e.quotedId,e;default:return{...e,text:"",file:void 0,fileId:void 0,sendAsAudio:!1,sendAsDocument:!1,isEmojiMenuOpen:!1}}}var i=s(40931);let o={text:"",sendAsAudio:!1,sendAsDocument:!1,isEmojiMenuOpen:!1,forwardMode:!1,selectedMessages:[]},c=(0,a.createContext)({});function d(e){let{children:t}=e,{sendMessage:s,currentChat:d,messages:u}=(0,a.useContext)(n.ce),{sendInternalMessage:x,messages:m}=(0,a.useContext)(i.xI),[h,p]=(0,a.useReducer)(r,o),[f,g]=(0,a.useState)(null),j=(0,a.useCallback)(function(e,t){var s,l;let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return a?(null===(l=m[e])||void 0===l?void 0:l.find(e=>e.id===t))||null:(null===(s=u[e])||void 0===s?void 0:s.find(e=>e.id===t))||null},[u,m]),v=(0,a.useCallback)(e=>{g(e),p({type:"quote-message",id:e.id})},[p]),b=(0,a.useCallback)(()=>{g(null),p({type:"remove-quoted-message"})},[p]);return(0,a.useEffect)(()=>{p({type:"reset"})},[d]),(0,l.jsx)(c.Provider,{value:{state:h,quotedMessage:f,dispatch:p,sendMessage:()=>{if(d&&"wpp"===d.chatType&&d.contact)try{console.log("Enviando mensagem:",h.file),s(d.contact.phone,{...h,contactId:d.contact.id,chatId:d.id,file:h.file})}catch(e){console.error("Erro inesperado ao chamar sendMessage",e)}d&&"internal"===d.chatType&&x({chatId:d.id,text:h.text,sendAsAudio:h.sendAsAudio,sendAsDocument:h.sendAsDocument,quotedId:h.quotedId,file:h.file,fileId:h.fileId,mentions:h.mentions}),p({type:"reset"})},getMessageById:j,handleQuoteMessage:v,handleQuoteMessageRemove:b},children:t})}},58053:(e,t,s)=>{s.d(t,{A:()=>g});var l=s(95155),a=s(25232),n=s(12115),r=s(40510),i=s(92697),o=s(68534),c=s(5087),d=s(76380),u=s(3127),x=s(70006),m=s(30255),h=s(69242),p=s(10521);let f=[50,75,100,125,150,200,300];function g(e){let{fileName:t,fileType:s,fileSize:g,fileId:j}=e,{closeModal:v,openModal:b}=(0,n.useContext)(i.BR),A=()=>{let e=a.A.getFileDownloadUrl(j);b((0,l.jsx)(y,{url:e,alt:t,onClose:v}))};function y(e){let{url:t,alt:s,onClose:a}=e,[r,i]=(0,n.useState)(1),[g,j]=(0,n.useState)({x:0,y:0}),v=(0,n.useRef)(null),b=(0,n.useRef)(null),[A,y]=(0,n.useState)(null),N=Math.round(100*r),w=e=>{if(!v.current)return;e.preventDefault();let t=e.clientX-v.current.x,s=e.clientY-v.current.y;j(e=>({x:e.x+t,y:e.y+s})),v.current={x:e.clientX,y:e.clientY}},C=e=>{v.current=null,window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",C)},k=e=>{i(e/100),j({x:0,y:0}),y(null)};return(0,l.jsxs)("div",{className:"fixed inset-0 flex flex-col bg-black bg-opacity-90 text-white z-50 items-center justify-center p-4",style:{userSelect:"none"},children:[(0,l.jsxs)("header",{className:"w-full max-w-[95vw] flex justify-between items-center mb-2",children:[(0,l.jsxs)(o.A,{variant:"outlined",onClick:e=>{y(e.currentTarget)},sx:{color:"white",borderColor:"white",minWidth:70,fontWeight:"bold"},children:[N,"%"]}),(0,l.jsx)(c.A,{anchorEl:A,open:!!A,onClose:()=>{y(null)},PaperProps:{style:{backgroundColor:"#222",color:"white",minWidth:80}},children:f.map(e=>(0,l.jsxs)(d.A,{selected:e===N,onClick:()=>k(e),sx:{"&.Mui-selected":{backgroundColor:"rgba(255,255,255,0.2)"}},children:[e,"%"]},e))}),(0,l.jsx)(u.A,{onClick:a,sx:{color:"white"},children:(0,l.jsx)(h.A,{})})]}),(0,l.jsxs)("div",{ref:b,onWheel:e=>{e.preventDefault();let t=-e.deltaY/500;i(s=>{let l=Math.min(3,Math.max(.5,s+t));if(l!==s&&b.current){let t=b.current.getBoundingClientRect(),a=e.clientX-t.left-t.width/2-g.x,n=e.clientY-t.top-t.height/2-g.y;j(e=>({x:e.x-a*(l/s-1),y:e.y-n*(l/s-1)}))}return l})},onMouseDown:e=>{1!==r&&(e.preventDefault(),v.current={x:e.clientX,y:e.clientY},window.addEventListener("mousemove",w),window.addEventListener("mouseup",C))},className:"relative bg-black rounded max-w-[95vw] max-h-[85vh] overflow-hidden flex justify-center items-center cursor-grab",style:{flexGrow:1,width:"100%"},children:[(0,l.jsx)("img",{src:t,alt:s,draggable:!1,style:{transform:"translate(".concat(g.x,"px, ").concat(g.y,"px) scale(").concat(r,")"),transition:"transform 0.1s ease-out",maxWidth:"100%",maxHeight:"85vh",objectFit:"contain",cursor:1===r?"zoom-in":"grab",userSelect:"none"}}),(0,l.jsxs)("div",{className:"absolute bottom-3 right-3 flex items-center gap-2 bg-black bg-opacity-60 rounded p-1",style:{userSelect:"none"},children:[(0,l.jsx)(u.A,{onClick:()=>i(e=>Math.min(e+.25,3)),sx:{color:"white",bgcolor:"transparent",borderRadius:1,padding:0,"&:hover":{bgcolor:"rgba(255, 255, 255, 0.2)"}},"aria-label":"Zoom In",size:"small",children:(0,l.jsx)(x.A,{})}),(0,l.jsx)(u.A,{onClick:()=>i(e=>Math.max(e-.25,.5)),sx:{color:"white",bgcolor:"transparent",borderRadius:1,padding:0,"&:hover":{bgcolor:"rgba(255, 255, 255, 0.2)"}},"aria-label":"Zoom Out",size:"small",children:(0,l.jsx)(m.A,{})}),(0,l.jsx)(u.A,{onClick:()=>{i(1),j({x:0,y:0})},sx:{color:"white",width:36,height:36,borderRadius:1,padding:0,bgcolor:"transparent","&:hover":{bgcolor:"rgba(255, 255, 255, 0.2)"}},"aria-label":"Reset Zoom",size:"small",children:(0,l.jsx)(p.A,{fontSize:"small"})})]})]})]})}let N=(0,n.useMemo)(()=>{let e=a.A.getFileDownloadUrl(j);return s.includes("image")?(0,l.jsx)("img",{src:e,alt:t,className:"max-h-[20rem] max-w-[40rem] cursor-zoom-in sm:max-w-[100%] sm:max-h-[15rem]",onClick:A}):s.includes("video")?(0,l.jsx)("video",{controls:!0,className:"max-h-[15rem] max-w-[40rem] sm:max-w-full sm:max-h-[10rem] object-contain",children:(0,l.jsx)("source",{src:e,type:s})}):s.includes("audio")?(0,l.jsx)("audio",{controls:!0,children:(0,l.jsx)("source",{src:e,type:s})}):(0,l.jsxs)("a",{href:e,target:"_blank",rel:"noreferrer",className:"flex h-16 w-52 items-center justify-center gap-2 hover:text-indigo-500",children:[(0,l.jsx)(r.A,{}),(0,l.jsxs)("p",{children:[" (",(()=>{let e=parseInt(g,10);return e<1024?"".concat(e," B"):e<1048576?"".concat((e/1024).toFixed(2)," KB"):"".concat((e/1048576).toFixed(2)," MB")})(),")"]})]})},[j,t,s,g]);return(0,l.jsx)("div",{children:N})}},63699:(e,t,s)=>{s.d(t,{A:()=>m});var l=s(95155),a=s(12115),n=s(58053),r=s(69926),i=s(33613),o=s(3127),c=s(5087),d=s(76380),u=s(69008),x=s(7191);function m(e){let{id:t,style:s,text:m,date:h,status:p,fileId:f,fileName:g,fileType:j,fileSize:v,groupFirst:b,sentBy:A,quotedMessage:y,onQuote:N,mentionNameMap:w,isForwardMode:C,isSelected:k,onSelect:E,onForward:I,onCopy:M,styleWrapper:O}=e,[R,S]=(0,a.useState)(null),D=()=>{S(null)},T=()=>{let e=y?"".concat(y.author||"",": ").concat(y.text,"\n\n").concat(m):m;M?M():navigator.clipboard.writeText(e)},z=m.replace(/@(\d{8,15})/g,(e,t)=>{let s=t.replace(/\D/g,""),l=null==w?void 0:w.get(s);return l?"@".concat(l):"@".concat(t)});return(0,l.jsxs)("li",{id:String(t),style:O,className:"w-full ".concat(r.bj[s]," group flex items-center gap-2 relative"),children:[C&&(0,l.jsx)(i.A,{checked:k,onChange:()=>{E&&E(t)},className:"absolute left-[-12px]"}),(0,l.jsx)("div",{className:"flex flex-col items-center gap-2 p-2 ".concat(r.VU[s]," w-max max-w-[66%] rounded-md"),children:(0,l.jsxs)("div",{className:"flex w-full flex-col gap-1",children:[y&&(0,l.jsxs)("div",{className:"flex w-full flex-col gap-1 rounded-lg mt-2 border-l-2 bg-white/20 dark:bg-slate-300/40 p-2 ".concat("sent"===y.style?"border-indigo-600":"border-orange-600"),children:[(0,l.jsx)("h2",{children:"sent"===y.style?"Voc\xea":y.author||""}),(0,l.jsx)("div",{className:"w-full h-full text-black dark:text-slate-200 p-4 rounded-md",children:y.text.split("\n").map((e,t)=>(0,l.jsx)("p",{className:"max-w-[100%] break-words text-sm",children:(0,l.jsx)(x.A,{text:e})},t))}),y.fileId&&(0,l.jsx)(n.A,{fileId:y.fileId,fileName:y.fileName||"",fileType:y.fileType||"",fileSize:v||""})]}),b&&(0,l.jsx)("h2",{className:"text-xs font-bold text-indigo-300",children:A}),f&&(0,l.jsx)(n.A,{fileId:f,fileName:g||"",fileType:j||"",fileSize:v||""}),(0,l.jsx)("div",{className:"w-full text-slate-900 dark:text-slate-200",children:z.split("\n").map((e,t)=>(0,l.jsx)("p",{className:"max-w-[100%] break-words text-sm",children:(0,l.jsx)(x.A,{text:e})},t))}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:["system"!==s&&p&&r.tn[p],(0,l.jsx)("p",{className:"text-xs text-slate-900 dark:text-slate-200",children:h.toLocaleString()})]})]})}),!C&&"system"!==s&&(0,l.jsxs)("div",{className:"invisible group-hover:visible",children:[(0,l.jsx)(o.A,{size:"small",color:"default",title:"Mais op\xe7\xf5es",onClick:e=>{S(e.currentTarget)},children:(0,l.jsx)(u.A,{})}),(0,l.jsxs)(c.A,{anchorEl:R,open:!!R,onClose:D,children:[(0,l.jsx)(d.A,{onClick:()=>{D(),null==N||N()},children:"Responder"}),(0,l.jsx)(d.A,{onClick:()=>{D(),T()},children:"Copiar"})]})]})]})}},67840:(e,t,s)=>{s.d(t,{A:()=>x});var l=s(95155),a=s(3127),n=s(73731),r=s(76380),i=s(68534),o=s(69242),c=s(12115),d=s(92697),u=s(88702);function x(){let{closeModal:e}=(0,c.useContext)(d.BR),{finishChat:t,currentChat:s,wppApi:x}=(0,c.useContext)(u.ce),[m,h]=(0,c.useState)(null),[p,f]=(0,c.useState)([]);return(0,c.useEffect)(()=>{x.current.getResults().then(e=>{f(e.filter(e=>""!==e.name.trim()))})},[]),(0,l.jsxs)("div",{className:"w-[26rem] rounded-md bg-white text-gray-800 px-4 py-4 dark:bg-slate-800 dark:text-white",children:[(0,l.jsxs)("header",{className:"flex items-center justify-between pb-8",children:[(0,l.jsx)("h1",{className:"text-xl",children:"Finalizar conversa"}),(0,l.jsx)(a.A,{onClick:e,children:(0,l.jsx)(o.A,{})})]}),(0,l.jsxs)("form",{className:"flex flex-col gap-6",children:[(0,l.jsx)(n.A,{select:!0,label:"Resultado",required:!0,onChange:e=>{let t=e.target.value;h(t?parseInt(t):null)},defaultValue:1,className:"!text-sm",slotProps:{select:{maxRows:5,MenuProps:{PaperProps:{className:"!text-xsm max-w-[12rem] scrollbar-whatsapp",sx:{maxHeight:"20rem"}}}}},children:p.map(e=>(0,l.jsx)(r.A,{value:e.id,children:e.name},"result_".concat(e.id)))}),(0,l.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,l.jsx)(i.A,{type:"button",variant:"contained",color:"secondary",className:"w-32",onClick:e,children:"Cancelar"}),(0,l.jsx)(i.A,{type:"button",variant:"contained",color:"primary",className:"w-32",onClick:()=>{s&&m&&(t(s.id,m),e())},disabled:!m,children:"Finalizar"})]})]})]})}},69926:(e,t,s)=>{s.d(t,{Ay:()=>g,VU:()=>h,bj:()=>p,tn:()=>f});var l=s(95155),a=s(45129),n=s(50398),r=s(43289),i=s(44398),o=s(84752),c=s(19505),d=s(58053),u=s(3127),x=s(32730),m=s(7191);let h={received:"bg-slate-50 text-slate-800 dark:bg-slate-800 dark:text-slate-200 rounded-bl-none",sent:"bg-green-200 text-slate-800 dark:bg-green-800 dark:text-slate-200 rounded-br-none",system:"bg-yellow-200 text-slate-800 dark:bg-yellow-800 dark:text-white"},p={received:"flex-row",sent:"flex-row-reverse",system:"flex-row justify-center"},f={PENDING:(0,l.jsx)(a.A,{className:"text-slate-300"}),SENT:(0,l.jsx)(n.A,{className:"text-slate-300"}),RECEIVED:(0,l.jsx)(r.A,{className:"text-slate-300"}),READ:(0,l.jsx)(r.A,{className:"text-blue-300"}),DOWNLOADED:(0,l.jsx)(i.A,{className:"text-blue-300"}),ERROR:(0,l.jsx)(o.A,{className:"text-red-300"}),REVOKED:(0,l.jsx)(c.A,{className:"text-slate-300"})};function g(e){let{id:t,style:s,text:a,date:n,status:r,fileId:i,fileName:o,fileType:c,fileSize:g,quotedMessage:j,onQuote:v}=e;return(0,l.jsxs)("li",{id:String(t),className:"w-full ".concat(p[s]," group flex items-center gap-2"),children:[(0,l.jsxs)("div",{className:"flex flex-col items-center gap-2 p-2 ".concat(h[s]," w-max max-w-[66%] rounded-md"),children:[j&&(0,l.jsxs)("div",{className:"mt-2 flex w-full flex-col gap-1 rounded-lg border-l-2 bg-white/20 p-2 dark:bg-slate-300/40 ".concat("sent"===j.style?"border-indigo-600 dark:border-indigo-400":"border-orange-600 dark:border-orange-400"),onClick:()=>{let e=document.getElementById(String(j.id));e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("bg-indigo-500/5"),setTimeout(()=>{null==e||e.classList.remove("bg-indigo-500/5")},2e3))},children:[(0,l.jsx)("h2",{className:"".concat("sent"===j.style?"text-indigo-400 dark:text-indigo-600":"text-orange-400 dark:text-orange-600"),children:"sent"===j.style?"Voc\xea":j.author||""}),(0,l.jsx)("div",{className:"h-full w-full rounded-md p-4 text-black dark:text-slate-200",children:j.text.split("\n").map((e,t)=>(0,l.jsx)("p",{className:"max-w-[100%] break-words text-sm",children:(0,l.jsx)(m.A,{text:e})},t))}),j.fileId&&(0,l.jsx)(d.A,{fileId:j.fileId,fileName:j.fileName||"",fileType:j.fileType||"",fileSize:g||""})]}),(0,l.jsxs)("div",{className:"flex w-full flex-col gap-1",children:[i&&(0,l.jsx)(d.A,{fileId:i,fileName:o||"",fileType:c||"",fileSize:g||""}),(0,l.jsx)("div",{className:"w-full text-slate-900 dark:text-slate-200",children:a.split("\n").map((e,t)=>(0,l.jsx)("p",{className:"max-w-[100%] break-words text-sm",children:(0,l.jsx)(m.A,{text:e})},t))}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:["system"!==s&&r&&f[r],(0,l.jsx)("p",{className:"text-xs text-slate-900 dark:text-slate-200",children:n.toLocaleString()})]})]})]}),"system"!==s&&(0,l.jsx)(u.A,{className:"invisible group-hover:visible",size:"small",color:"primary",title:"Responder",onClick:v,children:(0,l.jsx)(x.A,{})})]})}},70266:(e,t,s)=>{s.d(t,{A:()=>P});var l=s(95155),a=s(12115),n=s(3127),r=s(73731),i=s(16460),o=s(60440),c=s(60398),d=s(3337),u=s(25816),x=s(69242),m=s(44996),h=s(88702),p=s(39447),f=s(98892),g=s(49617),j=s(26854);let v=e=>{let t=Math.floor(e/60);return"".concat(String(t).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0"))};function b(e){let{onAudioRecorded:t}=e,[s,r]=(0,a.useState)(!1),i=(0,a.useRef)(null),o=(0,a.useRef)([]),c=(0,a.useRef)(null),[d,u]=(0,a.useState)(0),x=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(e);i.current=s,s.ondataavailable=e=>{o.current.push(e.data)},s.onstop=()=>{let e=new Blob(o.current,{type:"audio/mpeg"});if(o.current=[],t){let s=new File([e],"audio.mp3",{type:"audio/mpeg"});t(s)}},s.start(),r(!0),u(0),c.current=setInterval(()=>{u(e=>e+1)},1e3)}catch(e){console.error("Erro ao acessar o microfone:",e)}};return(0,l.jsxs)("div",{className:"pr-2 flex items-center gap-2",children:[s?(0,l.jsx)(n.A,{color:"error",onClick:()=>{var e;null===(e=i.current)||void 0===e||e.stop(),r(!1)},size:"small",children:(0,l.jsx)(j.A,{})}):(0,l.jsx)(n.A,{color:"primary",onClick:x,size:"small",children:(0,l.jsx)(g.A,{})}),s&&(0,l.jsx)("span",{className:"text-sm text-slate-400",children:v(d)})]})}var A=s(38543),y=s(56278),N=s(54492),w=s(99927),C=s(63148),k=s(22376),E=s(85222),I=s(700),M=s(71977),O=s(68534),R=s(40931),S=s(78286);let D=e=>{var t,s,r,i,o;let{chat:c,onClose:d}=e,{readyMessages:u,replaceVariables:m,fetchReadyMessages:p}=(0,S.m)(),{user:g}=(0,a.useContext)(f.c),{sendMessage:j}=(0,a.useContext)(h.ce),{sendInternalMessage:v}=(0,a.useContext)(R.xI),[b,D]=(0,a.useState)(null),T={currentSaudation:(()=>{let e=new Date().getHours();return e>=5&&e<12?"Bom dia":e>=12&&e<18?"Boa tarde":"Boa noite"})(),operatorName:(null==g?void 0:g.NOME)||"",operatorNameExibition:(null==g?void 0:g.NOME_EXIBICAO)||(null==g?void 0:g.NOME)||""},z="chatType"in c?{customerCnpj:(null===(t=c.customer)||void 0===t?void 0:t.CPF_CNPJ)||"",customerFirstName:(null===(r=c.customer)||void 0===r?void 0:null===(s=r.FANTASIA)||void 0===s?void 0:s.split(" ")[0])||"",customerFullName:(null===(i=c.customer)||void 0===i?void 0:i.RAZAO)||"",customerRazao:(null===(o=c.customer)||void 0===o?void 0:o.RAZAO)||""}:{groupName:c.groupName||"",customerCnpj:"",customerFirstName:"",customerFullName:"",customerRazao:""},F=m({message:(null==b?void 0:b.TEXTO_MENSAGEM)||"",values:{...T,...z}}),P=async()=>{if(!b||!g){A.oR.error("Falha ao enviar mensagem");return}try{if("wpp"===c.chatType){var e,t,s;await j(null!==(t=null===(e=c.contact)||void 0===e?void 0:e.phone)&&void 0!==t?t:"",{chatId:c.id,contactId:null!==(s=c.contactId)&&void 0!==s?s:0,text:F,fileId:+b.ARQUIVO_CODIGO})}else await v({chatId:c.id,text:F,fileId:+b.ARQUIVO_CODIGO});A.oR.success("Mensagem enviada com sucesso!"),d()}catch(e){A.oR.error("Erro ao enviar mensagem")}};return(0,a.useEffect)(()=>{p()},[]),(0,l.jsxs)(y.A,{open:!0,onClose:d,fullWidth:!0,maxWidth:"sm",children:[(0,l.jsxs)(N.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Mensagens r\xe1pidas",(0,l.jsx)(n.A,{onClick:d,children:(0,l.jsx)(x.A,{})})]}),(0,l.jsx)(w.A,{dividers:!0,children:u&&u.length?(0,l.jsx)(C.A,{children:null==u?void 0:u.map(e=>(0,l.jsx)(k.A,{selected:(null==b?void 0:b.CODIGO)===e.CODIGO,onClick:()=>D(e),sx:{borderRadius:2,mb:1,border:(null==b?void 0:b.CODIGO)===e.CODIGO?"1px solid #1976d2":"1px solid transparent",backgroundColor:(null==b?void 0:b.CODIGO)===e.CODIGO?"rgba(25, 118, 210, 0.1)":"transparent",transition:"all 0.2s","&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)"}},children:(0,l.jsx)(E.A,{primary:(0,l.jsx)(I.A,{variant:"body2",color:"textPrimary",noWrap:!0,children:e.TEXTO_MENSAGEM})})},e.CODIGO))}):(0,l.jsx)(I.A,{variant:"body2",color:"textSecondary",children:"Nenhuma mensagem cadastrada."})}),(0,l.jsx)(M.A,{children:(0,l.jsx)(O.A,{onClick:P,disabled:!b,variant:"contained",color:"primary",children:"Enviar"})})]})};var T=s(74205),z=s(56204),F=s(42732);function P(){let{currentChat:e}=(0,a.useContext)(h.ce),{sendMessage:t,state:s,dispatch:g,quotedMessage:j,handleQuoteMessageRemove:v}=(0,a.useContext)(p.U),{user:A}=(0,a.useContext)(f.c),{users:y}=(0,a.useContext)(R.xI),{contacts:N}=(0,a.useContext)(z.Jj),w=(0,a.useRef)(null),C=(0,a.useRef)(null),k=!e,[E,I]=(0,a.useState)(!1),[M,O]=(0,a.useState)(!1),{textWithNames:S,setTextWithNames:P,handleTextChange:_,selectMention:G,mentionCandidates:B,showMentionList:q}=function(e){let{stateText:t,mentions:s,participants:l,users:n,contacts:r,dispatch:i}=e,[o,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),[x,m]=(0,a.useState)([]),[h,p]=(0,a.useState)(!1),f=(0,a.useMemo)(()=>{let e=new Map;for(let t of n)e.set(t.CODIGO,t);return e},[n]),g=(0,a.useMemo)(()=>{let e=new Map;for(let s of n){var t;let l=null===(t=s.WHATSAPP)||void 0===t?void 0:t.replace(/\D/g,"");l&&e.set(l,s)}return e},[n]),j=(0,a.useMemo)(()=>{let e=new Map;for(let s of r){var t;let l=null===(t=s.phone)||void 0===t?void 0:t.replace(/\D/g,"");l&&e.set(l,s.name)}return e},[r]);return(0,a.useEffect)(()=>{let e=t||"";s.forEach(t=>{e=e.split("@".concat(t.phone)).join("@".concat(t.name))}),c(e)},[t,s]),{textWithNames:o,setTextWithNames:c,mentionCandidates:x,showMentionList:h,handleTextChange:e=>{c(e);let t=e;s.forEach(e=>{let s=e.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=RegExp("@".concat(s),"g");t=t.replace(l,"@".concat(e.phone))}),i({type:"change-text",text:t});let a=e.match(/@(\w*)$/);a&&l.length>0?(u(a[1]),m(l.map(e=>{let t=String(e.userId);if(t.length>8){let e=t.replace(/\D/g,""),s=g.get(e);if(s)return{userId:Number(t),name:s.NOME,phone:e};let l=j.get(e);return{userId:Number(t),name:l||F.Formatter.phone(e),phone:e}}{let e=Number(t),s=f.get(e);return s?{userId:e,name:s.NOME,phone:s.WHATSAPP||""}:null}}).filter(e=>!!e)),p(!0)):(m([]),p(!1),u(""))},selectMention:(e,t,l)=>{let a=t.lastIndexOf("@".concat(d),l),n=t.substring(0,a),r=t.substring(l),o="".concat(n,"@").concat(e.name," ").concat(r);c(o);let x=o,m=[...s.filter(t=>t.userId!==e.userId),e];return m.forEach(e=>{let t=e.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=RegExp("@".concat(t),"g");x=x.replace(s,"@".concat(e.phone))}),i({type:"change-text",text:x}),i({type:"set-mentions",mentions:m}),u(""),p(!1),{newTextWithNames:o,cursorPosition:n.length+e.name.length+2}}}}({stateText:s.text,mentions:s.mentions||[],participants:(null==e?void 0:e.participants)||[],users:y,contacts:N,dispatch:g});(0,a.useEffect)(()=>{let e=C.current;if(!e)return;let t=e=>{var t;let s=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(s)for(let e=0;e<s.length;e++){let t=s[e];if("file"===t.kind){let e=t.getAsFile();e&&g({type:"attach-file",file:e})}}};return e.addEventListener("paste",t),()=>e.removeEventListener("paste",t)},[]);let L=(0,a.useCallback)(e=>g({type:"add-emoji",emoji:e.emoji}),[g]);function W(){var e;let l=!!s.file,a=!!(null===(e=s.text)||void 0===e?void 0:e.trim());(a||l)&&(console.log("Sending message:",l,a),t(),g({type:"change-text",text:""}),g({type:"remove-file"}),P(""),v(),document.dispatchEvent(new Event("scroll-to-bottom")))}return(0,a.useEffect)(()=>{let e=e=>{let t=e.shiftKey||e.altKey||e.ctrlKey;if("Enter"===e.key){if(t){g({type:"change-text",text:(null==s?void 0:s.text)+"\n"});return}e.preventDefault(),k||W()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[k,s.text,s.file]),(0,a.useMemo)(()=>{let e;return(null==j?void 0:j.from.includes("user:"))&&A&&(e=j)&&"internalChatId"in e?(0,T._)(j,A.CODIGO):(null==j?void 0:j.from.includes("external:"))?"received":(null==j?void 0:j.from.startsWith("me:"))?"sent":"received"},[j,A]),(0,l.jsxs)("div",{className:"flex max-h-36 items-center gap-2 bg-slate-200 px-2 py-2 text-indigo-300 dark:bg-slate-800 dark:text-indigo-400 md:mb-0 mb-6",children:[(0,l.jsx)("input",{type:"file",className:"hidden",ref:w,onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&g({type:"attach-file",file:s})}}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(n.A,{size:"small",className:"bg-white/20 dark:text-indigo-400",onClick:()=>I(!0),children:(0,l.jsx)(c.A,{})}),(0,l.jsx)(n.A,{size:"small",className:"bg-white/20 dark:text-indigo-400",onClick:()=>{w.current&&w.current.click()},children:(0,l.jsx)(d.A,{})}),(0,l.jsxs)("div",{className:"relative hidden md:block",children:[(0,l.jsx)(n.A,{size:"small",className:"bg-white/20 dark:text-indigo-400",onClick:()=>g({type:"toggle-emoji-menu"}),children:(0,l.jsx)(u.A,{})}),(0,l.jsx)("div",{className:"absolute bottom-full",children:(0,l.jsx)(m.Ay,{onEmojiClick:L,theme:m.Sx.AUTO,emojiStyle:m.Ai.FACEBOOK,lazyLoadEmojis:!0,suggestedEmojisMode:m.A2.FREQUENT,open:s.isEmojiMenuOpen,reactionsDefaultOpen:!1})})]})]}),(0,l.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[j&&(0,l.jsxs)("div",{className:"flex w-full items-center justify-between gap-2 rounded-md bg-indigo-500/10 p-2 dark:bg-indigo-600/20",children:[(0,l.jsxs)("div",{className:"text-sm text-black dark:text-slate-300",children:[j.body.split("\n").map((e,t)=>(0,l.jsx)("p",{className:"break-words text-sm",children:e},t)),j.fileId&&(0,l.jsx)("span",{className:"text-xs text-slate-400 dark:text-slate-500",children:j.fileName||"Arquivo anexado"})]}),(0,l.jsx)(n.A,{size:"small",className:"bg-white/20 dark:text-indigo-400",onClick:v,children:(0,l.jsx)(x.A,{})})]}),s.sendAsAudio&&s.file?(0,l.jsxs)("div",{className:"flex w-full items-center justify-center gap-2",children:[(0,l.jsx)("audio",{controls:!0,src:URL.createObjectURL(s.file),className:"h-8 max-w-[35rem] flex-grow"}),(0,l.jsx)(n.A,{color:"inherit",onClick:()=>g({type:"remove-file"}),children:(0,l.jsx)(x.A,{})})]}):(0,l.jsxs)("div",{className:"relative w-full",children:[(0,l.jsx)(r.A,{multiline:!0,fullWidth:!0,maxRows:5,size:"small",placeholder:"Mensagem",value:S,onChange:e=>_(e.target.value),inputRef:e=>{C.current=e}}),q&&(0,l.jsx)("div",{className:"absolute bottom-full mb-2 left-0 w-[20rem] max-h-40 overflow-auto rounded-md bg-white shadow-md z-50",children:0===B.length?(0,l.jsx)("div",{className:"p-2 text-sm text-gray-500",children:"Nenhum contato"}):B.map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 hover:bg-blue-100 cursor-pointer",onClick:()=>{var t;let s=G(e,S,(null===(t=C.current)||void 0===t?void 0:t.selectionStart)||0);setTimeout(()=>{var e,t;null===(e=C.current)||void 0===e||e.setSelectionRange(s.cursorPosition,s.cursorPosition),null===(t=C.current)||void 0===t||t.focus()},0)},children:[(0,l.jsx)("div",{className:"w-6 h-6 rounded-full bg-indigo-300 text-white text-xs flex items-center justify-center font-semibold",children:e.name[0]}),(0,l.jsx)("span",{className:"text-sm text-gray-800",children:e.name})]},e.userId))})]})]}),(0,l.jsx)(n.A,{size:"small","aria-hidden":0===S.length&&!s.sendAsAudio,className:"bg-white/20 dark:text-indigo-400",disabled:k,onClick:W,children:(0,l.jsx)(o.A,{})}),(0,l.jsx)("div",{className:"aria-hidden:hidden","aria-hidden":S.length>0||s.sendAsAudio,children:(0,l.jsx)(b,{onAudioRecorded:e=>g({type:"set-audio",file:e})})}),E&&(0,l.jsx)(i.A,{open:!0,onClose:()=>I(!1),children:(0,l.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e&&(0,l.jsx)(D,{chat:e,onClose:()=>I(!1)})})}),M&&(0,l.jsx)(i.A,{open:!0,onClose:()=>O(!1),children:(0,l.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"})})]})}},72724:(e,t,s)=>{s.d(t,{A:()=>m});var l=s(95155),a=s(3127),n=s(73731),r=s(76380),i=s(68534),o=s(69242),c=s(12115),d=s(92697),u=s(88702),x=s(40931);function m(){let{closeModal:e}=(0,c.useContext)(d.BR),{currentChat:t,transferAttendance:s}=(0,c.useContext)(u.ce),{users:m}=(0,c.useContext)(x.xI),[h,p]=(0,c.useState)(null);return(0,l.jsxs)("div",{className:"w-[26rem] rounded-md bg-slate-100 text-slate-900 dark:bg-slate-700 dark:text-white px-4 py-4",children:[(0,l.jsxs)("header",{className:"flex items-center justify-between pb-8",children:[(0,l.jsx)("h1",{className:"text-xl",children:"Transferir conversa"}),(0,l.jsx)(a.A,{onClick:e,children:(0,l.jsx)(o.A,{})})]}),(0,l.jsxs)("form",{className:"flex flex-col gap-6",children:[(0,l.jsx)(n.A,{select:!0,label:"Usu\xe1rio",required:!0,value:null!=h?h:"",onChange:e=>p(Number(e.target.value)),slotProps:{select:{MenuProps:{PaperProps:{className:"scrollbar-whatsapp",style:{maxHeight:248}}}}},children:null==m?void 0:m.map(e=>(0,l.jsx)(r.A,{value:e.CODIGO,children:e.NOME_EXIBICAO||e.NOME},e.CODIGO))}),(0,l.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,l.jsx)(i.A,{type:"button",variant:"contained",color:"secondary",className:"w-32",onClick:e,children:"Cancelar"}),(0,l.jsx)(i.A,{type:"button",variant:"contained",color:"primary",className:"w-32",disabled:!h,onClick:()=>{h&&t&&(s(null==t?void 0:t.id,h),e())},children:"Transferir"})]})]})]})}},74205:(e,t,s)=>{s.d(t,{A:()=>u,_:()=>d});var l=s(95155),a=s(17245),n=s(69926),r=s(12115),i=s(39447),o=s(40931),c=s(98892);function d(e,t){return"system"===e.from?"system":e.from==="user:".concat(t)?"sent":"received"}function u(){let{currentInternalChatMessages:e,users:t}=(0,r.useContext)(o.xI),{getMessageById:s,handleQuoteMessage:u}=(0,r.useContext)(i.U),{user:x}=(0,c.Z)();return(0,l.jsx)(l.Fragment,{children:e.map(e=>{let r=e.internalChatId&&e.quotedId&&s(e.internalChatId,e.quotedId,!0),i=r?(0,a.A)(r,d(r,x.CODIGO),t):null;return(0,l.jsx)(n.Ay,{id:e.id,style:d(e,x.CODIGO),text:e.body,date:new Date(+e.timestamp),status:e.status,fileId:e.fileId,fileName:e.fileName,fileType:e.fileType,fileSize:e.fileSize,quotedMessage:i,onQuote:()=>{u(e)}},"message_".concat(e.id))})})}},78286:(e,t,s)=>{s.d(t,{A:()=>d,m:()=>c});var l=s(95155),a=s(54607),n=s(12115),r=s(98892),i=s(38543);let o=(0,n.createContext)({}),c=()=>(0,n.useContext)(o);function d(e){let{children:t}=e,{token:s}=(0,n.useContext)(r.c),[c,d]=(0,n.useState)([]),u=(0,n.useRef)(new a.ReadyMessageClient("http://localhost:8005")),x=[{name:"@sauda\xe7\xe3o_tempo",replaceFor:"currentSaudation"},{name:"@cliente_razao",replaceFor:"customerRazao"},{name:"@cliente_cnpj",replaceFor:"customerCnpj"},{name:"@atendente_nome",replaceFor:"operatorName"},{name:"@atendente_nome_exibicao",replaceFor:"operatorNameExibition"},{name:"@contato_primeiro_nome",replaceFor:"customerFirstName"},{name:"@contato_nome_completo",replaceFor:"customerFullName"}],m=(0,n.useCallback)(async(e,t,l)=>{if(s)try{if(!l)return;let s=await u.current.updateReadyMessage(e,t,l);d(t=>t.map(t=>t.CODIGO===e?{...t,file:s.ARQUIVO}:t)),i.oR.success("Arquivo do Mensagem pronta atualizada com sucesso!")}catch(e){console.error("Error updating readyMessage image",e),i.oR.error("Erro ao atualizar Arquivo do Mensagem pronta")}},[s]),h=(0,n.useCallback)(async(e,t,l,a)=>{if(s)try{let s=await u.current.createReadyMessage(e,t,l,a);d(e=>[s,...e||[]])}catch(e){console.error("Error creating readyMessage",e),i.oR.error("Erro ao criar Mensagem pronta")}},[s]),p=(0,n.useCallback)(async e=>{if(s)try{await u.current.deleteReadyMessage(e),i.oR.success("Mensagem pronta  deletado com sucesso!"),d(t=>t.filter(t=>t.CODIGO!==e))}catch(e){i.oR.error("Erro ao deletar Mensagem pronta")}},[s]),f=(0,n.useCallback)(async()=>{s&&u.current&&(u.current.setAuth(s),d(await u.current.getReadyMessages()))},[s]);return(0,n.useEffect)(()=>{s&&u.current&&(u.current.setAuth(s),u.current.getReadyMessages().then(e=>{d(e)}))},[s,u.current]),(0,l.jsx)(o.Provider,{value:{readyMessages:c,updateReadyMessage:m,createReadyMessage:h,deleteReadyMessage:p,variables:x,replaceVariables:function(e){let{message:t,values:s}=e;return x.forEach(e=>{t=t.replaceAll(e.name,s[e.replaceFor])}),t},fetchReadyMessages:f},children:t})}},97609:(e,t,s)=>{s.d(t,{A:()=>N});var l=s(95155),a=s(51922),n=s(28890),r=s(335),i=s(93408),o=s(42663),c=s(83729),d=s(3127),u=s(12115),x=s(92697),m=s(73731),h=s(68534),p=s(69242),f=s(88702),g=s(38543);function j(){let{closeModal:e}=(0,u.useContext)(x.BR),{wppApi:t,currentChat:s,updateChatContact:a}=(0,u.useContext)(f.ce),[n,r]=(0,u.useState)(s.contact.name),i=async()=>{if(!s||!t.current||!s.contact)return;let{contact:l}=s;await t.current.updateContact(l.id,n),g.oR.success("Contato atualizado com sucesso!"),a(l.id,n),e()};return(0,u.useEffect)(()=>{(null==s?void 0:s.chatType)!=="wpp"&&e()},[s]),(0,l.jsxs)("div",{className:"w-[26rem] rounded-md bg-white text-gray-800 px-4 py-4 dark:bg-slate-800 dark:text-white",children:[(0,l.jsxs)("header",{className:"flex items-center justify-between pb-8",children:[(0,l.jsx)("h1",{className:"text-xl",children:"Editar contato"}),(0,l.jsx)(d.A,{onClick:e,children:(0,l.jsx)(p.A,{})})]}),(0,l.jsxs)("form",{className:"flex flex-col gap-6",children:[(0,l.jsx)(m.A,{label:"Nome",value:n,onChange:e=>r(e.target.value)}),(0,l.jsx)(m.A,{label:"Whatsapp",defaultValue:s.contact.phone,disabled:!0}),(0,l.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,l.jsx)(h.A,{type:"button",variant:"contained",color:"secondary",className:"w-32",onClick:e,children:"Cancelar"}),(0,l.jsx)(h.A,{type:"button",variant:"contained",color:"primary",className:"w-32",onClick:i,children:"SALVAR"})]})]})]})}var v=s(67840);function b(){let{closeModal:e}=(0,u.useContext)(x.BR),{createSchedule:t,currentChat:s}=(0,u.useContext)(f.ce),[a,n]=(0,u.useState)(null);return(0,l.jsxs)("div",{className:"w-[26rem] rounded-md bg-white text-gray-800 px-4 py-4 dark:bg-slate-800 dark:text-white",children:[(0,l.jsxs)("header",{className:"flex items-center justify-between pb-8",children:[(0,l.jsx)("h1",{className:"text-xl",children:"Agendar retorno"}),(0,l.jsx)(d.A,{onClick:e,children:(0,l.jsx)(p.A,{})})]}),(0,l.jsxs)("form",{className:"flex flex-col gap-6",children:[(0,l.jsx)(m.A,{className:"dark:input-dark",type:"datetime-local",required:!0,onChange:e=>{n(new Date(e.currentTarget.value))}}),(0,l.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,l.jsx)(h.A,{type:"button",variant:"contained",color:"secondary",className:"w-32",onClick:e,children:"Cancelar"}),(0,l.jsx)(h.A,{type:"button",variant:"contained",color:"primary",className:"w-32",onClick:()=>{(null==s?void 0:s.chatType)==="wpp"&&a&&(t(s,a),e())},children:"Agendar"})]})]})]})}var A=s(72724),y=s(42732);function N(e){let{name:t,avatarUrl:s,customerName:m,phone:h,chatType:p,codErp:g,cpfCnpj:N,customerId:w,startDate:C}=e,{openModal:k}=(0,u.useContext)(x.BR),{currentChat:E}=(0,f.jb)();return(0,l.jsxs)("div",{className:"flex items-center justify-between gap-4 border-b bg-slate-200 px-4 py-2 dark:border-none dark:bg-slate-800 md:pt-2 pt-10",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 bg-slate-300 dark:bg-slate-700 rounded-md px-2 py-1",children:[(0,l.jsx)(o.A,{variant:"rounded",alt:t,src:s||"",sx:{width:60,height:60}}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"font-semibold text-slate-800 dark:text-slate-200",children:t}),(0,l.jsx)("h2",{className:"text-sm text-slate-700 dark:text-slate-200",children:m||"Contato N\xe3o Atribu\xeddo"}),(0,l.jsx)("h2",{className:"text-sm text-slate-400 dark:text-slate-300",children:h?y.Formatter.phone(h):""})]})]}),w&&(0,l.jsxs)("div",{className:"bg-slate-300 dark:bg-slate-700 rounded-md px-2 py-1 flex flex-col",children:[(0,l.jsxs)("span",{className:"text-slate-800 dark:text-slate-200 text-sm",children:[(0,l.jsx)("b",{children:"CPF/CNPJ: "}),N||"N/D"]}),(0,l.jsxs)("span",{className:"text-sm text-slate-800 dark:text-slate-200",children:[(0,l.jsx)("b",{children:"C\xf3digo Cliente: "}),w||"N/D"]}),(0,l.jsxs)("span",{className:"text-sm text-slate-800 dark:text-slate-200",children:[(0,l.jsx)("b",{children:"C\xf3digo ERP: "}),g||"N/D"]})]})]}),(null==E?void 0:E.chatType)==="wpp"&&(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(c.A,{title:(0,l.jsx)("h3",{className:"text-base dark:text-white",children:"Editar contato"}),children:(0,l.jsx)(d.A,{onClick:()=>{k((0,l.jsx)(j,{}))},children:(0,l.jsx)(n.A,{color:"info"})})}),(0,l.jsx)(c.A,{title:(0,l.jsx)("h3",{className:"text-base dark:text-white",children:"Transferir conversa"}),children:(0,l.jsx)(d.A,{onClick:()=>{k((0,l.jsx)(A.A,{}))},children:(0,l.jsx)(i.A,{color:"secondary"})})}),(0,l.jsx)(c.A,{title:(0,l.jsx)("h3",{className:"text-base dark:text-white",children:"Agendar retorno"}),children:(0,l.jsx)(d.A,{onClick:()=>{k((0,l.jsx)(b,{}))},children:(0,l.jsx)(r.A,{color:"warning"})})}),(0,l.jsx)(c.A,{title:(0,l.jsx)("h3",{className:"text-base dark:text-white",children:"Finalizar conversa"}),children:(0,l.jsx)(d.A,{onClick:()=>{k((0,l.jsx)(v.A,{}))},children:(0,l.jsx)(a.A,{color:"success"})})})]})]})}s(700),s(40931)}}]);