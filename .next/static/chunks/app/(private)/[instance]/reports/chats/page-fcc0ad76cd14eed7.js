(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5969],{11559:(e,t,s)=>{"use strict";s.d(t,{N:()=>p,default:()=>x});var a=s(95155),r=s(98892),n=s(28450),l=s(33548),o=s(49271),c=s(54607),i=s(42732),u=s(35695),d=s(12115),h=s(38543);let p=(0,d.createContext)({});function x(e){let{children:t}=e,{socket:s}=(0,d.useContext)(n.d),{token:x}=(0,d.useContext)(r.c),m=(0,u.usePathname)(),f=(0,d.useMemo)(()=>m.split("/")[1],[m]),[v,g]=(0,d.useState)([]),[j,w]=(0,d.useState)([]),N=(0,d.useCallback)(async e=>{try{await l.A.deleteChatsReport(e),g(t=>t.filter(t=>t.id!==e)),h.oR.success("Relat\xf3rio exclu\xeddo com sucesso!")}catch(e){h.oR.error("Falha ao excluir relat\xf3rio!\n"+(0,i.sanitizeErrorMessage)(e))}},[]),b=(0,d.useCallback)(async e=>{try{let t=await l.A.generateChatsReport(e);g(e=>[{...t,progress:0},...e]),h.oR.success("Relat\xf3rio em processamento, voc\xea ser\xe1 notificado quando estiver pronto!")}catch(e){h.oR.error("Falha ao criar relat\xf3rio!\n"+(0,i.sanitizeErrorMessage)(e))}},[]),A=(0,d.useCallback)(e=>{g(t=>t.map(t=>t.id!==e.id||"chats"!==e.type?t:e.isCompleted?(h.oR.success("Relat\xf3rio gerado com sucesso!"),{...t,status:"completed",fileId:e.fileId,progress:100,chats:e.chats,messages:e.messages}):e.isFailed?(h.oR.error("Falha ao gerar relat\xf3rio!\n"+e.error),{...t,status:"failed"}):{...t,progress:+e.progress.toFixed(0)}))},[]);return(0,d.useEffect)(()=>{x&&(l.A.setAuth("Bearer ".concat(x)),o.A.setAuth("Bearer ".concat(x)),l.A.getChatsReports().then(e=>g(e.map(e=>({...e,progress:100*("pending"!==e.status)})))).catch(e=>h.oR.error("Falha ao buscar relat\xf3rios!\n"+(0,i.sanitizeErrorMessage)(e))),o.A.getUsers().then(e=>w(e.data)).catch(e=>h.oR.error("Falha ao buscar usu\xe1rios!\n"+(0,i.sanitizeErrorMessage)(e))))},[f,x]),(0,d.useEffect)(()=>{let e="reports:chats";return s&&(s.joinRoom(e),s.on(c.SocketEventType.ReportStatus,A)),()=>{s&&(s.leaveRoom(e),s.off(c.SocketEventType.ReportStatus))}},[s,A]),(0,a.jsx)(p.Provider,{value:{deleteReport:N,generateReport:b,reports:v,users:j},children:t})}},16876:(e,t,s)=>{"use strict";s.d(t,{default:()=>d});var a=s(95155);let r=(0,s(57515).A)((0,a.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");var n=s(12115),l=s(11559),o=s(73731),c=s(76380),i=s(36302),u=s(68534);function d(){let{users:e,generateReport:t}=(0,n.useContext)(l.N),[s,d]=(0,n.useState)({format:"pdf",userId:"*",startDate:"",endDate:""}),h=(0,n.useCallback)(async e=>{e.preventDefault(),t(s)},[s,t]);return(0,a.jsxs)("form",{className:"flex items-center gap-3 bg-indigo-700/5 px-4 py-4 text-xs shadow-md",onSubmit:h,children:[(0,a.jsxs)(o.A,{className:"w-32",select:!0,onChange:e=>d({...s,format:e.target.value}),label:"Formato",required:!0,size:"small",defaultValue:s.format,children:[(0,a.jsx)(c.A,{value:"txt",children:"TXT"}),(0,a.jsx)(c.A,{value:"pdf",children:"PDF"}),(0,a.jsx)(c.A,{value:"csv",children:"CSV"})]}),(0,a.jsx)(i.A,{className:"w-96",size:"small",options:[...e.map(e=>({label:e.NOME,value:String(e.CODIGO)})),{label:"Todos",value:"*"}],value:[...e.map(e=>({label:e.NOME,value:String(e.CODIGO)})),{label:"Todos",value:"*"}].find(e=>e.value===s.userId)||{label:"Todos",value:"*"},onChange:(e,t)=>{var a;d({...s,userId:null!==(a=null==t?void 0:t.value)&&void 0!==a?a:"*"})},renderInput:e=>(0,a.jsx)(o.A,{...e,label:"Usu\xe1rio"})}),(0,a.jsxs)("div",{className:"ml-4 flex items-center gap-2",children:[(0,a.jsx)(o.A,{className:"w-52",type:"date",size:"small",onChange:e=>d({...s,startDate:e.target.value})}),(0,a.jsx)(r,{}),(0,a.jsx)(o.A,{className:"w-52",size:"small",type:"date",onChange:e=>d({...s,endDate:e.target.value})})]}),(0,a.jsx)("div",{className:"ml-auto",children:(0,a.jsx)(u.A,{title:"Exportar",type:"submit",variant:"outlined",size:"small",children:"Exportar"})})]})}},19505:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(57515),r=s(95155);let n=(0,a.A)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},25232:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=new(s(54607)).FilesClient("https://inpulse.infotecrs.inf.br")},28450:(e,t,s)=>{"use strict";s.d(t,{d:()=>p,A:()=>x});var a=s(95155),r=s(54607),n=s(12115),l=s(98892),o=s(92697),c=s(3127),i=s(31857),u=s(69242);function d(e){let{qr:t,phone:s}=e,{closeModal:r}=(0,n.useContext)(o.BR);return(0,a.jsxs)("div",{className:"flex h-max w-max flex-col items-center gap-2 rounded-md bg-slate-400 px-6 py-4 text-slate-800",children:[(0,a.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,a.jsxs)("h1",{className:"text-lg font-semibold",children:[" QrCode: ",s," "]}),(0,a.jsx)(c.A,{onClick:r,children:(0,a.jsx)(u.A,{sx:{pointerEvents:"none"}})})]}),(0,a.jsx)(i.h,{value:t,height:480,width:480})]})}var h=s(38543);let p=(0,n.createContext)({});function x(e){let{children:t}=e,{token:s}=(0,n.useContext)(l.c),{openModal:c,closeModal:i}=(0,n.useContext)(o.BR),u=(0,n.useRef)(new r.SocketClient("https://socket.infotecrs.inf.br"));return(0,n.useEffect)(()=>{s?u.current.connect(s):u.current.disconnect()},[s,u]),(0,n.useEffect)(()=>{let e=u.current;return e.on(r.SocketEventType.WwebjsQr,e=>{let{qr:t,phone:s}=e;c((0,a.jsx)(d,{qr:t,phone:s}))}),e.on(r.SocketEventType.WwebjsAuth,e=>{let{phone:t,success:s,message:a}=e;s?h.oR.success("N\xfamero ".concat(t," autenticado com sucesso!")):h.oR.error("Erro ao autenticar n\xfamero ".concat(t,": ").concat(a))}),()=>{e.off(r.SocketEventType.WwebjsQr),e.off(r.SocketEventType.WwebjsAuth)}},[u,i,c]),(0,a.jsx)(p.Provider,{value:{socket:u.current},children:t})}},33548:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=new(s(54607)).ReportsClient("https://inpulse.infotecrs.inf.br")},49271:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=new(s(54607)).UsersClient("https://inpulse.infotecrs.inf.br")},57781:(e,t,s)=>{"use strict";s.d(t,{default:()=>d});var a=s(95155),r=s(12115),n=s(25232),l=s(42732);let o=(0,s(57515).A)((0,a.jsx)("path",{d:"M18 2h-8L4 8v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-6 15-4-4h3V9.02L13 9v4h3z"}),"SimCardDownload");var c=s(19505),i=s(11559);function u(e){let{user:t,report:s}=e,{deleteReport:u}=(0,r.useContext)(i.N),d=(0,r.useMemo)(()=>n.A.getFileDownloadUrl(s.fileId),[s.fileId]),h=(0,r.useMemo)(()=>{switch(s.status){case"pending":return"Processando";case"completed":return"Finalizado";case"failed":return"Falhou";default:return"Desconhecido"}},[s.status]);return(0,a.jsxs)("tr",{className:"w-max rounded-md text-sm even:bg-indigo-500/5",children:[(0,a.jsxs)("td",{className:"w-44 px-2 py-3 pl-8",children:[h,"pending"==s.status&&" (".concat(s.progress,"%)")]}),(0,a.jsx)("td",{className:"w-48 truncate px-2 py-3",children:t}),(0,a.jsx)("td",{className:"w-48 truncate px-2 py-3",children:l.Formatter.date(s.exportDate)}),(0,a.jsx)("td",{className:"w-28 truncate px-2 py-3",children:s.startDate}),(0,a.jsx)("td",{className:"w-28 truncate px-2 py-3",children:s.endDate}),(0,a.jsx)("td",{className:"w-24 truncate px-2 py-3",children:s.chats}),(0,a.jsx)("td",{className:"w-28 truncate px-2 py-3",children:s.messages}),(0,a.jsx)("td",{className:"w-24 truncate px-2 py-3",children:s.format.toUpperCase()}),(0,a.jsxs)("td",{className:"flex w-24 items-center justify-end gap-4 truncate px-2 py-3 pr-4",children:[(0,a.jsx)("a",{className:"transition-all hover:text-indigo-400",href:d,title:"Baixar",children:(0,a.jsx)(o,{})}),(0,a.jsx)("button",{className:"transition-all hover:text-red-400",title:"Excluir",type:"button",onClick:()=>u(s.id),children:(0,a.jsx)(c.A,{})})]})]})}function d(){let{reports:e,users:t}=(0,r.useContext)(i.N);return(0,a.jsx)("div",{className:"scrollbar-whatsapp mx-auto w-full overflow-y-scroll bg-indigo-700/5 dark:bg-indigo-900/10",children:(0,a.jsxs)("table",{className:"w-max text-sm text-black dark:text-white",children:[(0,a.jsx)("thead",{className:"sticky top-0 rounded-md bg-white shadow-sm dark:bg-indigo-900 dark:shadow-md",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"w-44 px-2 py-2 pl-8 text-left",children:"Status"}),(0,a.jsx)("th",{className:"w-48 px-2 py-2 text-left",children:"Usu\xe1rio"}),(0,a.jsx)("th",{className:"w-48 px-2 py-2 text-left",children:"Gerado em"}),(0,a.jsx)("th",{className:"w-28 px-2 py-2 text-left",children:"De"}),(0,a.jsx)("th",{className:"w-28 px-2 py-2 text-left",children:"At\xe9"}),(0,a.jsx)("th",{className:"w-24 px-2 py-2 text-left",children:"Chats"}),(0,a.jsx)("th",{className:"w-28 px-2 py-2 text-left",children:"Mensagens"}),(0,a.jsx)("th",{className:"w-24 px-2 py-2 text-left",children:"Formato"}),(0,a.jsx)("th",{className:"w-24 px-2 py-2 pr-4 text-left"})]})}),(0,a.jsx)("tbody",{className:"w-full py-2",children:e.map(e=>{var s;return(0,a.jsx)(u,{report:e,user:(null===(s=t.find(t=>t.CODIGO==+e.userId))||void 0===s?void 0:s.NOME)||"Todos"},"report:".concat(e.id))})})]})})}},70436:(e,t,s)=>{Promise.resolve().then(s.bind(s,11559)),Promise.resolve().then(s.bind(s,16876)),Promise.resolve().then(s.bind(s,57781))},92697:(e,t,s)=>{"use strict";s.d(t,{Ay:()=>o,BR:()=>n,Us:()=>l});var a=s(95155),r=s(12115);let n=(0,r.createContext)({});function l(){let e=(0,r.useContext)(n);if(!e)throw Error("useAppContext must be used within an AppProvider");return e}function o(e){let{children:t,modal:s,setModal:l}=e;return(0,r.useEffect)(()=>{"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission()},[]),(0,a.jsx)(n.Provider,{value:{modal:s,openModal:e=>{l(e)},closeModal:()=>{l(null)}},children:t})}},98892:(e,t,s)=>{"use strict";s.d(t,{c:()=>d,default:()=>p,Z:()=>h});var a=s(95155),r=s(12115);let n=new(s(54607)).AuthClient("https://inpulse.infotecrs.inf.br");var l=s(38543),o=s(23464),c=s(35695),i=s(42732),u=s(49271);let d=(0,r.createContext)({});function h(){let e=(0,r.useContext)(d);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}function p(e){let{children:t}=e,s=(0,c.useRouter)(),h=(0,c.usePathname)(),p=(0,r.useRef)(h.split("/")[1]),[x,m]=(0,r.useState)(null),[f,v]=(0,r.useState)(null),g=(0,r.useCallback)(async(e,t)=>{let{login:a,password:r}=t;try{let t=await n.login(e,a,r);localStorage.setItem("@inpulse/".concat(e,"/token"),t.token),p.current=e,m(t.user),v(t.token),o.A.defaults.headers.authorization="Bearer ".concat(t.token),s.replace("/".concat(e))}catch(e){l.oR.error("Falha ao logar!\n"+(0,i.sanitizeErrorMessage)(e))}},[s]),j=(0,r.useCallback)(()=>{v(null),localStorage.removeItem("@inpulse/".concat(p.current,"/token")),s.replace("/".concat(p.current,"/login")),m(null)},[s]);return(0,r.useEffect)(()=>{p.current=h.split("/")[1];let e=localStorage.getItem("@inpulse/".concat(p.current,"/token"));v(e),e&&(u.A.setAuth(e),n.fetchSessionData(e).then(async t=>{p.current=t.instance,o.A.defaults.headers.authorization="Bearer ".concat(e),u.A.setAuth("Bearer ".concat(e)),m(await u.A.getUserById(t.userId)),h.includes("login")&&s.replace("/".concat(p.current))}).catch(e=>{l.oR.error(e.message||"Sess\xe3o expirada, fa\xe7a o login novamente!"),localStorage.removeItem("@inpulse/".concat(p.current,"/token")),m(null),h.includes("login")||s.replace("/".concat(p.current,"/login"))})),e||h.includes("login")||s.replace("/".concat(p.current,"/login"))},[h,s]),(0,a.jsx)(d.Provider,{value:{user:x,token:f,isAuthenticated:!1,signIn:g,signOut:j,instance:p.current},children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4488,9141,8534,1620,4954,6302,8441,1684,7358],()=>t(70436)),_N_E=e.O()}]);