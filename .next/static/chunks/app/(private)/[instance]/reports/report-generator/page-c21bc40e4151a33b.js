(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3428],{33548:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=new(r(54607)).ReportsClient("https://inpulse.infotecrs.inf.br")},38588:(e,t,r)=>{Promise.resolve().then(r.bind(r,60045))},49271:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});let n=new(r(54607)).UsersClient("https://inpulse.infotecrs.inf.br")},60045:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>q});var n=r(95155),a=r(12115),l=r(33548),s=r(98892);let o=(0,a.createContext)({history:[],loading:!1,error:null,sql:"",description:"",setSql:()=>{},setDescription:()=>{},fillForm:()=>{},exportReport:async()=>{},executeReport:async()=>({rows:[]}),reloadHistory:async()=>{},resultData:[],resultColumns:[],deleteReport:async e=>{}});function i(e){let{children:t}=e,[r,i]=(0,a.useState)([]),[c,u]=(0,a.useState)(!1),[d,h]=(0,a.useState)(null),{token:x}=(0,a.useContext)(s.c),[p,m]=(0,a.useState)(""),[f,j]=(0,a.useState)(""),[A,g]=(0,a.useState)([]),[y,C]=(0,a.useState)([]);async function v(){u(!0);try{x&&l.A.setAuth(x);let e=await l.A.getSqlReportsHistory();i(e),h(null)}catch(e){h("Erro ao carregar hist\xf3rico")}finally{u(!1)}}async function w(e,t){u(!0);try{x&&l.A.setAuth(x);let r=await l.A.executeSqlReport({sql:e,description:t})||[];return r.length?(C(Object.keys(r[0])),g(r)):(C([]),g([])),await v(),h(null),{rows:r}}catch(e){throw h("Erro ao gerar relat\xf3rio"),Error("Erro ao gerar relat\xf3rio")}finally{u(!1)}}async function S(e,t,r){u(!0);try{x&&l.A.setAuth(x);let n=await l.A.exportReportSql({sql:e,description:t,format:r}),a=window.URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download="relatorio.".concat(r),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(a),await v(),h(null)}catch(e){h("Erro ao exportar relat\xf3rio SQL")}finally{u(!1)}}async function b(e){u(!0);try{x&&l.A.setAuth(x),await l.A.deleteHistoryReport(+e),await v(),h(null)}catch(e){h("Erro ao deletar relat\xf3rio")}finally{u(!1)}}return(0,a.useEffect)(()=>{v()},[]),(0,n.jsx)(o.Provider,{value:{history:r,loading:c,error:d,sql:p,description:f,setSql:m,setDescription:j,fillForm:(e,t)=>{m(e),j(t)},exportReport:S,executeReport:w,reloadHistory:v,resultData:A,resultColumns:y,deleteReport:b},children:t})}var c=r(73731),u=r(68534),d=r(14426),h=r(56278),x=r(54492),p=r(99927),m=r(17976),f=r(56033),j=r(90404),A=r(59832),g=r(99776),y=r(71977),C=r(83729),v=r(3127),w=r(5087),S=r(76380),b=r(25032);function k(){let{executeReport:e,exportReport:t,loading:r,error:l,sql:s,setSql:i,description:k,setDescription:E,resultData:R,resultColumns:N}=(0,a.useContext)(o),[F,q]=(0,a.useState)(!1),[L,z]=(0,a.useState)(null);async function P(t){if(t.preventDefault(),s.trim()&&k.trim())try{await e(s,k),q(!0)}catch(e){}}let U=async e=>{if(z(null),s.trim()&&k.trim())try{await t(s,k,e)}catch(e){}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("form",{onSubmit:P,className:"flex flex-col gap-4",children:[(0,n.jsx)(c.A,{label:"Descri\xe7\xe3o",variant:"outlined",value:k,onChange:e=>E(e.target.value),required:!0}),(0,n.jsx)(c.A,{label:"SQL SELECT",variant:"outlined",multiline:!0,rows:12,value:s,onChange:e=>i(e.target.value),required:!0,spellCheck:!1,inputProps:{style:{fontFamily:"monospace"}}}),l&&(0,n.jsx)("div",{className:"text-red-500",children:l}),(0,n.jsx)(u.A,{type:"submit",variant:"contained",disabled:r,children:r?(0,n.jsx)(d.A,{size:24}):"Executar SQL"})]}),(0,n.jsxs)(h.A,{open:F,onClose:()=>q(!1),maxWidth:"lg",fullWidth:!0,children:[(0,n.jsx)(x.A,{children:"Resultado da Consulta"}),(0,n.jsx)(p.A,{dividers:!0,children:0===R.length?(0,n.jsx)("p",{children:"Nenhum dado retornado."}):(0,n.jsxs)(m.A,{size:"small",children:[(0,n.jsx)(f.A,{children:(0,n.jsx)(j.A,{children:N.map(e=>(0,n.jsx)(A.A,{children:e},e))})}),(0,n.jsx)(g.A,{children:R.map((e,t)=>(0,n.jsx)(j.A,{children:N.map(t=>{var r;return(0,n.jsx)(A.A,{children:String(null!==(r=e[t])&&void 0!==r?r:"")},t)})},t))})]})}),(0,n.jsxs)(y.A,{children:[(0,n.jsx)(u.A,{onClick:()=>q(!1),children:"Fechar"}),(0,n.jsx)(C.A,{title:"Exportar relat\xf3rio",children:(0,n.jsx)(v.A,{onClick:e=>{z(e.currentTarget)},children:(0,n.jsx)(b.A,{})})}),(0,n.jsx)(w.A,{anchorEl:L,open:!!L,onClose:()=>z(null),children:["pdf","csv"].map(e=>(0,n.jsxs)(S.A,{onClick:()=>U(e),children:["Exportar como ",e.toUpperCase()]},e))})]})]})]})}var E=r(42732),R=r(19505);function N(e){let{report:t}=e,{fillForm:r,deleteReport:l}=(0,a.useContext)(o),[s,i]=(0,a.useState)(!1),c=async()=>{try{await l(t.id),i(!1)}catch(e){}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("li",{onClick:()=>r(t.sql,t.description),className:"border p-3 rounded-md bg-gray-50 shadow-sm flex justify-between items-center cursor-pointer hover:bg-indigo-50 transition-colors",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{className:"text-gray-800",children:t.description}),(0,n.jsx)("br",{}),(0,n.jsx)("small",{className:"text-gray-500",children:E.Formatter.date(t.createdAt)})]}),(0,n.jsx)(C.A,{title:"Delete",children:(0,n.jsx)(v.A,{onClick:e=>{e.stopPropagation(),i(!0)},size:"small",color:"error",children:(0,n.jsx)(R.A,{fontSize:"small"})})})]}),(0,n.jsxs)(h.A,{open:s,onClose:()=>i(!1),children:[(0,n.jsx)(x.A,{children:"Confirma exclus\xe3o deste relat\xf3rio?"}),(0,n.jsxs)(y.A,{children:[(0,n.jsx)(u.A,{onClick:()=>i(!1),children:"Cancelar"}),(0,n.jsx)(u.A,{color:"error",onClick:c,autoFocus:!0,children:"Excluir"})]})]})]})}function F(){let{history:e,loading:t}=(0,a.useContext)(o);return(0,n.jsxs)("aside",{className:"bg-white p-4 border rounded-md shadow-md max-h-[600px] scrollbar-whatsapp",children:[(0,n.jsx)("h2",{className:"mb-4 font-semibold text-lg text-gray-800",children:"Execu\xe7\xf5es Recentes"}),t&&(0,n.jsx)("p",{children:"Carregando hist\xf3rico..."}),!t&&(null==e?void 0:e.length)===0&&(0,n.jsx)("p",{children:"Nenhum relat\xf3rio gerado ainda."}),(0,n.jsx)("ul",{className:"flex flex-col gap-2",children:null==e?void 0:e.map(e=>(0,n.jsx)(N,{report:e},e.id))})]})}function q(){return(0,n.jsx)(i,{children:(0,n.jsxs)("div",{className:"grid grid-cols-[2fr_1fr] gap-6 max-w-[90rem] mx-auto p-6",children:[(0,n.jsx)(k,{}),(0,n.jsx)(F,{})]})})}},98892:(e,t,r)=>{"use strict";r.d(t,{c:()=>d,default:()=>x,Z:()=>h});var n=r(95155),a=r(12115);let l=new(r(54607)).AuthClient("https://inpulse.infotecrs.inf.br");var s=r(38543),o=r(23464),i=r(35695),c=r(42732),u=r(49271);let d=(0,a.createContext)({});function h(){let e=(0,a.useContext)(d);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}function x(e){let{children:t}=e,r=(0,i.useRouter)(),h=(0,i.usePathname)(),x=(0,a.useRef)(h.split("/")[1]),[p,m]=(0,a.useState)(null),[f,j]=(0,a.useState)(null),A=(0,a.useCallback)(async(e,t)=>{let{login:n,password:a}=t;try{let t=await l.login(e,n,a);localStorage.setItem("@inpulse/".concat(e,"/token"),t.token),x.current=e,m(t.user),j(t.token),o.A.defaults.headers.authorization="Bearer ".concat(t.token),r.replace("/".concat(e))}catch(e){s.oR.error("Falha ao logar!\n"+(0,c.sanitizeErrorMessage)(e))}},[r]),g=(0,a.useCallback)(()=>{j(null),localStorage.removeItem("@inpulse/".concat(x.current,"/token")),r.replace("/".concat(x.current,"/login")),m(null)},[r]);return(0,a.useEffect)(()=>{x.current=h.split("/")[1];let e=localStorage.getItem("@inpulse/".concat(x.current,"/token"));j(e),e&&(u.A.setAuth(e),l.fetchSessionData(e).then(async t=>{x.current=t.instance,o.A.defaults.headers.authorization="Bearer ".concat(e),u.A.setAuth("Bearer ".concat(e)),m(await u.A.getUserById(t.userId)),h.includes("login")&&r.replace("/".concat(x.current))}).catch(e=>{s.oR.error(e.message||"Sess\xe3o expirada, fa\xe7a o login novamente!"),localStorage.removeItem("@inpulse/".concat(x.current,"/token")),m(null),h.includes("login")||r.replace("/".concat(x.current,"/login"))})),e||h.includes("login")||r.replace("/".concat(x.current,"/login"))},[h,r]),(0,n.jsx)(d.Provider,{value:{user:p,token:f,isAuthenticated:!1,signIn:A,signOut:g,instance:x.current},children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4488,9141,8534,6805,4954,5332,3729,6105,8441,1684,7358],()=>t(38588)),_N_E=e.O()}]);