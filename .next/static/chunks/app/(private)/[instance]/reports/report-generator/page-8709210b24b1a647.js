(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3428],{33548:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=new(r(54607)).ReportsClient("http://localhost:8006")},38588:(e,t,r)=>{Promise.resolve().then(r.bind(r,60045))},49271:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=new(r(54607)).UsersClient("http://localhost:8001")},60045:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>q});var a=r(95155),l=r(12115),n=r(33548),s=r(98892);let o=(0,l.createContext)({history:[],loading:!1,error:null,sql:"",description:"",setSql:()=>{},setDescription:()=>{},fillForm:()=>{},exportReport:async()=>{},executeReport:async()=>({rows:[]}),reloadHistory:async()=>{},resultData:[],resultColumns:[],deleteReport:async e=>{}});function c(e){let{children:t}=e,[r,c]=(0,l.useState)([]),[i,u]=(0,l.useState)(!1),[d,h]=(0,l.useState)(null),{token:x}=(0,l.useContext)(s.c),[p,m]=(0,l.useState)(""),[j,A]=(0,l.useState)(""),[g,f]=(0,l.useState)([]),[y,C]=(0,l.useState)([]);async function v(){u(!0);try{x&&n.A.setAuth(x);let e=await n.A.getSqlReportsHistory();c(e),h(null)}catch(e){h("Erro ao carregar hist\xf3rico")}finally{u(!1)}}async function w(e,t){u(!0);try{x&&n.A.setAuth(x);let r=await n.A.executeSqlReport({sql:e,description:t})||[];return r.length?(C(Object.keys(r[0])),f(r)):(C([]),f([])),await v(),h(null),{rows:r}}catch(e){throw h("Erro ao gerar relat\xf3rio"),Error("Erro ao gerar relat\xf3rio")}finally{u(!1)}}async function S(e,t,r){u(!0);try{x&&n.A.setAuth(x);let a=await n.A.exportReportSql({sql:e,description:t,format:r}),l=window.URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download="relatorio.".concat(r),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(l),await v(),h(null)}catch(e){h("Erro ao exportar relat\xf3rio SQL")}finally{u(!1)}}async function b(e){u(!0);try{x&&n.A.setAuth(x),await n.A.deleteHistoryReport(+e),await v(),h(null)}catch(e){h("Erro ao deletar relat\xf3rio")}finally{u(!1)}}return(0,l.useEffect)(()=>{v()},[]),(0,a.jsx)(o.Provider,{value:{history:r,loading:i,error:d,sql:p,description:j,setSql:m,setDescription:A,fillForm:(e,t)=>{m(e),A(t)},exportReport:S,executeReport:w,reloadHistory:v,resultData:g,resultColumns:y,deleteReport:b},children:t})}var i=r(73731),u=r(68534),d=r(14426),h=r(56278),x=r(54492),p=r(99927),m=r(17976),j=r(56033),A=r(90404),g=r(59832),f=r(99776),y=r(71977),C=r(83729),v=r(3127),w=r(5087),S=r(76380),b=r(25032);function k(){let{executeReport:e,exportReport:t,loading:r,error:n,sql:s,setSql:c,description:k,setDescription:E,resultData:R,resultColumns:N}=(0,l.useContext)(o),[F,q]=(0,l.useState)(!1),[L,z]=(0,l.useState)(null);async function P(t){if(t.preventDefault(),s.trim()&&k.trim())try{await e(s,k),q(!0)}catch(e){}}let U=async e=>{if(z(null),s.trim()&&k.trim())try{await t(s,k,e)}catch(e){}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("form",{onSubmit:P,className:"flex flex-col gap-4",children:[(0,a.jsx)(i.A,{label:"Descri\xe7\xe3o",variant:"outlined",value:k,onChange:e=>E(e.target.value),required:!0}),(0,a.jsx)(i.A,{label:"SQL SELECT",variant:"outlined",multiline:!0,rows:12,value:s,onChange:e=>c(e.target.value),required:!0,spellCheck:!1,inputProps:{style:{fontFamily:"monospace"}}}),n&&(0,a.jsx)("div",{className:"text-red-500",children:n}),(0,a.jsx)(u.A,{type:"submit",variant:"contained",disabled:r,children:r?(0,a.jsx)(d.A,{size:24}):"Executar SQL"})]}),(0,a.jsxs)(h.A,{open:F,onClose:()=>q(!1),maxWidth:"lg",fullWidth:!0,children:[(0,a.jsx)(x.A,{children:"Resultado da Consulta"}),(0,a.jsx)(p.A,{dividers:!0,children:0===R.length?(0,a.jsx)("p",{children:"Nenhum dado retornado."}):(0,a.jsxs)(m.A,{size:"small",children:[(0,a.jsx)(j.A,{children:(0,a.jsx)(A.A,{children:N.map(e=>(0,a.jsx)(g.A,{children:e},e))})}),(0,a.jsx)(f.A,{children:R.map((e,t)=>(0,a.jsx)(A.A,{children:N.map(t=>{var r;return(0,a.jsx)(g.A,{children:String(null!==(r=e[t])&&void 0!==r?r:"")},t)})},t))})]})}),(0,a.jsxs)(y.A,{children:[(0,a.jsx)(u.A,{onClick:()=>q(!1),children:"Fechar"}),(0,a.jsx)(C.A,{title:"Exportar relat\xf3rio",children:(0,a.jsx)(v.A,{onClick:e=>{z(e.currentTarget)},children:(0,a.jsx)(b.A,{})})}),(0,a.jsx)(w.A,{anchorEl:L,open:!!L,onClose:()=>z(null),children:["pdf","csv"].map(e=>(0,a.jsxs)(S.A,{onClick:()=>U(e),children:["Exportar como ",e.toUpperCase()]},e))})]})]})]})}var E=r(42732),R=r(19505);function N(e){let{report:t}=e,{fillForm:r,deleteReport:n}=(0,l.useContext)(o),[s,c]=(0,l.useState)(!1),i=async()=>{try{await n(t.id),c(!1)}catch(e){}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("li",{onClick:()=>r(t.sql,t.description),className:"border p-3 rounded-md bg-gray-50 shadow-sm flex justify-between items-center cursor-pointer hover:bg-indigo-50 transition-colors",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-gray-800",children:t.description}),(0,a.jsx)("br",{}),(0,a.jsx)("small",{className:"text-gray-500",children:E.Formatter.date(t.createdAt)})]}),(0,a.jsx)(C.A,{title:"Delete",children:(0,a.jsx)(v.A,{onClick:e=>{e.stopPropagation(),c(!0)},size:"small",color:"error",children:(0,a.jsx)(R.A,{fontSize:"small"})})})]}),(0,a.jsxs)(h.A,{open:s,onClose:()=>c(!1),children:[(0,a.jsx)(x.A,{children:"Confirma exclus\xe3o deste relat\xf3rio?"}),(0,a.jsxs)(y.A,{children:[(0,a.jsx)(u.A,{onClick:()=>c(!1),children:"Cancelar"}),(0,a.jsx)(u.A,{color:"error",onClick:i,autoFocus:!0,children:"Excluir"})]})]})]})}function F(){let{history:e,loading:t}=(0,l.useContext)(o);return(0,a.jsxs)("aside",{className:"bg-white p-4 border rounded-md shadow-md max-h-[600px] scrollbar-whatsapp",children:[(0,a.jsx)("h2",{className:"mb-4 font-semibold text-lg text-gray-800",children:"Execu\xe7\xf5es Recentes"}),t&&(0,a.jsx)("p",{children:"Carregando hist\xf3rico..."}),!t&&(null==e?void 0:e.length)===0&&(0,a.jsx)("p",{children:"Nenhum relat\xf3rio gerado ainda."}),(0,a.jsx)("ul",{className:"flex flex-col gap-2",children:null==e?void 0:e.map(e=>(0,a.jsx)(N,{report:e},e.id))})]})}function q(){return(0,a.jsx)(c,{children:(0,a.jsxs)("div",{className:"grid grid-cols-[2fr_1fr] gap-6 max-w-[90rem] mx-auto p-6",children:[(0,a.jsx)(k,{}),(0,a.jsx)(F,{})]})})}},98892:(e,t,r)=>{"use strict";r.d(t,{c:()=>d,default:()=>x,Z:()=>h});var a=r(95155),l=r(12115);let n=new(r(54607)).AuthClient("http://localhost:8001");var s=r(38543),o=r(23464),c=r(35695),i=r(42732),u=r(49271);let d=(0,l.createContext)({});function h(){let e=(0,l.useContext)(d);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}function x(e){let{children:t}=e,r=(0,c.useRouter)(),h=(0,c.usePathname)(),x=(0,l.useRef)(h.split("/")[1]),[p,m]=(0,l.useState)(null),[j,A]=(0,l.useState)(null),g=(0,l.useCallback)(async(e,t)=>{let{login:a,password:l}=t;try{let t=await n.login(e,a,l);localStorage.setItem("@inpulse/".concat(e,"/token"),t.token),x.current=e,m(t.user),A(t.token),o.A.defaults.headers.authorization="Bearer ".concat(t.token),r.replace("/".concat(e))}catch(e){s.oR.error("Falha ao logar!\n"+(0,i.sanitizeErrorMessage)(e))}},[r]),f=(0,l.useCallback)(()=>{A(null),localStorage.removeItem("@inpulse/".concat(x.current,"/token")),r.replace("/".concat(x.current,"/login")),m(null)},[r]);return(0,l.useEffect)(()=>{x.current=h.split("/")[1];let e=localStorage.getItem("@inpulse/".concat(x.current,"/token"));A(e),e&&(u.A.setAuth(e),n.fetchSessionData(e).then(async t=>{x.current=t.instance,o.A.defaults.headers.authorization="Bearer ".concat(e),u.A.setAuth("Bearer ".concat(e)),m(await u.A.getUserById(t.userId)),h.includes("login")&&r.replace("/".concat(x.current))}).catch(e=>{s.oR.error(e.message||"Sess\xe3o expirada, fa\xe7a o login novamente!"),localStorage.removeItem("@inpulse/".concat(x.current,"/token")),m(null),h.includes("login")||r.replace("/".concat(x.current,"/login"))})),e||h.includes("login")||r.replace("/".concat(x.current,"/login"))},[h,r]),(0,a.jsx)(d.Provider,{value:{user:p,token:j,isAuthenticated:!1,signIn:g,signOut:f,instance:x.current},children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4488,9141,8534,6805,4954,5332,3729,6105,8441,1684,7358],()=>t(38588)),_N_E=e.O()}]);