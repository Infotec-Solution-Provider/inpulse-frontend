(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8604],{19453:(e,r,a)=>{"use strict";a.d(r,{default:()=>d,w:()=>i});var t=a(95155),s=a(98892),c=a(54607),n=a(42732),l=a(12115),o=a(38543);let u=a(49509).env.NEXT_PUBLIC_WALLETS_URL||"http://localhost:8005",i=(0,l.createContext)({});function d(e){let{children:r}=e,{token:a}=(0,s.Z)(),[d,h]=(0,l.useState)([]),[f,g]=(0,l.useState)(!0),[y,m]=(0,l.useState)("name"),[p,C]=(0,l.useState)("asc"),[b,v]=(0,l.useState)(null),[k,R]=(0,l.useState)([]),w=(0,l.useRef)(new c.WalletsClient(u));(0,l.useEffect)(()=>{a&&(w.current.setAuth(a),(async()=>{try{g(!0);let e=await w.current.getWallets();h(e)}catch(e){o.oR.error("Falha ao carregar as carteiras: ".concat((0,n.sanitizeErrorMessage)(e)))}finally{g(!1)}})())},[a]);let A=(0,l.useMemo)(()=>[...d].sort((e,r)=>{if("userIds"===y){var a,t;let s=(null===(a=e.userIds)||void 0===a?void 0:a.length)||0,c=(null===(t=r.userIds)||void 0===t?void 0:t.length)||0;return"asc"===p?s-c:c-s}let s=e[y],c=r[y];return s===c?0:null==s?1:null==c?-1:"string"==typeof s&&"string"==typeof c?"asc"===p?s.localeCompare(c):c.localeCompare(s):"asc"===p?Number(s)-Number(c):Number(c)-Number(s)}),[d,p,y]),E=(0,l.useCallback)(async e=>{try{g(!0);let r=await w.current.createWallet(e);return h(e=>[{...r,userIds:r.userIds||[]},...e]),o.oR.success("Carteira criada com sucesso!"),!0}catch(e){return o.oR.error("Falha ao criar carteira: ".concat((0,n.sanitizeErrorMessage)(e))),!1}finally{g(!1)}},[]),I=(0,l.useCallback)(async e=>{try{g(!0),await w.current.deleteWallet(e),h(r=>r.filter(r=>r.id!==e)),o.oR.success("Carteira excluida com sucesso!")}catch(e){o.oR.error("Falha ao excluir carteira: ".concat((0,n.sanitizeErrorMessage)(e)))}finally{g(!1)}},[]),S=(0,l.useCallback)(async(e,r)=>{try{g(!0),h(a=>a.map(a=>a.id===e?{...a,name:r}:a)),o.oR.success("Carteira atualizada!")}catch(e){o.oR.error("Falha ao atualizar carteira: ".concat((0,n.sanitizeErrorMessage)(e)))}finally{g(!1)}},[]),z=(0,l.useCallback)(async e=>{try{let r=await w.current.getWalletUsers(e);return Array.isArray(r)?r:[]}catch(e){return o.oR.error("Falha ao buscar usu\xe1rios: ".concat((0,n.sanitizeErrorMessage)(e))),[]}},[]),M=(0,l.useCallback)(async(e,r)=>{try{return await w.current.getUserWallets(e,r)}catch(e){return o.oR.error("Falha ao buscar carteiras do usu\xe1rio: ".concat((0,n.sanitizeErrorMessage)(e))),[]}},[]),F=(0,l.useCallback)(async e=>{if(b)try{g(!0);let r=await w.current.addUserToWallet(b.id,e);h(a=>a.map(a=>a.id===b.id?{...r,userIds:Array.isArray(r.userIds)?r.userIds:[...a.userIds||[],e]}:a)),R(r=>[...r||[],e]),o.oR.success("Usu\xe1rio adicionado com sucesso!")}catch(e){o.oR.error("Falha ao adicionar usu\xe1rio: ".concat((0,n.sanitizeErrorMessage)(e)))}finally{g(!1)}},[b]),U=(0,l.useCallback)(async e=>{if(b)try{g(!0),await w.current.removeUserFromWallet(b.id,e),h(r=>r.map(r=>r.id===b.id?{...r,userIds:r.userIds.filter(r=>r!==e)}:r)),R(r=>r.filter(r=>r!==e)),o.oR.success("Usu\xe1rio removido com sucesso!")}catch(e){o.oR.error("Falha ao remover usu\xe1rio: ".concat((0,n.sanitizeErrorMessage)(e)))}finally{g(!1)}},[b]),x=(0,l.useCallback)(async()=>{if(b)try{let e=await z(b.id);R(e)}catch(e){o.oR.error("Error loading users: ".concat((0,n.sanitizeErrorMessage)(e)))}},[b,z]);return(0,t.jsx)(i.Provider,{value:{walletsApi:w,wallets:d,createWallet:E,deleteWallet:I,updateWalletName:S,getWalletUsers:z,getUserWallets:M,addUserToWallet:F,removeUserFromWallet:U,loading:f,order:p,orderBy:y,sortedWallets:A,handleSort:e=>{C(y===e&&"asc"===p?"desc":"asc"),m(e)},selectedWallet:b,setSelectedWallet:v,walletUsers:k,loadWalletUsers:x},children:r})}},49271:(e,r,a)=>{"use strict";a.d(r,{A:()=>t});let t=new(a(54607)).UsersClient("https://inpulse.infotecrs.inf.br")},69770:(e,r,a)=>{Promise.resolve().then(a.bind(a,19453))},98892:(e,r,a)=>{"use strict";a.d(r,{c:()=>d,default:()=>f,Z:()=>h});var t=a(95155),s=a(12115);let c=new(a(54607)).AuthClient("https://inpulse.infotecrs.inf.br");var n=a(38543),l=a(23464),o=a(35695),u=a(42732),i=a(49271);let d=(0,s.createContext)({});function h(){let e=(0,s.useContext)(d);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}function f(e){let{children:r}=e,a=(0,o.useRouter)(),h=(0,o.usePathname)(),f=(0,s.useRef)(h.split("/")[1]),[g,y]=(0,s.useState)(null),[m,p]=(0,s.useState)(null),C=(0,s.useCallback)(async(e,r)=>{let{login:t,password:s}=r;try{let r=await c.login(e,t,s);localStorage.setItem("@inpulse/".concat(e,"/token"),r.token),f.current=e,y(r.user),p(r.token),l.A.defaults.headers.authorization="Bearer ".concat(r.token),a.replace("/".concat(e))}catch(e){n.oR.error("Falha ao logar!\n"+(0,u.sanitizeErrorMessage)(e))}},[a]),b=(0,s.useCallback)(()=>{p(null),localStorage.removeItem("@inpulse/".concat(f.current,"/token")),a.replace("/".concat(f.current,"/login")),y(null)},[a]);return(0,s.useEffect)(()=>{f.current=h.split("/")[1];let e=localStorage.getItem("@inpulse/".concat(f.current,"/token"));p(e),e&&(i.A.setAuth(e),c.fetchSessionData(e).then(async r=>{f.current=r.instance,l.A.defaults.headers.authorization="Bearer ".concat(e),i.A.setAuth("Bearer ".concat(e)),y(await i.A.getUserById(r.userId)),h.includes("login")&&a.replace("/".concat(f.current))}).catch(e=>{n.oR.error(e.message||"Sess\xe3o expirada, fa\xe7a o login novamente!"),localStorage.removeItem("@inpulse/".concat(f.current,"/token")),y(null),h.includes("login")||a.replace("/".concat(f.current,"/login"))})),e||h.includes("login")||a.replace("/".concat(f.current,"/login"))},[h,a]),(0,t.jsx)(d.Provider,{value:{user:g,token:m,isAuthenticated:!1,signIn:C,signOut:b,instance:f.current},children:r})}}},e=>{var r=r=>e(e.s=r);e.O(0,[4488,8441,1684,7358],()=>r(69770)),_N_E=e.O()}]);