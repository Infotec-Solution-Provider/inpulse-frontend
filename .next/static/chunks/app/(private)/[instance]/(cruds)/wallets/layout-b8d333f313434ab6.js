(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8604],{19453:(e,a,r)=>{"use strict";r.d(a,{default:()=>d,w:()=>i});var t=r(95155),s=r(98892),c=r(54607),l=r(42732),o=r(12115),n=r(38543);let u=r(49509).env.NEXT_PUBLIC_WALLETS_URL||"http://localhost:8005",i=(0,o.createContext)({});function d(e){let{children:a}=e,{token:r}=(0,s.Z)(),[d,h]=(0,o.useState)([]),[g,y]=(0,o.useState)(!0),[f,m]=(0,o.useState)("name"),[p,C]=(0,o.useState)("asc"),[v,k]=(0,o.useState)(null),[b,R]=(0,o.useState)([]),w=(0,o.useRef)(new c.WalletsClient(u));(0,o.useEffect)(()=>{r&&(w.current.setAuth(r),(async()=>{try{y(!0);let e=await w.current.getWallets();h(e)}catch(e){n.oR.error("Falha ao carregar as carteiras: ".concat((0,l.sanitizeErrorMessage)(e)))}finally{y(!1)}})())},[r]);let A=(0,o.useMemo)(()=>[...d].sort((e,a)=>{if("userIds"===f){var r,t;let s=(null===(r=e.userIds)||void 0===r?void 0:r.length)||0,c=(null===(t=a.userIds)||void 0===t?void 0:t.length)||0;return"asc"===p?s-c:c-s}let s=e[f],c=a[f];return s===c?0:null==s?1:null==c?-1:"string"==typeof s&&"string"==typeof c?"asc"===p?s.localeCompare(c):c.localeCompare(s):"asc"===p?Number(s)-Number(c):Number(c)-Number(s)}),[d,p,f]),E=(0,o.useCallback)(async e=>{try{y(!0);let a=await w.current.createWallet(e);return h(e=>[{...a,userIds:a.userIds||[]},...e]),n.oR.success("Carteira criada com sucesso!"),!0}catch(e){return n.oR.error("Falha ao criar carteira: ".concat((0,l.sanitizeErrorMessage)(e))),!1}finally{y(!1)}},[]),I=(0,o.useCallback)(async e=>{try{y(!0),await w.current.deleteWallet(e),h(a=>a.filter(a=>a.id!==e)),n.oR.success("Carteira excluida com sucesso!")}catch(e){n.oR.error("Falha ao excluir carteira: ".concat((0,l.sanitizeErrorMessage)(e)))}finally{y(!1)}},[]),S=(0,o.useCallback)(async(e,a)=>{try{y(!0),h(r=>r.map(r=>r.id===e?{...r,name:a}:r)),n.oR.success("Carteira atualizada!")}catch(e){n.oR.error("Falha ao atualizar carteira: ".concat((0,l.sanitizeErrorMessage)(e)))}finally{y(!1)}},[]),z=(0,o.useCallback)(async e=>{try{let a=await w.current.getWalletUsers(e);return Array.isArray(a)?a:[]}catch(e){return n.oR.error("Falha ao buscar usu\xe1rios: ".concat((0,l.sanitizeErrorMessage)(e))),[]}},[]),M=(0,o.useCallback)(async(e,a)=>{try{return await w.current.getUserWallets(e,a)}catch(e){return n.oR.error("Falha ao buscar carteiras do usu\xe1rio: ".concat((0,l.sanitizeErrorMessage)(e))),[]}},[]),F=(0,o.useCallback)(async e=>{if(v)try{y(!0);let a=await w.current.addUserToWallet(v.id,e);h(r=>r.map(r=>r.id===v.id?{...a,userIds:Array.isArray(a.userIds)?a.userIds:[...r.userIds||[],e]}:r)),R(a=>[...a||[],e]),n.oR.success("Usu\xe1rio adicionado com sucesso!")}catch(e){n.oR.error("Falha ao adicionar usu\xe1rio: ".concat((0,l.sanitizeErrorMessage)(e)))}finally{y(!1)}},[v]),U=(0,o.useCallback)(async e=>{if(v)try{y(!0),await w.current.removeUserFromWallet(v.id,e),h(a=>a.map(a=>a.id===v.id?{...a,userIds:a.userIds.filter(a=>a!==e)}:a)),R(a=>a.filter(a=>a!==e)),n.oR.success("Usu\xe1rio removido com sucesso!")}catch(e){n.oR.error("Falha ao remover usu\xe1rio: ".concat((0,l.sanitizeErrorMessage)(e)))}finally{y(!1)}},[v]),x=(0,o.useCallback)(async()=>{if(v)try{let e=await z(v.id);R(e)}catch(e){n.oR.error("Error loading users: ".concat((0,l.sanitizeErrorMessage)(e)))}},[v,z]);return(0,t.jsx)(i.Provider,{value:{walletsApi:w,wallets:d,createWallet:E,deleteWallet:I,updateWalletName:S,getWalletUsers:z,getUserWallets:M,addUserToWallet:F,removeUserFromWallet:U,loading:g,order:p,orderBy:f,sortedWallets:A,handleSort:e=>{C(f===e&&"asc"===p?"desc":"asc"),m(e)},selectedWallet:v,setSelectedWallet:k,walletUsers:b,loadWalletUsers:x},children:a})}},49271:(e,a,r)=>{"use strict";r.d(a,{A:()=>t});let t=new(r(54607)).UsersClient("http://localhost:8001")},69770:(e,a,r)=>{Promise.resolve().then(r.bind(r,19453))},98892:(e,a,r)=>{"use strict";r.d(a,{c:()=>d,default:()=>g,Z:()=>h});var t=r(95155),s=r(12115);let c=new(r(54607)).AuthClient("http://localhost:8001");var l=r(38543),o=r(23464),n=r(35695),u=r(42732),i=r(49271);let d=(0,s.createContext)({});function h(){let e=(0,s.useContext)(d);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}function g(e){let{children:a}=e,r=(0,n.useRouter)(),h=(0,n.usePathname)(),g=(0,s.useRef)(h.split("/")[1]),[y,f]=(0,s.useState)(null),[m,p]=(0,s.useState)(null),C=(0,s.useCallback)(async(e,a)=>{let{login:t,password:s}=a;try{let a=await c.login(e,t,s);localStorage.setItem("@inpulse/".concat(e,"/token"),a.token),g.current=e,f(a.user),p(a.token),o.A.defaults.headers.authorization="Bearer ".concat(a.token),r.replace("/".concat(e))}catch(e){l.oR.error("Falha ao logar!\n"+(0,u.sanitizeErrorMessage)(e))}},[r]),v=(0,s.useCallback)(()=>{p(null),localStorage.removeItem("@inpulse/".concat(g.current,"/token")),r.replace("/".concat(g.current,"/login")),f(null)},[r]);return(0,s.useEffect)(()=>{g.current=h.split("/")[1];let e=localStorage.getItem("@inpulse/".concat(g.current,"/token"));p(e),e&&(i.A.setAuth(e),c.fetchSessionData(e).then(async a=>{g.current=a.instance,o.A.defaults.headers.authorization="Bearer ".concat(e),i.A.setAuth("Bearer ".concat(e)),f(await i.A.getUserById(a.userId)),h.includes("login")&&r.replace("/".concat(g.current))}).catch(e=>{l.oR.error(e.message||"Sess\xe3o expirada, fa\xe7a o login novamente!"),localStorage.removeItem("@inpulse/".concat(g.current,"/token")),f(null),h.includes("login")||r.replace("/".concat(g.current,"/login"))})),e||h.includes("login")||r.replace("/".concat(g.current,"/login"))},[h,r]),(0,t.jsx)(d.Provider,{value:{user:y,token:m,isAuthenticated:!1,signIn:C,signOut:v,instance:g.current},children:a})}}},e=>{var a=a=>e(e.s=a);e.O(0,[4488,8441,1684,7358],()=>a(69770)),_N_E=e.O()}]);