(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4147],{19453:(e,a,r)=>{"use strict";r.d(a,{default:()=>u,w:()=>d});var t=r(95155),s=r(98892),l=r(54607),n=r(42732),i=r(12115),c=r(38543);let o=r(49509).env.NEXT_PUBLIC_WALLETS_URL||"http://localhost:8005",d=(0,i.createContext)({});function u(e){let{children:a}=e,{token:r}=(0,s.Z)(),[u,x]=(0,i.useState)([]),[h,m]=(0,i.useState)(!0),[f,p]=(0,i.useState)("name"),[g,j]=(0,i.useState)("asc"),[y,v]=(0,i.useState)(null),[A,b]=(0,i.useState)([]),C=(0,i.useRef)(new l.WalletsClient(o));(0,i.useEffect)(()=>{r&&(C.current.setAuth(r),(async()=>{try{m(!0);let e=await C.current.getWallets();x(e)}catch(e){c.oR.error("Falha ao carregar as carteiras: ".concat((0,n.sanitizeErrorMessage)(e)))}finally{m(!1)}})())},[r]);let w=(0,i.useMemo)(()=>[...u].sort((e,a)=>{if("userIds"===f){var r,t;let s=(null===(r=e.userIds)||void 0===r?void 0:r.length)||0,l=(null===(t=a.userIds)||void 0===t?void 0:t.length)||0;return"asc"===g?s-l:l-s}let s=e[f],l=a[f];return s===l?0:null==s?1:null==l?-1:"string"==typeof s&&"string"==typeof l?"asc"===g?s.localeCompare(l):l.localeCompare(s):"asc"===g?Number(s)-Number(l):Number(l)-Number(s)}),[u,g,f]),N=(0,i.useCallback)(async e=>{try{m(!0);let a=await C.current.createWallet(e);return x(e=>[{...a,userIds:a.userIds||[]},...e]),c.oR.success("Carteira criada com sucesso!"),!0}catch(e){return c.oR.error("Falha ao criar carteira: ".concat((0,n.sanitizeErrorMessage)(e))),!1}finally{m(!1)}},[]),k=(0,i.useCallback)(async e=>{try{m(!0),await C.current.deleteWallet(e),x(a=>a.filter(a=>a.id!==e)),c.oR.success("Carteira excluida com sucesso!")}catch(e){c.oR.error("Falha ao excluir carteira: ".concat((0,n.sanitizeErrorMessage)(e)))}finally{m(!1)}},[]),S=(0,i.useCallback)(async(e,a)=>{try{m(!0),x(r=>r.map(r=>r.id===e?{...r,name:a}:r)),c.oR.success("Carteira atualizada!")}catch(e){c.oR.error("Falha ao atualizar carteira: ".concat((0,n.sanitizeErrorMessage)(e)))}finally{m(!1)}},[]),I=(0,i.useCallback)(async e=>{try{let a=await C.current.getWalletUsers(e);return Array.isArray(a)?a:[]}catch(e){return c.oR.error("Falha ao buscar usu\xe1rios: ".concat((0,n.sanitizeErrorMessage)(e))),[]}},[]),R=(0,i.useCallback)(async(e,a)=>{try{return await C.current.getUserWallets(e,a)}catch(e){return c.oR.error("Falha ao buscar carteiras do usu\xe1rio: ".concat((0,n.sanitizeErrorMessage)(e))),[]}},[]),E=(0,i.useCallback)(async e=>{if(y)try{m(!0);let a=await C.current.addUserToWallet(y.id,e);x(r=>r.map(r=>r.id===y.id?{...a,userIds:Array.isArray(a.userIds)?a.userIds:[...r.userIds||[],e]}:r)),b(a=>[...a||[],e]),c.oR.success("Usu\xe1rio adicionado com sucesso!")}catch(e){c.oR.error("Falha ao adicionar usu\xe1rio: ".concat((0,n.sanitizeErrorMessage)(e)))}finally{m(!1)}},[y]),z=(0,i.useCallback)(async e=>{if(y)try{m(!0),await C.current.removeUserFromWallet(y.id,e),x(a=>a.map(a=>a.id===y.id?{...a,userIds:a.userIds.filter(a=>a!==e)}:a)),b(a=>a.filter(a=>a!==e)),c.oR.success("Usu\xe1rio removido com sucesso!")}catch(e){c.oR.error("Falha ao remover usu\xe1rio: ".concat((0,n.sanitizeErrorMessage)(e)))}finally{m(!1)}},[y]),M=(0,i.useCallback)(async()=>{if(y)try{let e=await I(y.id);b(e)}catch(e){c.oR.error("Error loading users: ".concat((0,n.sanitizeErrorMessage)(e)))}},[y,I]);return(0,t.jsx)(d.Provider,{value:{walletsApi:C,wallets:u,createWallet:N,deleteWallet:k,updateWalletName:S,getWalletUsers:I,getUserWallets:R,addUserToWallet:E,removeUserFromWallet:z,loading:h,order:g,orderBy:f,sortedWallets:w,handleSort:e=>{j(f===e&&"asc"===g?"desc":"asc"),p(e)},selectedWallet:y,setSelectedWallet:v,walletUsers:A,loadWalletUsers:M},children:a})}},49271:(e,a,r)=>{"use strict";r.d(a,{A:()=>t});let t=new(r(54607)).UsersClient("https://inpulse.infotecrs.inf.br")},51259:(e,a,r)=>{Promise.resolve().then(r.bind(r,88495))},88495:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>q});var t=r(95155),s=r(54492),l=r(73731),n=r(68534),i=r(27088),c=r(17348),o=r(16675),d=r(76380),u=r(63148),x=r(65528),h=r(85222),m=r(3947),f=r(69242),p=r(12115),g=r(19453),j=r(75955),y=r(56278),v=r(3127),A=r(49994);let b=(0,j.Ay)(y.A)(()=>({"& .MuiPaper-root":{borderRadius:"0px",overflow:"hidden"}})),C=(0,j.Ay)(s.A)(()=>({alignSelf:"center",padding:0,paddingTop:"8px",display:"flex",color:"white"})),w=(0,j.Ay)(v.A)(e=>{let{theme:a}=e;return{fontSize:18,color:a.palette.primary.light}});(0,j.Ay)(A.A)(()=>({"& .MuiTabs-flexContainer":{justifyContent:"center",gap:2},"& .MuiTab-root":{flex:"1 0 0"}}));var N=r(49271);function k(){let{selectedWallet:e,setSelectedWallet:a,updateWalletName:r,walletUsers:j=[],addUserToWallet:y,removeUserFromWallet:v,loadWalletUsers:A}=(0,p.useContext)(g.w),[C,k]=(0,p.useState)(""),[S,I]=(0,p.useState)(""),[R,E]=(0,p.useState)(!1),[z,M]=(0,p.useState)([]);(0,p.useEffect)(()=>{(async()=>{if(e)try{E(!0),await (null==A?void 0:A());let e=await N.A.getUsers({perPage:"1000"});M(e.data)}finally{E(!1)}})()},[e,A]);let P=async()=>{e&&(await r(e.id,C),a(null))},W=async()=>{if(S&&e)try{await y(Number(S)),I(""),await (null==A?void 0:A())}catch(e){console.error("Error adding user:",e)}};return e?(0,t.jsx)(b,{open:!!e,onClose:()=>a(null),fullWidth:!0,maxWidth:"sm",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 px-[2rem] py-[2rem] bg-slate-800 h-[85vh] min-h-0",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)(s.A,{sx:{alignSelf:"center",padding:0,color:"white"},children:["Gerenciar: ",e.name]}),(0,t.jsx)(w,{"aria-label":"close",onClick:()=>a(null),children:(0,t.jsx)(f.A,{})})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(l.A,{label:"Novo nome",value:C,onChange:e=>k(e.target.value),fullWidth:!0,margin:"normal",size:"small",sx:{margin:0}}),(0,t.jsx)(n.A,{variant:"contained",onClick:P,disabled:!C,sx:{height:"40px",width:"150px",alignSelf:"center"},children:"Salvar"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 flex-1 min-h-0",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(i.A,{fullWidth:!0,size:"small",children:[(0,t.jsx)(c.A,{id:"user-select-label",children:"Adicionar integrante"}),(0,t.jsxs)(o.A,{labelId:"user-select-label",value:S,onChange:e=>I(e.target.value),label:"Adicionar integrante",children:[(0,t.jsx)(d.A,{value:"",disabled:!0,children:(0,t.jsx)("em",{children:"Selecione um usu\xe1rio"})}),z.map(e=>(0,t.jsx)(d.A,{value:e.CODIGO.toString(),children:e.NOME},e.CODIGO))]})]}),(0,t.jsx)(n.A,{variant:"contained",onClick:W,disabled:!S,sx:{minWidth:120},children:"Adicionar"})]}),(0,t.jsxs)("div",{className:"flex flex-col p-2 border-[1px] rounded border-slate-600 min-h-0 flex-1",children:[(0,t.jsx)("h1",{className:"p-2 border-b-[1px] border-blue-500",children:"Integrantes"}),(0,t.jsx)("div",{className:"px-2 mt-2 flex-1 min-h-0 scrollbar-whatsapp",children:R?(0,t.jsx)("div",{className:"flex justify-center py-4",children:(0,t.jsx)(m.A,{className:"animate-spin"})}):(0,t.jsx)(u.A,{dense:!0,sx:{maxHeight:300,overflow:"auto"},children:j.map(e=>{let a=z.find(a=>a.CODIGO===e);return(0,t.jsxs)(x.Ay,{divider:!0,children:[(0,t.jsx)(h.A,{primary:a?a.NOME:"Usu\xe1rio #".concat(e),secondary:"ID: ".concat(e)}),(0,t.jsx)(n.A,{color:"error",size:"small",onClick:async()=>{confirm("Tem certeza que deseja remover este usu\xe1rio?")&&(await (null==v?void 0:v(e)),await (null==A?void 0:A()))},children:"Remover"})]},e)})})})]})]})]})}):null}var S=r(99776),I=r(90404),R=r(44296),E=r(17976),z=r(56033),M=r(14311),P=r(2044),W=r(11247),U=r(19505),F=r(59832),O=r(58416),D=r(9560);let _=(0,j.Ay)(F.A)(e=>{let{theme:a}=e;return{border:"none",["&.".concat(O.A.head)]:{color:a.palette.text.primary},["&.".concat(O.A.body)]:{fontSize:14,color:a.palette.text.primary}}}),T=(0,j.Ay)(I.A)(()=>({"&:nth-of-type(even)":{backgroundColor:"rgba(67, 56, 202, 0.05)"},"&:last-child td, &:last-child th":{border:0}}));function L(e){var a;let{wallet:r,index:s}=e,{setSelectedWallet:l,deleteWallet:n}=(0,p.useContext)(g.w);return(0,t.jsxs)(I.A,{sx:{background:s%2==0?"transparent":"rgba(67, 56, 202, 0.05)"},children:[(0,t.jsx)(_,{className:"px-2 py-3",children:(0,t.jsx)("div",{className:"flex justify-center",children:r.id})}),(0,t.jsx)(_,{className:"px-2 py-3",children:(0,t.jsx)("div",{className:"flex justify-center",children:r.name})}),(0,t.jsx)(_,{className:"px-2 py-3",children:(0,t.jsx)("div",{className:"flex justify-center",children:null===(a=r.userIds)||void 0===a?void 0:a.length})}),(0,t.jsx)(_,{className:"px-2 py-3",children:(0,t.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,t.jsx)(W.A,{className:"cursor-pointer hover:text-blue-500",onClick:()=>l(r)}),(0,t.jsx)(U.A,{className:"cursor-pointer hover:text-red-500",onClick:()=>{confirm("Tem certeza que deseja excluir esta carteira?")&&n(r.id)}})]})})]})}function B(){let{createWallet:e,loading:a}=(0,p.useContext)(g.w),[r,s]=(0,p.useState)(!1),[i,c]=(0,p.useState)({name:""}),o=async()=>{if(!i.name)return;let a=await e(i.name);console.log("form:",a),a&&(c({name:""}),s(!1))};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.A,{variant:"outlined",onClick:()=>s(!0),children:"Cadastrar carteira"}),(0,t.jsx)(b,{open:r,onClose:()=>s(!1),children:(0,t.jsxs)("div",{className:"flex flex-col gap-6 px-[2rem] py-[1rem] bg-slate-800",children:[(0,t.jsx)(C,{children:"Criar nova carteira"}),(0,t.jsx)("div",{className:"flex flex-col gap-4",children:(0,t.jsx)(l.A,{label:"Nome",value:i.name,onChange:e=>c(a=>({...a,name:e.target.value}))})}),(0,t.jsxs)("div",{className:"flex w-full flex-row justify-end gap-4 pt-[1rem] border-t-[2px] border-blue-500",children:[(0,t.jsx)(n.A,{color:"error",onClick:()=>s(!1),children:"Cancelar"}),(0,t.jsx)(n.A,{onClick:o,variant:"contained",disabled:!i.name||a,children:a?"Criando...":"Criar"})]})]})})]})}function G(){let{wallets:e,loading:a,order:r,orderBy:s,handleSort:l,sortedWallets:n}=(0,p.useContext)(g.w),[i,c]=(0,p.useState)(0),[o,d]=(0,p.useState)(10);(0,p.useEffect)(()=>c(0),[e]);let u=(0,p.useMemo)(()=>!a&&n.length>0?(0,t.jsx)(S.A,{children:n.slice(i*o,(i+1)*o).map((e,a)=>(0,t.jsx)(L,{wallet:e,index:a+10*i},"".concat(e.name,"_").concat(e.id)))}):a?(0,t.jsx)(S.A,{children:(0,t.jsx)(I.A,{children:(0,t.jsx)(_,{colSpan:4,children:(0,t.jsx)("div",{className:"flex justify-center w-full",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(m.A,{className:"animate-spin"}),(0,t.jsx)("p",{className:"flex w-full px-2 items-center align-middle justify-center",children:" Carregando carteiras"})]})})})})}):(0,t.jsx)(S.A,{children:(0,t.jsx)(I.A,{children:(0,t.jsx)(_,{colSpan:4,children:(0,t.jsx)("div",{className:"flex justify-center w-full",children:(0,t.jsx)("div",{className:"flex",children:(0,t.jsx)("p",{className:"flex w-full px-2 items-center align-middle justify-center",children:"Nenhuma carteira encontrada"})})})})})}),[n,i,o,a]);return(0,t.jsxs)("div",{className:"relative flex flex-col h-[calc(100vh-100px)]",children:[(0,t.jsx)(R.A,{className:"mx-auto w-full bg-indigo-700 bg-opacity-5 shadow-md flex-1",children:(0,t.jsxs)(E.A,{children:[(0,t.jsx)(z.A,{children:(0,t.jsxs)(T,{className:"sticky top-0 rounded-md bg-indigo-900",children:[(0,t.jsx)(_,{sx:{width:"70px"},sortDirection:"id"===s&&r,children:(0,t.jsx)(M.A,{active:"id"===s,direction:"id"===s?r:"asc",onClick:()=>l("id"),sx:{display:"flex",justifyContent:"center",paddingLeft:"25px"},children:"ID"})}),(0,t.jsx)(_,{sx:{width:"250px"},sortDirection:"name"===s&&r,children:(0,t.jsx)(M.A,{active:"name"===s,direction:"name"===s?r:"asc",onClick:()=>l("name"),sx:{display:"flex",justifyContent:"center",paddingLeft:"25px"},children:"Nome"})}),(0,t.jsx)(_,{sortDirection:"userIds"===s&&r,children:(0,t.jsx)(M.A,{active:"userIds"===s,direction:"userIds"===s?r:"asc",onClick:()=>l("userIds"),sx:{display:"flex",justifyContent:"center",paddingLeft:"25px"},children:"N\xfamero de integrantes"})}),(0,t.jsx)(_,{sx:{textAlign:"center"},children:"A\xe7\xf5es"})]})}),u]})}),(0,t.jsxs)("div",{className:"flex gap-4 sticky bottom-0 self-center pt-4 pb-2",children:[(0,t.jsx)(B,{}),(0,t.jsx)(P.A,{component:"div",count:e.length,page:i,onPageChange:(e,a)=>{c(a)},rowsPerPage:o,onRowsPerPageChange:e=>{d(parseInt(e.target.value,10)),c(0)},rowsPerPageOptions:[10,25,50],labelDisplayedRows:e=>{let{from:a,to:r,count:t}=e;return"".concat(a,"-").concat(r," de ").concat(-1!==t?t:"mais de ".concat(r))},labelRowsPerPage:"Carteiras por p\xe1gina:"})]})]})}function q(){return(0,t.jsxs)("div",{className:"flex flex-col max-w-[75rem] mx-auto px-10 pt-5 h-screen box-border relative",children:[(0,t.jsx)(G,{}),(0,t.jsx)(k,{})]})}(0,j.Ay)(P.A)(e=>{let{theme:a}=e;return{["& .".concat(D.A.root)]:{color:a.palette.text.primary,"&.Mui-selected":{backgroundColor:a.palette.primary.main,color:a.palette.text.primary},"&:hover":{backgroundColor:a.palette.primary.main,color:a.palette.text.primary}}}})},98892:(e,a,r)=>{"use strict";r.d(a,{c:()=>u,default:()=>h,Z:()=>x});var t=r(95155),s=r(12115);let l=new(r(54607)).AuthClient("https://inpulse.infotecrs.inf.br");var n=r(38543),i=r(23464),c=r(35695),o=r(42732),d=r(49271);let u=(0,s.createContext)({});function x(){let e=(0,s.useContext)(u);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}function h(e){let{children:a}=e,r=(0,c.useRouter)(),x=(0,c.usePathname)(),h=(0,s.useRef)(x.split("/")[1]),[m,f]=(0,s.useState)(null),[p,g]=(0,s.useState)(null),j=(0,s.useCallback)(async(e,a)=>{let{login:t,password:s}=a;try{let a=await l.login(e,t,s);localStorage.setItem("@inpulse/".concat(e,"/token"),a.token),h.current=e,f(a.user),g(a.token),i.A.defaults.headers.authorization="Bearer ".concat(a.token),r.replace("/".concat(e))}catch(e){n.oR.error("Falha ao logar!\n"+(0,o.sanitizeErrorMessage)(e))}},[r]),y=(0,s.useCallback)(()=>{g(null),localStorage.removeItem("@inpulse/".concat(h.current,"/token")),r.replace("/".concat(h.current,"/login")),f(null)},[r]);return(0,s.useEffect)(()=>{h.current=x.split("/")[1];let e=localStorage.getItem("@inpulse/".concat(h.current,"/token"));g(e),e&&(d.A.setAuth(e),l.fetchSessionData(e).then(async a=>{h.current=a.instance,i.A.defaults.headers.authorization="Bearer ".concat(e),d.A.setAuth("Bearer ".concat(e)),f(await d.A.getUserById(a.userId)),x.includes("login")&&r.replace("/".concat(h.current))}).catch(e=>{n.oR.error(e.message||"Sess\xe3o expirada, fa\xe7a o login novamente!"),localStorage.removeItem("@inpulse/".concat(h.current,"/token")),f(null),x.includes("login")||r.replace("/".concat(h.current,"/login"))})),e||x.includes("login")||r.replace("/".concat(h.current,"/login"))},[x,r]),(0,t.jsx)(u.Provider,{value:{user:m,token:p,isAuthenticated:!1,signIn:j,signOut:y,instance:h.current},children:a})}}},e=>{var a=a=>e(e.s=a);e.O(0,[4488,9141,8534,6805,5332,4290,4805,5329,1631,8441,1684,7358],()=>a(51259)),_N_E=e.O()}]);