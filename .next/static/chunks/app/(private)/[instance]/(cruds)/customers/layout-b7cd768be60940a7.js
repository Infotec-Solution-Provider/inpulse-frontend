(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[263],{49271:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=new(r(54607)).UsersClient("https://inpulse.infotecrs.inf.br")},51505:(e,t,r)=>{Promise.resolve().then(r.bind(r,71829))},64569:(e,t,r)=>{"use strict";r.d(t,{pI:()=>l,Ay:()=>g,qw:()=>i});var a=r(95155),s=r(12115),n=r(54607),o=r(98892),c=r(42732),u=r(38543);let l=(0,s.createContext)({}),i=()=>(0,s.useContext)(l);function g(e){let{children:t}=e,r=(0,s.useRef)(new n.CustomersClient("https://inpulse.infotecrs.inf.br")),{token:i}=(0,o.Z)(),[g,d]=(0,s.useReducer)(function e(t,r){let a={...t};switch(r.type){case"change-loading":return{...a,isLoading:r.isLoading};case"change-page":return a.filters.page=r.page.toString(),a;case"change-per-page":return a.filters.perPage=r.perPage.toString(),a;case"change-total-rows":return a.totalRows=r.totalRows,{...a,totalRows:r.totalRows};case"change-filters":return a.filters={page:t.filters.page,perPage:t.filters.perPage,...r.filters},a;case"load-customers":return a.customers=r.customers,a;case"update-customer":return{...a,customers:a.customers.map(e=>e.CODIGO===r.id?{...e,...r.data}:e)};case"add-customer":return a.customers.unshift(r.data),a;case"multiple":let s={...t};for(let t of r.actions)s=e(s,t);return s;default:return a}},{customers:[],totalRows:0,filters:{},isLoading:!1}),p=(0,s.useCallback)(async e=>{try{i&&(await r.current.createCustomer(e),u.oR.success("Cliente cadastrado com sucesso!"))}catch(e){c.Logger.error("Error creating customer",e),u.oR.error("Falha ao cadastrar cliente!")}finally{f()}},[i]),h=(0,s.useCallback)(async(e,t)=>{try{i&&(await r.current.updateCustomer(e,t),d({type:"update-customer",id:e,data:t}),u.oR.success("Cliente atualizado com sucesso!"))}catch(e){c.Logger.error("Error updating customer",e),u.oR.error("Falha ao atualizar cliente!")}},[i]),f=(0,s.useCallback)(async()=>{d({type:"change-loading",isLoading:!0});try{let e=await r.current.getCustomers(g.filters);d({type:"multiple",actions:[{type:"change-total-rows",totalRows:e.page.totalRows},{type:"change-loading",isLoading:!1},{type:"load-customers",customers:e.data}]})}catch(e){d({type:"change-loading",isLoading:!1}),c.Logger.error("Error loading customers",e),u.oR.error("Falha ao carregar clientes!")}},[]);return(0,s.useEffect)(()=>{i&&r.current&&(r.current.setAuth(i),f())},[i,r.current]),(0,a.jsx)(l.Provider,{value:{state:g,dispatch:d,updateCustomer:h,createCustomer:p,loadCustomers:f},children:t})}},71829:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(95155),s=r(64569);function n(e){let{children:t}=e;return(0,a.jsx)(s.Ay,{children:t})}},98892:(e,t,r)=>{"use strict";r.d(t,{c:()=>g,default:()=>p,Z:()=>d});var a=r(95155),s=r(12115);let n=new(r(54607)).AuthClient("https://inpulse.infotecrs.inf.br");var o=r(38543),c=r(23464),u=r(35695),l=r(42732),i=r(49271);let g=(0,s.createContext)({});function d(){let e=(0,s.useContext)(g);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}function p(e){let{children:t}=e,r=(0,u.useRouter)(),d=(0,u.usePathname)(),p=(0,s.useRef)(d.split("/")[1]),[h,f]=(0,s.useState)(null),[m,w]=(0,s.useState)(null),C=(0,s.useCallback)(async(e,t)=>{let{login:a,password:s}=t;try{let t=await n.login(e,a,s);localStorage.setItem("@inpulse/".concat(e,"/token"),t.token),p.current=e,f(t.user),w(t.token),c.A.defaults.headers.authorization="Bearer ".concat(t.token),r.replace("/".concat(e))}catch(e){o.oR.error("Falha ao logar!\n"+(0,l.sanitizeErrorMessage)(e))}},[r]),y=(0,s.useCallback)(()=>{w(null),localStorage.removeItem("@inpulse/".concat(p.current,"/token")),r.replace("/".concat(p.current,"/login")),f(null)},[r]);return(0,s.useEffect)(()=>{p.current=d.split("/")[1];let e=localStorage.getItem("@inpulse/".concat(p.current,"/token"));w(e),e&&(i.A.setAuth(e),n.fetchSessionData(e).then(async t=>{p.current=t.instance,c.A.defaults.headers.authorization="Bearer ".concat(e),i.A.setAuth("Bearer ".concat(e)),f(await i.A.getUserById(t.userId)),d.includes("login")&&r.replace("/".concat(p.current))}).catch(e=>{o.oR.error(e.message||"Sess\xe3o expirada, fa\xe7a o login novamente!"),localStorage.removeItem("@inpulse/".concat(p.current,"/token")),f(null),d.includes("login")||r.replace("/".concat(p.current,"/login"))})),e||d.includes("login")||r.replace("/".concat(p.current,"/login"))},[d,r]),(0,a.jsx)(g.Provider,{value:{user:h,token:m,isAuthenticated:!1,signIn:C,signOut:y,instance:p.current},children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4488,8441,1684,7358],()=>t(51505)),_N_E=e.O()}]);