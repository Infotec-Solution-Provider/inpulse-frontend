(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[263],{49271:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=new(r(54607)).UsersClient("http://localhost:8001")},51505:(e,t,r)=>{Promise.resolve().then(r.bind(r,71829))},64569:(e,t,r)=>{"use strict";r.d(t,{pI:()=>u,Ay:()=>g,qw:()=>i});var a=r(95155),s=r(12115),o=r(54607),c=r(98892),n=r(42732),l=r(38543);let u=(0,s.createContext)({}),i=()=>(0,s.useContext)(u);function g(e){let{children:t}=e,r=(0,s.useRef)(new o.CustomersClient("http://localhost:8002")),{token:i}=(0,c.Z)(),[g,d]=(0,s.useReducer)(function e(t,r){let a={...t};switch(r.type){case"change-loading":return{...a,isLoading:r.isLoading};case"change-page":return a.filters.page=r.page.toString(),a;case"change-per-page":return a.filters.perPage=r.perPage.toString(),a;case"change-total-rows":return a.totalRows=r.totalRows,{...a,totalRows:r.totalRows};case"change-filters":return a.filters={page:t.filters.page,perPage:t.filters.perPage,...r.filters},a;case"load-customers":return a.customers=r.customers,a;case"update-customer":return{...a,customers:a.customers.map(e=>e.CODIGO===r.id?{...e,...r.data}:e)};case"add-customer":return a.customers.unshift(r.data),a;case"multiple":let s={...t};for(let t of r.actions)s=e(s,t);return s;default:return a}},{customers:[],totalRows:0,filters:{},isLoading:!1}),h=(0,s.useCallback)(async e=>{try{i&&(await r.current.createCustomer(e),l.oR.success("Cliente cadastrado com sucesso!"))}catch(e){n.Logger.error("Error creating customer",e),l.oR.error("Falha ao cadastrar cliente!")}finally{m()}},[i]),p=(0,s.useCallback)(async(e,t)=>{try{i&&(await r.current.updateCustomer(e,t),d({type:"update-customer",id:e,data:t}),l.oR.success("Cliente atualizado com sucesso!"))}catch(e){n.Logger.error("Error updating customer",e),l.oR.error("Falha ao atualizar cliente!")}},[i]),m=(0,s.useCallback)(async()=>{d({type:"change-loading",isLoading:!0});try{let e=await r.current.getCustomers(g.filters);d({type:"multiple",actions:[{type:"change-total-rows",totalRows:e.page.totalRows},{type:"change-loading",isLoading:!1},{type:"load-customers",customers:e.data}]})}catch(e){d({type:"change-loading",isLoading:!1}),n.Logger.error("Error loading customers",e),l.oR.error("Falha ao carregar clientes!")}},[]);return(0,s.useEffect)(()=>{i&&r.current&&(r.current.setAuth(i),m())},[i,r.current]),(0,a.jsx)(u.Provider,{value:{state:g,dispatch:d,updateCustomer:p,createCustomer:h,loadCustomers:m},children:t})}},71829:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var a=r(95155),s=r(64569);function o(e){let{children:t}=e;return(0,a.jsx)(s.Ay,{children:t})}},98892:(e,t,r)=>{"use strict";r.d(t,{c:()=>g,default:()=>h,Z:()=>d});var a=r(95155),s=r(12115);let o=new(r(54607)).AuthClient("http://localhost:8001");var c=r(38543),n=r(23464),l=r(35695),u=r(42732),i=r(49271);let g=(0,s.createContext)({});function d(){let e=(0,s.useContext)(g);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}function h(e){let{children:t}=e,r=(0,l.useRouter)(),d=(0,l.usePathname)(),h=(0,s.useRef)(d.split("/")[1]),[p,m]=(0,s.useState)(null),[f,w]=(0,s.useState)(null),C=(0,s.useCallback)(async(e,t)=>{let{login:a,password:s}=t;try{let t=await o.login(e,a,s);localStorage.setItem("@inpulse/".concat(e,"/token"),t.token),h.current=e,m(t.user),w(t.token),n.A.defaults.headers.authorization="Bearer ".concat(t.token),r.replace("/".concat(e))}catch(e){c.oR.error("Falha ao logar!\n"+(0,u.sanitizeErrorMessage)(e))}},[r]),y=(0,s.useCallback)(()=>{w(null),localStorage.removeItem("@inpulse/".concat(h.current,"/token")),r.replace("/".concat(h.current,"/login")),m(null)},[r]);return(0,s.useEffect)(()=>{h.current=d.split("/")[1];let e=localStorage.getItem("@inpulse/".concat(h.current,"/token"));w(e),e&&(i.A.setAuth(e),o.fetchSessionData(e).then(async t=>{h.current=t.instance,n.A.defaults.headers.authorization="Bearer ".concat(e),i.A.setAuth("Bearer ".concat(e)),m(await i.A.getUserById(t.userId)),d.includes("login")&&r.replace("/".concat(h.current))}).catch(e=>{c.oR.error(e.message||"Sess\xe3o expirada, fa\xe7a o login novamente!"),localStorage.removeItem("@inpulse/".concat(h.current,"/token")),m(null),d.includes("login")||r.replace("/".concat(h.current,"/login"))})),e||d.includes("login")||r.replace("/".concat(h.current,"/login"))},[d,r]),(0,a.jsx)(g.Provider,{value:{user:p,token:f,isAuthenticated:!1,signIn:C,signOut:y,instance:h.current},children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4488,8441,1684,7358],()=>t(51505)),_N_E=e.O()}]);