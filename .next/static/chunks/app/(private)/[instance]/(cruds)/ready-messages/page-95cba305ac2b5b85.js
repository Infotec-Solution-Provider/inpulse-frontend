(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6977],{25232:(e,l,t)=>{"use strict";t.d(l,{A:()=>a});let a=new(t(54607)).FilesClient("http://localhost:8003")},62083:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>U});var a=t(95155),r=t(78286),s=t(42732),n=t(44296),i=t(17976),c=t(3127),o=t(68534),d=t(11247),u=t(92697),x=t(700),m=t(73731),h=t(76380),p=t(9049),g=t(18407),f=t(63148),v=t(22376),j=t(16460),w=t(12115),A=t(38543),y=t(54581),b=t(74964),C=t(85222),N=t(69242);let R=e=>{let{onSelect:l,onClose:t}=e,{variables:s}=(0,r.m)();return(0,a.jsxs)(y.A,{children:[(0,a.jsxs)(y.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(x.A,{variant:"h6",children:"Selecione a vari\xe1vel"}),(0,a.jsx)(c.A,{onClick:t,size:"small",children:(0,a.jsx)(N.A,{})})]}),(0,a.jsx)(b.A,{}),(0,a.jsx)(f.A,{dense:!0,disablePadding:!0,children:null==s?void 0:s.map(e=>(0,a.jsx)(v.A,{onClick:()=>{l(e.name),t()},sx:{borderRadius:1},children:(0,a.jsx)(C.A,{primary:e.name})},"var_".concat(e.name)))})]})};var S=t(25232),O=t(98892),T=t(88702);function E(e){let{readyMessage:l,onSubmit:t}=e,{closeModal:s}=(0,u.Us)(),{sectors:n}=(0,T.jb)(),{variables:i=[]}=(0,r.m)()||{},{user:c,instance:d}=(0,w.useContext)(O.c),[y,b]=(0,w.useState)(l.TITULO||""),[C,N]=(0,w.useState)(l.TEXTO_MENSAGEM||""),[E,k]=(0,w.useState)(l.SETOR||null),[M,I]=(0,w.useState)(null),_=(0,w.useRef)(null),U=(0,w.useRef)(null),F=(0,w.useRef)(null),[W,L]=(0,w.useState)(!1),[D,G]=(0,w.useState)(null),[z,V]=(0,w.useState)("");(0,w.useEffect)(()=>{l.ARQUIVO&&I(S.A.getFileDownloadUrl(l.SETOR))},[l]);let Q=e=>{if(!F.current)return;let l=F.current,t=l.selectionStart||0,a=C.slice(0,t),r=C.slice(t),s=a.lastIndexOf("@");!(s<0)&&(N(a.slice(0,s)+e+r),G(null),setTimeout(()=>{let t=s+e.length;l.focus(),l.setSelectionRange(t,t)},0))},q=i.filter(e=>e.name.toLowerCase().includes(z.toLowerCase())),P=async()=>{if(y.length<6){A.oR.error("T\xedtulo deve ter pelo menos 6 caracteres");return}if(C.length<10){A.oR.error("Texto da mensagem deve ter pelo menos 10 caracteres");return}await t({TITULO:y,TEXTO_MENSAGEM:C,SETOR:E,ARQUIVO:_.current}),A.oR.success("Mensagem r\xe1pida atualizada com sucesso!"),s()};return(0,a.jsxs)("div",{className:"flex flex-col gap-6 bg-white text-gray-800 dark:bg-slate-800 dark:text-white px-8 py-6 rounded-md w-full max-w-3xl",style:{width:500},children:[(0,a.jsx)(x.A,{variant:"h6",children:"Editar mensagem r\xe1pida"}),(0,a.jsx)("div",{className:"flex gap-4 items-center",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsx)(m.A,{label:"T\xedtulo",fullWidth:!0,value:y,onChange:e=>b(e.target.value)}),(0,a.jsxs)(m.A,{select:!0,label:"Setor",fullWidth:!0,value:null!=E?E:"",disabled:"nunes"!==d||(null==c?void 0:c.SETOR)!==3,onChange:e=>k(""===e.target.value?null:Number(e.target.value)),children:[(0,a.jsx)(h.A,{value:"",children:"Nenhum"}),null==n?void 0:n.map(e=>(0,a.jsx)(h.A,{value:e.id,children:e.name},e.id))]})]})}),(0,a.jsx)(m.A,{label:"Texto da mensagem",multiline:!0,minRows:4,value:C,onChange:e=>{let l=e.target.value;N(l);let t=e.target.selectionStart||0,a=l.slice(0,t),r=a.lastIndexOf("@");if(r>=0){let e=a.slice(r+1);e.includes(" ")||e.includes("\n")?(G(null),V("")):(V(e),G(F.current))}else G(null),V("")},inputRef:F,fullWidth:!0}),(0,a.jsxs)("div",{className:"flex items-center gap-4 pt-2",children:[(0,a.jsx)(o.A,{variant:"outlined",onClick:()=>{var e;return null===(e=U.current)||void 0===e?void 0:e.click()},sx:{minWidth:150},children:"Selecionar arquivo"}),_.current?(0,a.jsx)(x.A,{variant:"body2",noWrap:!0,sx:{maxWidth:200,userSelect:"all",color:"white"},children:_.current.name}):M?(0,a.jsx)("img",{src:M,alt:"Preview",className:"h-16 w-16 rounded-md object-cover"}):null]}),(0,a.jsx)("input",{ref:U,type:"file",hidden:!0,onChange:e=>{var l;let t=(null===(l=e.target.files)||void 0===l?void 0:l[0])||null;if(_.current=t,t){let e=new FileReader;e.onload=e=>{var l;return I(null===(l=e.target)||void 0===l?void 0:l.result)},e.readAsDataURL(t)}else I(null)}}),(0,a.jsx)(p.A,{open:!!D,anchorEl:D,placement:"bottom-start",style:{zIndex:1300,width:null==D?void 0:D.clientWidth},children:(0,a.jsx)(g.A,{style:{maxHeight:200,overflowY:"auto"},children:(0,a.jsx)(f.A,{dense:!0,children:q.map(e=>(0,a.jsx)(v.A,{onClick:()=>Q(e.name),children:e.name},e.name))})})}),(0,a.jsxs)("div",{className:"flex justify-end gap-4 pt-4",children:[(0,a.jsx)(o.A,{color:"error",onClick:s,children:"Cancelar"}),(0,a.jsx)(o.A,{onClick:P,variant:"contained",disabled:y.length<6||C.length<10,children:"Salvar"})]}),(0,a.jsx)(j.A,{open:W,onClose:()=>L(!1),children:(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-md shadow-lg p-4 max-w-md w-full",children:(0,a.jsx)(R,{onSelect:Q,onClose:()=>L(!1)})})})})]})}var k=t(19505);function M(e){let{readyMessageId:l,readyMessageName:t,deleteGroup:r}=e,{closeModal:s}=(0,u.Us)(),n=async()=>{r(l),s()};return(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex flex-col gap-6 bg-white text-gray-800 dark:bg-slate-800 dark:text-white px-[2rem] py-[1rem]",children:[(0,a.jsx)("header",{className:"text-lg text-semibold",children:"Deletar Mensagem pronta"}),(0,a.jsx)("div",{className:"flex flex-col gap-4",children:(0,a.jsxs)("h1",{children:['Tem certeza que deseja excluir a Menssagem pronta "',t,'"?']})}),(0,a.jsxs)("div",{className:"flex w-full flex-row justify-end gap-4 pt-4",children:[(0,a.jsx)(o.A,{color:"error",onClick:s,children:"Cancelar"}),(0,a.jsx)(o.A,{onClick:n,variant:"contained",children:"Deletar"})]})]})})}function I(e){var l;let{onSubmit:t}=e,{closeModal:s}=(0,u.Us)(),{user:n,instance:i}=(0,w.useContext)(O.c),[c,d]=(0,w.useState)(""),[y,b]=(0,w.useState)(""),[C,N]=(0,w.useState)(null),[S,E]=(0,w.useState)(null),k=(0,w.useRef)(null),M=(0,w.useRef)(null),{sectors:I}=(0,T.jb)(),[_,U]=(0,w.useState)(!1),F=(0,w.useRef)(null),[W,L]=(0,w.useState)(null),[D,G]=(0,w.useState)(""),{variables:z=[]}=(0,r.m)()||{},[V,Q]=(0,w.useState)(!1),q=z.filter(e=>e.name.toLowerCase().includes(D.toLowerCase())),P=e=>{if(!F.current)return;let l=F.current,t=l.selectionStart||0,a=y.slice(0,t),r=y.slice(t),s=a.lastIndexOf("@");!(s<0)&&(b(a.slice(0,s)+e+r),L(null),setTimeout(()=>{let t=s+e.length;l.focus(),l.setSelectionRange(t,t)},0))},X=async()=>{if(c.length<6){A.oR.error("T\xedtulo deve ter pelo menos 6 caracteres");return}if(y.length<10){A.oR.error("Texto da mensagem deve ter pelo menos 10 caracteres");return}Q(!0);try{await t({TITULO:c,TEXTO_MENSAGEM:y,SETOR:C,ARQUIVO:k.current}),A.oR.success("Mensagem r\xe1pida criada com sucesso!"),s()}catch(e){A.oR.error("Erro ao criar mensagem r\xe1pida")}finally{Q(!1)}};return(0,a.jsxs)("div",{className:"flex flex-col gap-6 bg-white text-gray-800 dark:bg-slate-800 dark:text-white px-8 py-6 rounded-md w-full max-w-3xl",style:{width:500},children:[(0,a.jsx)(x.A,{variant:"h6",children:"Cadastrar nova mensagem r\xe1pida"}),(0,a.jsx)("div",{className:"flex gap-4 items-center",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsx)(m.A,{label:"T\xedtulo",fullWidth:!0,value:c,onChange:e=>d(e.target.value)}),(0,a.jsxs)(m.A,{select:!0,label:"Setor",fullWidth:!0,disabled:"nunes"!==i||(null==n?void 0:n.SETOR)!==3,value:null!==(l=null!=C?C:null==n?void 0:n.SETOR)&&void 0!==l?l:"",onChange:e=>N(""===e.target.value?null:Number(e.target.value)),children:[(0,a.jsx)(h.A,{value:"",children:"Nenhum"}),null==I?void 0:I.map(e=>(0,a.jsx)(h.A,{value:e.id,children:e.name},e.id))]})]})}),(0,a.jsx)(m.A,{label:"Texto da mensagem",multiline:!0,minRows:4,value:y,onChange:e=>{let l=e.target.value;b(l);let t=e.target.selectionStart||0,a=l.slice(0,t),r=a.lastIndexOf("@");if(r>=0){let e=a.slice(r+1);e.includes(" ")||e.includes("\n")?(L(null),G("")):(G(e),L(F.current))}else L(null),G("")},inputRef:F,fullWidth:!0}),(0,a.jsxs)("div",{className:"flex items-center gap-4 pt-2",children:[(0,a.jsx)(o.A,{variant:"outlined",onClick:()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.click()},sx:{minWidth:150},children:"Selecionar arquivo"}),k.current&&(0,a.jsx)(x.A,{variant:"body2",noWrap:!0,sx:{maxWidth:200,userSelect:"all",color:"white"},children:k.current.name})]}),(0,a.jsx)("input",{ref:M,type:"file",hidden:!0,onChange:e=>{var l;let t=(null===(l=e.target.files)||void 0===l?void 0:l[0])||null;if(k.current=t,t){let e=new FileReader;e.onload=e=>{var l;return E(null===(l=e.target)||void 0===l?void 0:l.result)},e.readAsDataURL(t)}else E(null)}}),(0,a.jsx)(p.A,{open:!!W,anchorEl:W,placement:"bottom-start",style:{zIndex:1300,width:null==W?void 0:W.clientWidth},children:(0,a.jsx)(g.A,{style:{maxHeight:200,overflowY:"auto"},children:(0,a.jsx)(f.A,{dense:!0,children:q.map(e=>(0,a.jsx)(v.A,{onClick:()=>P(e.name),children:e.name},e.name))})})}),(0,a.jsxs)("div",{className:"flex justify-end gap-4 pt-4",children:[(0,a.jsx)(o.A,{color:"error",onClick:s,children:"Cancelar"}),(0,a.jsx)(o.A,{onClick:X,variant:"contained",disabled:V,children:V?"Cadastrando...":"Cadastrar"})]}),(0,a.jsx)(j.A,{open:_,onClose:()=>U(!1),children:(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-md shadow-lg p-4 max-w-md w-full",children:(0,a.jsx)(R,{onSelect:P,onClose:()=>U(!1)})})})})]})}function _(){let{openModal:e}=(0,u.Us)(),{sectors:l}=(0,T.jb)(),{createReadyMessage:t}=(0,r.m)(),{readyMessages:x,updateReadyMessage:m,deleteReadyMessage:h}=(0,r.m)(),p=l=>()=>{e((0,a.jsx)(E,{onSubmit:e=>{let{TITULO:t,TEXTO_MENSAGEM:a,SETOR:r,ARQUIVO:s}=e;return m(l.CODIGO,{...l,TITULO:t,TEXTO_MENSAGEM:a,SETOR:null!=r?r:0,ARQUIVO:s?s.name:""})},readyMessage:l}))},g=l=>()=>{e((0,a.jsx)(M,{readyMessageId:l.CODIGO,readyMessageName:l.TITULO||"",deleteGroup:h}))};return(0,a.jsxs)("div",{className:"relative flex h-[calc(100vh-100px)] flex-col",children:[(0,a.jsx)(n.A,{className:"mx-auto scrollBar scrollbar-whatsapp w-full flex-1 bg-white text-gray-800 dark:bg-indigo-700 dark:bg-opacity-5 dark:text-white shadow-md",children:(0,a.jsxs)(i.A,{className:"w-max text-sm",children:[(0,a.jsx)("thead",{className:"sticky top-0 z-10 bg-white dark:bg-indigo-900 text-gray-800 dark:text-white after:absolute after:bottom-0 after:left-0 after:right-0 after:h-[1px] after:bg-gray-300 dark:after:bg-indigo-600",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"w-32 px-2 py-6 pl-16 text-left text-lg",children:"Codigo"}),(0,a.jsx)("th",{className:"w-64 px-2 py-6 text-left text-lg",children:"Titulo"}),(0,a.jsx)("th",{className:"w-64 px-2 py-6 text-left text-lg",children:"Arquivo"}),(0,a.jsx)("th",{className:"w-64 px-2 py-6 text-left text-lg",children:"Mensagem"}),(0,a.jsx)("th",{className:"w-64 px-2 py-6 text-left text-lg",children:"Setor"}),(0,a.jsx)("th",{className:"w-32 px-2 py-6 text-left text-lg",children:"Ultima modifica\xe7\xe3o"}),(0,a.jsx)("th",{className:"w-24 px-2 py-6 pr-16 text-left text-lg",children:"A\xe7\xf5es"})]})}),(0,a.jsx)("tbody",{className:"py-2",children:x&&x.length>0&&(null==x?void 0:x.filter(e=>e).map(e=>{var t;return(0,a.jsxs)("tr",{className:"even:bg-indigo-700/5",children:[(0,a.jsx)("td",{className:"w-32 truncate px-2 py-6 pl-16 text-lg",children:e.CODIGO}),(0,a.jsx)("td",{className:"max-w-[300px] overflow-hidden text-ellipsis whitespace-nowrap px-2 py-6 text-lg",title:e.TITULO,children:e.TITULO}),(0,a.jsx)("td",{className:"max-w-[300px] overflow-hidden text-ellipsis whitespace-nowrap px-2 py-6 text-lg",title:e.ARQUIVO,children:e.ARQUIVO}),(0,a.jsx)("td",{className:"max-w-[300px] overflow-hidden text-ellipsis whitespace-nowrap px-2 py-6 text-lg",title:e.TEXTO_MENSAGEM,children:e.TEXTO_MENSAGEM}),(0,a.jsx)("td",{className:"max-w-[300px] overflow-hidden text-ellipsis whitespace-nowrap px-2 py-6 text-lg",children:null==l?void 0:null===(t=l.find(l=>l.id===e.SETOR))||void 0===t?void 0:t.name}),(0,a.jsx)("td",{className:"w-72 truncate px-2 py-6 text-lg",children:s.Formatter.date(e.LAST_UPDATE)}),(0,a.jsxs)("td",{className:"w-24 truncate px-2 py-6 pr-16 text-lg",children:[(0,a.jsx)(c.A,{onClick:p(e),children:(0,a.jsx)(d.A,{})}),(0,a.jsx)(c.A,{onClick:g(e),children:(0,a.jsx)(k.A,{})})]})]},e.CODIGO)}))})]})}),(0,a.jsx)("div",{className:"flex h-max  justify-end ",children:(0,a.jsx)(o.A,{variant:"outlined",size:"large",onClick:()=>{e((0,a.jsx)(I,{onSubmit:e=>{let{TITULO:l,TEXTO_MENSAGEM:a,SETOR:r,ARQUIVO:s}=e;return t(s,l,a,null!=r?r:void 0)}}))},children:"Cadastrar"})})]})}function U(){return(0,a.jsx)("div",{className:"flex flex-col px-10 pt-5 w-screen h-screen box-border relative ",children:(0,a.jsx)(_,{})})}},78286:(e,l,t)=>{"use strict";t.d(l,{A:()=>d,m:()=>o});var a=t(95155),r=t(54607),s=t(12115),n=t(98892),i=t(38543);let c=(0,s.createContext)({}),o=()=>(0,s.useContext)(c);function d(e){let{children:l}=e,{token:t}=(0,s.useContext)(n.c),[o,d]=(0,s.useState)([]),u=(0,s.useRef)(new r.ReadyMessageClient("http://localhost:8005")),x=[{name:"@sauda\xe7\xe3o_tempo",replaceFor:"currentSaudation"},{name:"@cliente_razao",replaceFor:"customerRazao"},{name:"@cliente_cnpj",replaceFor:"customerCnpj"},{name:"@atendente_nome",replaceFor:"operatorName"},{name:"@atendente_nome_exibicao",replaceFor:"operatorNameExibition"},{name:"@contato_primeiro_nome",replaceFor:"customerFirstName"},{name:"@contato_nome_completo",replaceFor:"customerFullName"}],m=(0,s.useCallback)(async(e,l,a)=>{if(t)try{if(!a)return;let t=await u.current.updateReadyMessage(e,l,a);d(l=>l.map(l=>l.CODIGO===e?{...l,file:t.ARQUIVO}:l)),i.oR.success("Arquivo do Mensagem pronta atualizada com sucesso!")}catch(e){console.error("Error updating readyMessage image",e),i.oR.error("Erro ao atualizar Arquivo do Mensagem pronta")}},[t]),h=(0,s.useCallback)(async(e,l,a,r)=>{if(t)try{let t=await u.current.createReadyMessage(e,l,a,r);d(e=>[t,...e||[]])}catch(e){console.error("Error creating readyMessage",e),i.oR.error("Erro ao criar Mensagem pronta")}},[t]),p=(0,s.useCallback)(async e=>{if(t)try{await u.current.deleteReadyMessage(e),i.oR.success("Mensagem pronta  deletado com sucesso!"),d(l=>l.filter(l=>l.CODIGO!==e))}catch(e){i.oR.error("Erro ao deletar Mensagem pronta")}},[t]),g=(0,s.useCallback)(async()=>{t&&u.current&&(u.current.setAuth(t),d(await u.current.getReadyMessages()))},[t]);return(0,s.useEffect)(()=>{t&&u.current&&(u.current.setAuth(t),u.current.getReadyMessages().then(e=>{d(e)}))},[t,u.current]),(0,a.jsx)(c.Provider,{value:{readyMessages:o,updateReadyMessage:m,createReadyMessage:h,deleteReadyMessage:p,variables:x,replaceVariables:function(e){let{message:l,values:t}=e;return x.forEach(e=>{l=l.replaceAll(e.name,t[e.replaceFor])}),l},fetchReadyMessages:g},children:l})}},94747:(e,l,t)=>{Promise.resolve().then(t.bind(t,62083))}},e=>{var l=l=>e(e.s=l);e.O(0,[4488,9141,8534,1620,4954,6109,1715,8702,8441,1684,7358],()=>l(94747)),_N_E=e.O()}]);