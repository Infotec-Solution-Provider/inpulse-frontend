(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8896],{3099:(e,t,l)=>{"use strict";function s(e){return e?("string"==typeof e&&(e=new Date(e)),!(e instanceof Date)||isNaN(e.getTime()))?"N/D":e.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"N/D"}l.d(t,{A:()=>s})},10576:(e,t,l)=>{"use strict";l.d(t,{A:()=>k});var s=l(95155),a=l(12115),n=l(88702),r=l(40931),i=l(98892),d=l(17245),o=l(69926),c=l(39447);function u(e){return e.from.startsWith("system")?"system":e.from.startsWith("me:")||e.from.startsWith("bot:")?"sent":"received"}function m(){let{currentChatMessages:e,currentChat:t}=(0,n.jb)(),{getMessageById:l,handleQuoteMessage:r}=(0,a.useContext)(c.U),{instance:m}=(0,a.useContext)(i.c),x="nunes"===m?(()=>{let t=[...e].map(e=>{var t;return!!("system"===e.from&&(null===(t=e.body)||void 0===t?void 0:t.startsWith("Atendimento transferido")))}).lastIndexOf(!0);return -1!==t?e.slice(t):e})():e;return(0,s.jsx)(s.Fragment,{children:x.map(e=>{let a=e.contactId&&e.quotedId&&l(e.contactId,e.quotedId),n=a?(0,d.A)(a,u(a),[],t):null;return(0,s.jsx)(o.Ay,{id:e.id,style:u(e),text:e.body,date:new Date(+e.timestamp),status:e.status,fileId:e.fileId,fileName:e.fileName,fileType:e.fileType,fileSize:e.fileSize,quotedMessage:n,onQuote:()=>{r(e)}},"message_".concat(e.id))})})}var x=l(74205),h=l(86080),p=l(56204),v=l(68534),g=l(700),f=l(56278),w=l(54492),j=l(3127),N=l(99927),b=l(63148),C=l(65528),A=l(22376),y=l(85222),D=l(69242);function I(){let{currentInternalChatMessages:e,users:t,sendInternalMessage:l}=(0,a.useContext)(r.xI),{getMessageById:n,handleQuoteMessage:o}=(0,a.useContext)(c.U),{user:u}=(0,i.Z)(),{contacts:m}=(0,a.useContext)(p.Jj),[x,I]=(0,a.useState)(new Set),[k,S]=(0,a.useState)(!1),[O,M]=(0,a.useState)(null),[E,L]=(0,a.useState)(30),T=(0,a.useMemo)(()=>{let e=new Map;for(let l of t)e.set(l.CODIGO,l);return e},[t]),G=(0,a.useMemo)(()=>{let e=new Map;for(let l of m){var t;let s=null===(t=l.phone)||void 0===t?void 0:t.replace(/\D/g,"");s&&e.set(s,l.name)}return e},[m]),P=(0,a.useMemo)(()=>{var e,l;let s=new Map;for(let l of t){let t=null===(e=l.WHATSAPP)||void 0===e?void 0:e.replace(/\D/g,"");t&&s.set(t,l.NOME)}for(let e of m){let t=null===(l=e.phone)||void 0===l?void 0:l.replace(/\D/g,"");t&&!s.has(t)&&s.set(t,e.name)}return s},[t,m]),R=(0,a.useCallback)(e=>{I(t=>{let l=new Set(t);return l.has(e)?l.delete(e):l.add(e),l})},[]),z=()=>{I(new Set)},W=(0,a.useMemo)(()=>e.filter(e=>x.has(e.id)),[e,x]),_=(0,a.useMemo)(()=>e.slice(-E),[e,E]);function q(e,t){return"system"===e.from?"system":e.from==="user:".concat(t)?"sent":"received"}let F=e=>{for(let s of O||W){var t;l({chatId:e,text:s.body,fileId:null!==(t=s.fileId)&&void 0!==t?t:void 0,sendAsAudio:!1,sendAsDocument:!1,mentions:[],quotedId:null})}S(!1),M(null),z()},U=e=>{M([e]),S(!0)};return(0,s.jsxs)("div",{className:"relative h-full overflow-y-auto p-2",children:[E<e.length&&(0,s.jsx)("div",{className:"flex justify-center mb-2",children:(0,s.jsx)(v.A,{variant:"outlined",size:"small",onClick:()=>L(t=>Math.min(t+30,e.length)),children:"Carregar mais"})}),x.size>0&&(0,s.jsxs)("div",{className:"fixed top-0 left-0 right-0 z-50 bg-white dark:bg-slate-900 shadow p-2 flex items-center justify-between",children:[(0,s.jsxs)(g.A,{variant:"subtitle1",component:"div",children:[x.size," mensagem(s) selecionada(s)"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(v.A,{variant:"outlined",onClick:z,children:"Cancelar"}),(0,s.jsx)(v.A,{variant:"contained",onClick:()=>S(!0),children:"Encaminhar"})]})]}),(0,s.jsx)("ul",{className:"flex flex-col gap-2 pt-[48px]",children:_.map((e,l,a)=>{let r=e.internalChatId&&e.quotedId&&n(e.internalChatId,e.quotedId,!0),i=r?(0,d.A)(r,q(r,u.CODIGO),t,null,G):null,c=l>0?a[l-1]:null,m=!c||c.from!==e.from,p=null;if(e.from.startsWith("user:")){let t=Number(e.from.split(":")[1]),l=T.get(t);p=l?l.NOME:null}if(e.from.startsWith("external:")){let t=e.from.split(":"),l="";3===t.length?l=t[2]:2===t.length&&(l=t[1]);let s=l.split("@")[0].replace(/\D/g,""),a=T.get(s);if(a)p=a.NOME;else{let e=G.get(s);p=e||(s?(s.length,s):"Sem n\xfamero")}}return(0,s.jsx)(h.A,{id:e.id,style:q(e,u.CODIGO),groupFirst:m,sentBy:p||"Desconhecido",text:e.body,date:new Date(+e.timestamp),status:e.status,fileId:e.fileId,fileName:e.fileName,fileType:e.fileType,fileSize:e.fileSize,quotedMessage:i,onQuote:()=>o(e),mentionNameMap:P,isForwardMode:x.size>0,isSelected:x.has(e.id),onSelect:R,onForward:()=>U(e),onCopy:()=>navigator.clipboard.writeText(e.body)},e.id)})}),(0,s.jsxs)(f.A,{open:k,onClose:()=>S(!1),maxWidth:"xs",fullWidth:!0,children:[(0,s.jsxs)(w.A,{children:["Encaminhar para...",(0,s.jsx)(j.A,{"aria-label":"fechar",onClick:()=>S(!1),sx:{position:"absolute",right:8,top:8},children:(0,s.jsx)(D.A,{})})]}),(0,s.jsx)(N.A,{dividers:!0,children:(0,s.jsx)(b.A,{children:t.map(e=>(0,s.jsx)(C.Ay,{disablePadding:!0,children:(0,s.jsx)(A.A,{onClick:()=>F(e.CODIGO),children:(0,s.jsx)(y.A,{primary:e.NOME,secondary:e.EMAIL||e.WHATSAPP})})},e.CODIGO))})})]})]})}function k(){let{currentChatMessages:e,currentChat:t}=(0,a.useContext)(n.ce),{currentInternalChatMessages:l}=(0,a.useContext)(r.xI),{user:d}=(0,a.useContext)(i.c),o=(null==t?void 0:t.chatType)==="wpp",c=(null==t?void 0:t.chatType)==="internal"&&!t.isGroup,u=(null==t?void 0:t.chatType)==="internal"&&t.isGroup,h=(0,a.useRef)(null),p=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(p.current){let e=setTimeout(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},100);return()=>clearTimeout(e)}},[null==t?void 0:t.id]),(0,s.jsx)(s.Fragment,{children:d&&(0,s.jsxs)("ul",{className:"flex flex-col flex-1 w-full gap-2 scrollbar-whatsapp bg-slate-300 dark:bg-slate-700 p-2 min-h-[calc(100vh-165px)] md:mt-0 mt-7 overflow-y-auto",ref:h,children:[o&&(0,s.jsx)(m,{}),c&&(0,s.jsx)(x.A,{}),u&&(0,s.jsx)(I,{}),(0,s.jsx)("li",{ref:p,className:"h-0"})]})})}},58674:(e,t,l)=>{"use strict";l.d(t,{A:()=>n});var s=l(57515),a=l(95155);let n=(0,s.A)((0,a.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},63699:(e,t,l)=>{Promise.resolve().then(l.bind(l,64594))},64594:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>w});var s=l(95155),a=l(12115),n=l(58674),r=l(93408),i=l(51922),d=l(88702),o=l(92697),c=l(39447),u=l(97609),m=l(10576),x=l(70266),h=l(67840),p=l(72724),v=l(40931),g=l(42732),f=l(3099);function w(){let{getChatsMonitor:e,monitorChats:t,setCurrentChat:l,openChat:w,chats:j,getChats:N}=(0,d.jb)(),{users:b}=(0,a.useContext)(v.xI),{openModal:C,closeModal:A}=(0,a.useContext)(o.BR),[y,D]=(0,a.useState)(""),[I,k]=(0,a.useState)(""),[S,O]=(0,a.useState)(""),[M,E]=(0,a.useState)(""),[L,T]=(0,a.useState)(""),[G,P]=(0,a.useState)(""),[R,z]=(0,a.useState)(""),[W,_]=(0,a.useState)(""),[q,F]=(0,a.useState)(""),[U,Z]=(0,a.useState)("");(0,a.useEffect)(()=>{N(),e()},[N,e]);let B=(0,a.useMemo)(()=>[...t],[t]),H=(0,a.useMemo)(()=>B.filter(e=>{var t,l,s,a,n,r;if(y&&!String(e.id).includes(y)||G&&!String((null===(t=e.customer)||void 0===t?void 0:t.CODIGOERP)||"").includes(G))return!1;let i=(null===(l=e.customer)||void 0===l?void 0:l.RAZAO)||e.contactName||"";if(I&&!i.toLowerCase().includes(I.toLowerCase()))return!1;let d=(null===(s=e.contact)||void 0===s?void 0:s.phone)||"";if(R&&!d.includes(R))return!1;let o=(null===(a=e.contact)||void 0===a?void 0:a.name)||"";if(W&&!o.toLowerCase().includes(W.toLowerCase()))return!1;let c=(null===(n=e.customer)||void 0===n?void 0:n.RAZAO)||"";if(q&&!c.toLowerCase().includes(q.toLowerCase()))return!1;let u=(null===(r=b.find(t=>String(t.CODIGO)===String(null==e?void 0:e.userId)))||void 0===r?void 0:r.NOME)||"";if(U&&!u.toLowerCase().includes(U.toLowerCase()))return!1;let m=new Date(e.startDate||e.startedAt).toLocaleDateString();if(S&&!m.includes(S))return!1;let x=e.endDate||e.finishedAt?new Date(e.endDate||e.finishedAt).toLocaleDateString():"";if(M&&!x.includes(M))return!1;let h=e.result||"";return!L||!!h.toLowerCase().includes(L.toLowerCase())}),[B,y,G,I,R,W,q,U,S,M,L]),J=e=>{var t,a,n,r,i,d;e&&(l(e),w(e),C((0,s.jsxs)("div",{className:"relative flex h-[80vh] w-[500px] flex-col rounded-md bg-slate-900 shadow-xl dark:bg-slate-800",children:[(0,s.jsx)("button",{onClick:()=>null==A?void 0:A(),className:"absolute right-2 top-1 z-10 text-gray-700 hover:text-red-500 dark:text-gray-300 dark:hover:text-red-300",children:"âœ•"}),(0,s.jsxs)(c.A,{children:[(0,s.jsx)(u.A,{avatarUrl:e.avatarUrl,name:(null===(t=e.contact)||void 0===t?void 0:t.name)||"Contato exclu\xeddo",customerName:(null===(a=e.customer)||void 0===a?void 0:a.RAZAO)||"N/D",phone:(null===(n=e.contact)||void 0===n?void 0:n.phone)||"N/D",cpfCnpj:(null===(r=e.customer)||void 0===r?void 0:r.CPF_CNPJ)||null,codErp:(null===(i=e.customer)||void 0===i?void 0:i.COD_ERP)||null,customerId:(null===(d=e.customer)||void 0===d?void 0:d.CODIGO)||null,startDate:e.startedAt?new Date(e.startedAt).toDateString():null}),(0,s.jsx)("div",{className:"scrollbar-whatsapp flex-1 bg-white text-black drop-shadow-md dark:bg-slate-900 dark:text-white",children:(0,s.jsx)(m.A,{})}),(0,s.jsx)("div",{className:"border-t border-gray-200 bg-white p-2 text-black dark:border-gray-700 dark:bg-slate-900",children:(0,s.jsx)(x.A,{})})]})]})))},Q=e=>{e&&(l(e),C((0,s.jsx)(p.A,{})))},V=t=>{t&&(l(t),C((0,s.jsx)(h.A,{})),e())};return(0,s.jsxs)("div",{className:"mx-auto box-border flex h-full w-max max-w-[1860px] flex-col overflow-auto rounded-md px-2 py-4 shadow-md",children:[(0,s.jsxs)("header",{className:"flex w-max items-center rounded-t-md bg-indigo-200 py-1 dark:bg-indigo-800",children:[(0,s.jsx)("div",{className:"px-2 pl-6 md:w-24 lg:w-32",children:(0,s.jsx)("h2",{className:"lg:text-md py-2 text-slate-800 dark:text-slate-200 md:text-sm",children:"A\xe7\xf5es"})}),(0,s.jsx)("div",{className:"pl-2 md:w-16 lg:w-20",children:(0,s.jsx)("input",{value:y,onChange:e=>D(e.target.value),placeholder:"C\xf3digo",className:"lg:text-md w-full bg-transparent p-2 text-slate-800 outline-none dark:text-slate-200 md:text-sm"})}),(0,s.jsx)("div",{className:"pl-2 md:w-16 lg:w-20",children:(0,s.jsx)("input",{value:G,onChange:e=>P(e.target.value),placeholder:"ERP",className:"lg:text-md w-full bg-transparent p-2 text-slate-800 outline-none dark:text-slate-200 md:text-sm"})}),(0,s.jsx)("div",{className:"pl-2 md:w-32 lg:w-44",children:(0,s.jsx)("input",{value:I,onChange:e=>k(e.target.value),placeholder:"Cliente",className:"lg:text-md w-full bg-transparent p-2 text-slate-800 outline-none dark:text-slate-200 md:text-sm"})}),(0,s.jsx)("div",{className:"pl-2 md:w-28 lg:w-36",children:(0,s.jsx)("input",{value:W,onChange:e=>_(e.target.value),placeholder:"Contato",className:"lg:text-md w-full bg-transparent p-2 text-slate-800 outline-none dark:text-slate-200 md:text-sm"})}),(0,s.jsx)("div",{className:"pl-2 md:w-32 lg:w-44",children:(0,s.jsx)("input",{value:R,onChange:e=>z(e.target.value),placeholder:"N\xfamero",className:"lg:text-md w-full bg-transparent p-2 text-slate-800 outline-none dark:text-slate-200 md:text-sm"})}),(0,s.jsx)("div",{className:"pl-2 md:w-28 lg:w-36",children:(0,s.jsx)("input",{value:U,onChange:e=>Z(e.target.value),placeholder:"Usu\xe1rio",className:"lg:text-md w-full bg-transparent p-2 text-slate-800 outline-none dark:text-slate-200 md:text-sm"})}),(0,s.jsx)("div",{className:"pl-2 md:w-28 lg:w-36",children:(0,s.jsx)("input",{value:S,onChange:e=>O(e.target.value),placeholder:"Data In\xedcio",className:"lg:text-md w-full bg-transparent p-2 text-slate-800 outline-none dark:text-slate-200 md:text-sm"})})]}),(0,s.jsx)("div",{className:"scrollbar-whatsapp w-max grow rounded-b-md bg-slate-200 dark:bg-slate-800",children:H.map((e,t)=>{var l,a,d,o,c;return(0,s.jsxs)("div",{className:"flex items-center py-2 text-slate-800 even:bg-indigo-700/10 dark:text-slate-200",children:[(0,s.jsxs)("div",{className:"flex gap-1 pl-6 md:w-24 lg:w-32",children:[(0,s.jsx)("button",{onClick:()=>J(e),className:"hover:brightness-125",children:(0,s.jsx)(n.A,{color:"info",className:"md:scale-50 lg:scale-75"})}),(0,s.jsx)("button",{onClick:()=>Q(e),className:"hover:brightness-125",children:(0,s.jsx)(r.A,{color:"secondary",className:"md:scale-50 lg:scale-75"})}),(0,s.jsx)("button",{onClick:()=>V(e),className:"hover:brightness-125",children:(0,s.jsx)(i.A,{color:"success",className:"md:scale-50 lg:scale-75"})})]}),(0,s.jsx)("div",{className:"pl-2 md:w-16 lg:w-20",children:(0,s.jsx)("p",{className:"lg:text-md pl-2 font-semibold md:text-sm",children:e.id})}),(0,s.jsx)("div",{className:"pl-2 md:w-16 lg:w-20",children:(0,s.jsx)("p",{className:"lg:text-md pl-2 md:text-sm",children:(null===(l=e.customer)||void 0===l?void 0:l.CODIGOERP)||"N/D"})}),(0,s.jsx)("div",{className:"pl-2 md:w-32 lg:w-44",children:(0,s.jsx)("p",{className:"lg:text-md truncate pl-2 md:text-sm",children:(null===(a=e.customer)||void 0===a?void 0:a.RAZAO)||"N/D"})}),(0,s.jsx)("div",{className:"pl-2 md:w-28 lg:w-36",children:(0,s.jsx)("p",{className:"lg:text-md truncate pl-2 md:text-sm",children:(null===(d=e.contact)||void 0===d?void 0:d.name)||"N/D"})}),(0,s.jsx)("div",{className:"pl-2 md:w-32 lg:w-44",children:(0,s.jsx)("p",{className:"lg:text-md truncate pl-2 md:text-sm",children:(null===(o=e.contact)||void 0===o?void 0:o.phone)?g.Formatter.phone(e.contact.phone):"N/D"})}),(0,s.jsx)("div",{className:"pl-2 md:w-28 lg:w-36",children:(0,s.jsx)("p",{className:"lg:text-md truncate pl-2 md:text-sm",children:e.botId?"BOT":null===(c=b.find(t=>String(t.CODIGO)===String(null==e?void 0:e.userId)))||void 0===c?void 0:c.NOME})}),(0,s.jsx)("div",{className:"pl-2 md:w-28 lg:w-36",children:(0,s.jsx)("p",{className:"truncate pl-2 md:text-xs lg:text-sm",children:(0,f.A)((null==e?void 0:e.startAt)||(null==e?void 0:e.startedAt))})})]},t)})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2666,4488,9141,8534,1620,6805,4954,35,3729,4805,9952,8702,931,9595,8441,1684,7358],()=>t(63699)),_N_E=e.O()}]);