(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1698],{10576:(e,t,l)=>{"use strict";l.d(t,{A:()=>O});var s=l(95155),a=l(12115),n=l(88702),r=l(40931),i=l(98892),o=l(17245),d=l(69926),c=l(39447);function u(e){return e.from.startsWith("system")?"system":e.from.startsWith("me:")||e.from.startsWith("bot:")?"sent":"received"}function m(){let{currentChatMessages:e,currentChat:t}=(0,n.jb)(),{getMessageById:l,handleQuoteMessage:r}=(0,a.useContext)(c.U),{instance:m}=(0,a.useContext)(i.c),x="nunes"===m?(()=>{let t=[...e].map(e=>{var t;return!!("system"===e.from&&(null===(t=e.body)||void 0===t?void 0:t.startsWith("Atendimento transferido")))}).lastIndexOf(!0);return -1!==t?e.slice(t):e})():e;return(0,s.jsx)(s.Fragment,{children:x.map(e=>{let a=e.contactId&&e.quotedId&&l(e.contactId,e.quotedId),n=a?(0,o.A)(a,u(a),[],t):null;return(0,s.jsx)(d.Ay,{id:e.id,style:u(e),text:e.body,date:new Date(+e.timestamp),status:e.status,fileId:e.fileId,fileName:e.fileName,fileType:e.fileType,fileSize:e.fileSize,quotedMessage:n,onQuote:()=>{r(e)}},"message_".concat(e.id))})})}var x=l(74205),h=l(86080),p=l(56204),f=l(68534),g=l(700),v=l(56278),j=l(54492),b=l(3127),y=l(99927),C=l(63148),A=l(65528),w=l(22376),N=l(85222),k=l(69242);function I(){let{currentInternalChatMessages:e,users:t,sendInternalMessage:l}=(0,a.useContext)(r.xI),{getMessageById:n,handleQuoteMessage:d}=(0,a.useContext)(c.U),{user:u}=(0,i.Z)(),{contacts:m}=(0,a.useContext)(p.Jj),[x,I]=(0,a.useState)(new Set),[O,D]=(0,a.useState)(!1),[T,M]=(0,a.useState)(null),[E,S]=(0,a.useState)(30),P=(0,a.useMemo)(()=>{let e=new Map;for(let l of t)e.set(l.CODIGO,l);return e},[t]),G=(0,a.useMemo)(()=>{let e=new Map;for(let l of m){var t;let s=null===(t=l.phone)||void 0===t?void 0:t.replace(/\D/g,"");s&&e.set(s,l.name)}return e},[m]),z=(0,a.useMemo)(()=>{var e,l;let s=new Map;for(let l of t){let t=null===(e=l.WHATSAPP)||void 0===e?void 0:e.replace(/\D/g,"");t&&s.set(t,l.NOME)}for(let e of m){let t=null===(l=e.phone)||void 0===l?void 0:l.replace(/\D/g,"");t&&!s.has(t)&&s.set(t,e.name)}return s},[t,m]),L=(0,a.useCallback)(e=>{I(t=>{let l=new Set(t);return l.has(e)?l.delete(e):l.add(e),l})},[]),U=()=>{I(new Set)},W=(0,a.useMemo)(()=>e.filter(e=>x.has(e.id)),[e,x]),F=(0,a.useMemo)(()=>e.slice(-E),[e,E]);function _(e,t){return"system"===e.from?"system":e.from==="user:".concat(t)?"sent":"received"}let R=e=>{for(let s of T||W){var t;l({chatId:e,text:s.body,fileId:null!==(t=s.fileId)&&void 0!==t?t:void 0,sendAsAudio:!1,sendAsDocument:!1,mentions:[],quotedId:null})}D(!1),M(null),U()},q=e=>{M([e]),D(!0)};return(0,s.jsxs)("div",{className:"relative h-full overflow-y-auto p-2",children:[E<e.length&&(0,s.jsx)("div",{className:"flex justify-center mb-2",children:(0,s.jsx)(f.A,{variant:"outlined",size:"small",onClick:()=>S(t=>Math.min(t+30,e.length)),children:"Carregar mais"})}),x.size>0&&(0,s.jsxs)("div",{className:"fixed top-0 left-0 right-0 z-50 bg-white dark:bg-slate-900 shadow p-2 flex items-center justify-between",children:[(0,s.jsxs)(g.A,{variant:"subtitle1",component:"div",children:[x.size," mensagem(s) selecionada(s)"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(f.A,{variant:"outlined",onClick:U,children:"Cancelar"}),(0,s.jsx)(f.A,{variant:"contained",onClick:()=>D(!0),children:"Encaminhar"})]})]}),(0,s.jsx)("ul",{className:"flex flex-col gap-2 pt-[48px]",children:F.map((e,l,a)=>{let r=e.internalChatId&&e.quotedId&&n(e.internalChatId,e.quotedId,!0),i=r?(0,o.A)(r,_(r,u.CODIGO),t,null,G):null,c=l>0?a[l-1]:null,m=!c||c.from!==e.from,p=null;if(e.from.startsWith("user:")){let t=Number(e.from.split(":")[1]),l=P.get(t);p=l?l.NOME:null}if(e.from.startsWith("external:")){let t=e.from.split(":"),l="";3===t.length?l=t[2]:2===t.length&&(l=t[1]);let s=l.split("@")[0].replace(/\D/g,""),a=P.get(s);if(a)p=a.NOME;else{let e=G.get(s);p=e||(s?(s.length,s):"Sem n\xfamero")}}return(0,s.jsx)(h.A,{id:e.id,style:_(e,u.CODIGO),groupFirst:m,sentBy:p||"Desconhecido",text:e.body,date:new Date(+e.timestamp),status:e.status,fileId:e.fileId,fileName:e.fileName,fileType:e.fileType,fileSize:e.fileSize,quotedMessage:i,onQuote:()=>d(e),mentionNameMap:z,isForwardMode:x.size>0,isSelected:x.has(e.id),onSelect:L,onForward:()=>q(e),onCopy:()=>navigator.clipboard.writeText(e.body)},e.id)})}),(0,s.jsxs)(v.A,{open:O,onClose:()=>D(!1),maxWidth:"xs",fullWidth:!0,children:[(0,s.jsxs)(j.A,{children:["Encaminhar para...",(0,s.jsx)(b.A,{"aria-label":"fechar",onClick:()=>D(!1),sx:{position:"absolute",right:8,top:8},children:(0,s.jsx)(k.A,{})})]}),(0,s.jsx)(y.A,{dividers:!0,children:(0,s.jsx)(C.A,{children:t.map(e=>(0,s.jsx)(A.Ay,{disablePadding:!0,children:(0,s.jsx)(w.A,{onClick:()=>R(e.CODIGO),children:(0,s.jsx)(N.A,{primary:e.NOME,secondary:e.EMAIL||e.WHATSAPP})})},e.CODIGO))})})]})]})}function O(){let{currentChatMessages:e,currentChat:t}=(0,a.useContext)(n.ce),{currentInternalChatMessages:l}=(0,a.useContext)(r.xI),{user:o}=(0,a.useContext)(i.c),d=(null==t?void 0:t.chatType)==="wpp",c=(null==t?void 0:t.chatType)==="internal"&&!t.isGroup,u=(null==t?void 0:t.chatType)==="internal"&&t.isGroup,h=(0,a.useRef)(null),p=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(p.current){let e=setTimeout(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},100);return()=>clearTimeout(e)}},[null==t?void 0:t.id]),(0,s.jsx)(s.Fragment,{children:o&&(0,s.jsxs)("ul",{className:"flex flex-col flex-1 w-full gap-2 scrollbar-whatsapp bg-slate-300 dark:bg-slate-700 p-2 min-h-[calc(100vh-165px)] md:mt-0 mt-7 overflow-y-auto",ref:h,children:[d&&(0,s.jsx)(m,{}),c&&(0,s.jsx)(x.A,{}),u&&(0,s.jsx)(I,{}),(0,s.jsx)("li",{ref:p,className:"h-0"})]})})}},28118:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>es});var s=l(95155),a=l(97609),n=l(70266),r=l(10576),i=l(39447),o=l(12115),d=l(3127),c=l(73731),u=l(69242),m=l(60440),x=l(99510),h=l(96808);function p(e){let{file:t}=e,{dispatch:l,sendMessage:a,state:n}=(0,o.useContext)(i.U),r=()=>{l({type:"remove-file"})};(0,o.useEffect)(()=>{let e=e=>{let t=e.shiftKey||e.altKey||e.ctrlKey;"Enter"===e.key&&(e.preventDefault(),t?l({type:"change-text",text:n.text+"\n"}):(a(),l({type:"remove-file"}),l({type:"change-text",text:""})))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[l,a,n.text]);let p=(0,o.useMemo)(()=>{let e=URL.createObjectURL(t);if(t.type.includes("image"))return(0,s.jsx)("img",{src:e,alt:t.name,className:"max-h-[20rem] max-w-[40rem]"});if(t.type.includes("video"))return(0,s.jsx)("video",{controls:!0,className:"max-h-[15rem] max-w-[40rem] object-contain",children:(0,s.jsx)("source",{src:e,type:t.type})});if(t.type.includes("audio"))return(0,s.jsx)("audio",{controls:!0,className:"max-h-[15rem] max-w-[40rem] object-contain",children:(0,s.jsx)("source",{src:e,type:t.type})});let l=t.name.split(".").reverse()[0];return(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2 rounded-md bg-slate-100 text-slate-800 px-8 py-4 dark:bg-slate-800 dark:text-slate-200",children:[(0,s.jsx)("div",{className:"h-32 w-32 p-8",children:(0,s.jsx)(x.o,{...x.k[l]||{},radius:1.25})}),(0,s.jsx)("h2",{className:"text-xl",children:"Pr\xe9via Indispon\xedvel"}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,h.A)(t.size)," - ",l.toLocaleUpperCase()]})]})},[t]);return(0,s.jsx)("div",{className:"absolute inset-0 z-10 h-full w-full bg-slate-100 text-slate-900 dark:bg-slate-900 dark:text-slate-100 p-4 pb-8",children:(0,s.jsxs)("div",{className:"grid h-full grid-rows-[auto_1fr_auto]",children:[(0,s.jsxs)("header",{className:"flex w-full items-center justify-between mb-2",children:[(0,s.jsx)("div",{}),(0,s.jsx)("h1",{className:"text-base font-medium truncate max-w-[75%]",children:t.name}),(0,s.jsx)(d.A,{onClick:r,sx:{color:"inherit"},children:(0,s.jsx)(u.A,{fontSize:"small"})})]}),(0,s.jsx)("div",{className:"flex items-center justify-center",children:p}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-4 mt-4",children:[(0,s.jsx)(d.A,{onClick:r,sx:{bgcolor:"rgba(0,0,0,0.05)",color:"inherit","&:hover":{bgcolor:"rgba(0,0,0,0.1)"}},children:(0,s.jsx)(u.A,{fontSize:"large"})}),(0,s.jsx)(c.A,{placeholder:"Adicione uma legenda",variant:"outlined",sx:{width:"34rem","& .MuiInputBase-root":{color:"inherit",backgroundColor:"rgba(0,0,0,0.03)",borderRadius:1},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(100,100,100,0.3)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(100,100,100,0.6)"}},multiline:!0,maxRows:5,onChange:e=>{l({type:"change-text",text:e.target.value})}}),(0,s.jsx)(d.A,{onClick:()=>{a(),l({type:"remove-file"}),l({type:"change-text",text:""})},sx:{bgcolor:"rgba(0,0,0,0.05)",color:"inherit","&:hover":{bgcolor:"rgba(0,0,0,0.1)"}},children:(0,s.jsx)(m.A,{fontSize:"large"})})]})]})})}function f(e){let{avatarUrl:t,name:l,customerName:d,phone:c,codErp:u,cpfCnpj:m,customerId:x,startDate:h}=e,{state:f,dispatch:g}=(0,o.useContext)(i.U);return(0,s.jsxs)("div",{className:"relative h-full overflow-hidden md:grid md:grid-rows-[auto_1fr_auto] rounded-md bg-white text-black dark:bg-slate-900 dark:text-white shadow-md ",children:[(0,s.jsx)("div",{className:"md:static fixed inset-x-0 top-0 z-50 ",children:(0,s.jsx)(a.A,{avatarUrl:t,name:l,customerName:d,phone:c,codErp:u,cpfCnpj:m,customerId:x,startDate:h})}),(0,s.jsxs)("div",{className:"h-full overflow-y-auto pt-[68px] pb-[80px] md:pt-0 md:pb-0 md:row-start-2 md:row-end-3",onDrop:e=>{var t;e.preventDefault();let l=null===(t=e.dataTransfer.files)||void 0===t?void 0:t[0];l&&g({type:"attach-file",file:l})},onDragOver:e=>{e.preventDefault()},onPaste:e=>{let t=e.clipboardData.items;for(let e=0;e<t.length;e++){let l=t[e];if("file"===l.kind){let e=l.getAsFile();e&&g({type:"attach-file",file:e})}}},children:[(0,s.jsx)(r.A,{}),(null==f?void 0:f.file)&&!f.sendAsAudio&&(0,s.jsx)(p,{file:f.file})]}),(!(null==f?void 0:f.file)||f.sendAsAudio)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-x-0 bottom-0 z-50 md:hidden",children:(0,s.jsx)(n.A,{})}),(0,s.jsx)("div",{className:"hidden md:block",children:(0,s.jsx)(n.A,{})})]})]})}var g=l(94424),v=l(40857),j=l(18558),b=l(9242),y=l(335),C=l(5087),A=l(76380),w=l(63913),N=l(88702),k=l(42732),I=l(68534),O=l(92697),D=l(98892),T=l(36302);function M(e){var t;let{onClose:l,onSendTemplate:a}=e,{templates:n}=(0,N.jb)(),[r,i]=(0,o.useState)(null),[m,x]=(0,o.useState)({}),h=null==r?void 0:r.text.replace(/{{\d+}}/g,e=>m[+e.replaceAll("{","").replaceAll("}","")]||e);(0,o.useEffect)(()=>{r?x((r.text.match(/{{\d+}}/g)||[]).reduce((e,t)=>{let l=+t.replaceAll("{","").replaceAll("}","");return e={...e,[l]:""}},{})):x({})},[r]);let p=n.map(e=>({label:e.name,template:e})),f=r&&null!==(t=p.find(e=>e.template.id===r.id))&&void 0!==t?t:null,g=!r||Object.values(m).some(e=>!e);return(0,s.jsxs)("div",{className:"w-[40rem] rounded-md bg-slate-200 text-slate-800 dark:bg-slate-800 dark:text-slate-200",children:[(0,s.jsxs)("header",{className:"flex w-full items-center justify-between p-2",children:[(0,s.jsx)("h1",{children:"Enviar Template"}),(0,s.jsx)(d.A,{onClick:l,children:(0,s.jsx)(u.A,{})})]}),(0,s.jsx)("div",{className:"p-2",children:(0,s.jsx)(T.A,{options:p,onChange:(e,t)=>i((null==t?void 0:t.template)||null),value:f,renderInput:e=>(0,s.jsx)(c.A,{label:"template",...e})})}),(0,s.jsx)("div",{className:"p-2",children:r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-2 bg-slate-300 p-2 dark:bg-slate-700",children:h&&h.split("\n").map((e,t)=>(0,s.jsx)("p",{children:e},t))}),(0,s.jsx)("div",{className:"flex flex-col gap-2",children:Object.entries(m).map(e=>{let[t,l]=e;return(0,s.jsx)(c.A,{size:"small",value:l,onChange:e=>x(l=>({...l,[t]:e.target.value})),label:"Vari\xe1vel ".concat(t)},t)})})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2 p-2",children:[(0,s.jsx)(I.A,{variant:"outlined",color:"error",onClick:l,children:"Cancelar"}),(0,s.jsx)(I.A,{variant:"outlined",color:"success",onClick:()=>{a&&r&&h&&a({templateId:r.id,templateParams:Object.values(m),templateText:h})},disabled:g,children:"Enviar"})]})]})}function E(e){let{contact:t,customer:l=null,chatingWith:a=null,onSelect:n}=e,{startChatByContactId:r}=(0,o.useContext)(N.ce),{instance:i}=(0,D.Z)(),{openModal:d,closeModal:c}=(0,O.Us)();return(0,s.jsxs)("li",{className:"flex w-full items-center justify-between gap-2 rounded-md bg-gray-300 p-2 text-gray-700 dark:bg-slate-700 dark:text-gray-100",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-xs font-semibold",children:t.name}),l&&(0,s.jsx)("span",{className:"text-xs text-blue-700 dark:text-blue-200",children:l.RAZAO}),(0,s.jsx)("span",{className:"text-xs text-slate-400",children:t.phone?k.Formatter.phone(t.phone):"Telefone n\xe3o encontrado"})]}),(0,s.jsx)("div",{children:a?(0,s.jsx)("p",{className:"text-xs text-red-400",children:a}):(0,s.jsx)(I.A,{size:"small",onClick:()=>{"exatron"===i||"infotec"===i?d((0,s.jsx)(M,{onClose:c,onSendTemplate:e=>{r(t.id,e),c()}})):r(t.id),n()},sx:{fontSize:"0.65rem",padding:"2px 6px",minWidth:"80px",lineHeight:1},children:"Iniciar"})})]},t.id)}function S(e){let{onClose:t}=e,{wppApi:l}=(0,o.useContext)(N.ce),[a,n]=(0,o.useState)([]),[r,i]=(0,o.useState)(""),[c,m]=(0,o.useState)(1);(0,o.useEffect)(()=>{l.current&&l.current.getContactsWithCustomer().then(e=>{n(e)})},[]);let x=(0,o.useMemo)(()=>{let e=r.toLowerCase();return a.filter(t=>{var l,s;return(null==t?void 0:null===(l=t.name)||void 0===l?void 0:l.toLowerCase().includes(e))||(null==t?void 0:null===(s=t.phone)||void 0===s?void 0:s.toLowerCase().includes(e))})},[a,r]),h=Math.ceil(x.length/10),p=x.slice((c-1)*10,10*c);return(0,o.useEffect)(()=>{m(1)},[r]),(0,s.jsxs)("div",{className:"w-[22rem] rounded-md bg-white px-4 py-4 text-gray-800 dark:bg-slate-800 dark:text-white",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between pb-4",children:[(0,s.jsx)("h1",{className:"text-semibold text-lg",children:"Iniciar conversa"}),(0,s.jsx)(d.A,{onClick:t,children:(0,s.jsx)(u.A,{})})]}),(0,s.jsx)("input",{type:"text",value:r,onChange:e=>i(e.target.value),placeholder:"Pesquisar nome ou numero...",className:"mb-4 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm dark:border-gray-600 dark:bg-slate-700 dark:text-white"}),(0,s.jsxs)("ul",{className:"scrollbar-whatsapp flex h-[25rem] flex-col items-center gap-2",children:[p.map(e=>(0,s.jsx)(E,{contact:e,customer:e.customer,chatingWith:e.chatingWith,onSelect:t},e.id)),0===p.length&&(0,s.jsx)("li",{className:"text-center text-gray-500 dark:text-gray-400 w-full",children:"Nenhum contato encontrado."})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,s.jsx)(I.A,{variant:"outlined",size:"small",onClick:()=>m(e=>Math.max(1,e-1)),disabled:1===c,children:"Anterior"}),(0,s.jsxs)("span",{className:"text-sm",children:["P\xe1gina ",c," de ",h||1]}),(0,s.jsx)(I.A,{variant:"outlined",size:"small",onClick:()=>m(e=>Math.min(h,e+1)),disabled:c===h||0===h,children:"Pr\xf3xima"})]})]})}var P=l(88806),G=l(40931);function z(e){let{user:t,isStarted:l=!1,onSelect:a}=e,{sectors:n}=(0,o.useContext)(N.ce),{startDirectChat:r}=(0,o.useContext)(G.xI),[i,d]=(0,o.useState)(!1),c=n.find(e=>e.id===t.SETOR);return(0,s.jsxs)("li",{className:"flex w-full items-center justify-between gap-2 rounded-md bg-gray-300 text-gray-700 p-2 dark:bg-slate-700 dark:text-gray-100",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-xs font-semibold",children:t.NOME}),c&&(0,s.jsx)("span",{className:"text-xs text-blue-700 dark:text-blue-300",children:c.name})]}),(0,s.jsx)("div",{children:(0,s.jsx)(I.A,{size:"small",onClick:()=>{i||(d(!0),r(t.CODIGO),a())},disabled:l,sx:{fontSize:"0.65rem",padding:"2px 6px",minWidth:"80px",lineHeight:1},children:l?"Conversa j\xe1 iniciada":"Iniciar conversa"})})]})}function L(e){let{onClose:t}=e,{users:l,internalChats:a}=(0,o.useContext)(G.xI),[n,r]=(0,o.useState)(""),i=(0,o.useMemo)(()=>{let e=a.filter(e=>!e.isGroup),t=new Set;return e.forEach(e=>{e.participants.forEach(e=>t.add(e.userId))}),Array.from(t)},[a]),c=(0,o.useMemo)(()=>l.filter(e=>e.NOME.toLowerCase().includes(n.toLowerCase())),[l,n]);return(0,s.jsxs)("div",{className:"w-[22rem] rounded-md bg-white text-gray-800 px-4 py-4 dark:bg-slate-800 dark:text-white",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between pb-4",children:[(0,s.jsx)("h1",{className:"text-lg font-semibold ",children:"Iniciar conversa Interna"}),(0,s.jsx)(d.A,{onClick:t,children:(0,s.jsx)(u.A,{})})]}),(0,s.jsx)("input",{type:"text",value:n,onChange:e=>r(e.target.value),placeholder:"Buscar por nome...",className:"mb-4 w-full rounded-md border bg-white border-gray-300 px-3 py-2 text-sm dark:bg-slate-700 dark:border-gray-600 dark:text-white"}),(0,s.jsx)("ul",{className:"flex h-[25rem] text-sm flex-col items-center gap-2 overflow-y-auto scrollbar-whatsapp",children:c.map(e=>(0,s.jsx)(z,{user:e,isStarted:i.some(t=>t===e.CODIGO),onSelect:t},e.CODIGO))})]})}var U=l(50096),W=l(18895);let F={all:"",unread:"(Lidas)",scheduled:"(Agendadas)",internal:"(Internas)"};function _(){let{changeChatFilters:e,chatFilters:t}=(0,o.useContext)(N.ce),[l,a]=(0,o.useState)(null),[n,r]=(0,o.useState)(null),[i,u]=(0,o.useState)(null),[m,x]=(0,o.useState)(null),h=()=>{a(null)},p=()=>{r(null)},f=()=>{x(null)},k=()=>{u(null)},I=t=>{e({type:"change-showing-type",showingType:t}),k()};return(0,s.jsxs)("div",{className:"flex flex-col gap-1 rounded-t-md p-3",children:[(0,s.jsxs)("header",{className:"mb-1 flex w-full items-center justify-between font-semibold dark:font-normal",children:[(0,s.jsxs)("h1",{children:["Conversas ",F[t.showingType]]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{id:"filter-chats-button",onClick:e=>{u(e.currentTarget)},children:(0,s.jsx)(g.A,{})}),(0,s.jsx)(d.A,{id:"start-button",onClick:e=>{a(e.currentTarget)},children:(0,s.jsx)(v.A,{})})]}),(0,s.jsxs)(C.A,{id:"start-menu",anchorEl:l,open:!!l,onClose:h,PaperProps:{sx:{bgcolor:"background.paper",color:"text.primary"}},children:[(0,s.jsxs)(A.A,{onClick:e=>{x(e.currentTarget),h()},className:"flex items-center gap-2",children:[(0,s.jsx)(U.A,{}),(0,s.jsx)("p",{children:"Nova Conversa"})]}),(0,s.jsxs)(A.A,{onClick:e=>{r(e.currentTarget),h()},className:"flex items-center gap-2",children:[(0,s.jsx)(W.A,{}),(0,s.jsx)("p",{children:"Nova Conversa Interna"})]})]}),(0,s.jsx)(w.Ay,{open:!!m,anchorEl:m,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{style:{width:350}},children:(0,s.jsx)(S,{onClose:f})}),(0,s.jsx)(w.Ay,{open:!!n,anchorEl:n,onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{style:{width:350}},children:(0,s.jsx)(L,{onClose:p})}),(0,s.jsxs)(C.A,{id:"filter-menu",anchorEl:i,open:!!i,onClose:k,children:[(0,s.jsxs)(A.A,{onClick:()=>I("all"),"aria-hidden":"all"===t.showingType,className:"flex items-center gap-2",children:[(0,s.jsx)(P.A,{}),(0,s.jsx)("p",{children:"Todas"})]}),(0,s.jsxs)(A.A,{onClick:()=>I("unread"),"aria-hidden":"unread"===t.showingType,className:"flex items-center gap-2",children:[(0,s.jsx)(b.A,{}),(0,s.jsx)("p",{children:"N\xe3o lidas"})]}),(0,s.jsxs)(A.A,{onClick:()=>I("scheduled"),"aria-hidden":"scheduled"===t.showingType,className:"flex items-center gap-2",children:[(0,s.jsx)(y.A,{}),(0,s.jsx)("p",{children:"Agendados"})]}),(0,s.jsxs)(A.A,{onClick:()=>I("internal"),"aria-hidden":"internal"===t.showingType,className:"flex items-center gap-2",children:[(0,s.jsx)(j.A,{}),(0,s.jsx)("p",{children:"Internos"})]})]})]}),(0,s.jsx)(c.A,{label:"Pesquisar conversa",className:"grow",onChange:t=>{e({type:"change-search",search:t.target.value})}})]})}var R=l(41364),q=l(48924),H=l(49617),V=l(268),B=l(3337),J=l(40420);function Z(e){switch(e.split("/")[0].toLowerCase()){case"image":return(0,s.jsxs)("p",{children:[(0,s.jsx)(R.A,{className:"mr-1"})," Foto"]});case"video":return(0,s.jsxs)("p",{children:[(0,s.jsx)(q.A,{className:"mr-1"})," Video"]});case"audio":return(0,s.jsxs)("p",{children:[(0,s.jsx)(J.A,{className:"mr-1"})," Audio"]});case"ptt":return(0,s.jsxs)("p",{children:[(0,s.jsx)(H.A,{className:"mr-1"})," Mensagem de voz"]});case"document":return(0,s.jsxs)("p",{children:[(0,s.jsx)(V.A,{className:"mr-1"})," Documento"]});default:return(0,s.jsxs)("p",{children:[(0,s.jsx)(B.A,{className:"mr-1"})," Arquivo"]})}}var K=l(42663);function Q(e){let{name:t,color:l}=e;return(0,s.jsx)("div",{className:"box-border w-max rounded-sm px-1 py-0.5 text-xs text-slate-200",style:{backgroundColor:l},children:t})}var X=l(56204);function Y(e){let{name:t,avatar:l,message:a,messageDate:n,tags:r,isUnread:i,isOpen:d,onClick:c}=e,{user:u}=(0,o.useContext)(D.c),{users:m}=(0,o.useContext)(G.xI),{contacts:x}=(0,o.useContext)(X.Jj),h=(0,o.useMemo)(()=>{if(!n)return"Nunca";let e=new Date;return n.toDateString()===e.toDateString()?n.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}):n.toLocaleDateString("pt-BR",{year:"numeric",month:"2-digit",day:"2-digit"})},[n]),p=(0,o.useRef)(null);return(0,o.useEffect)(()=>{let e=p.current;if(!e)return;let t=()=>{if(console.log("For\xe7ando execu\xe7\xe3o do onClick"),"function"==typeof c)try{c()}catch(e){console.error("Error executing onClick handler:",e)}};return e.addEventListener("click",t),e.addEventListener("touchend",t),()=>{e.removeEventListener("click",t),e.removeEventListener("touchend",t)}},[c]),(0,s.jsx)("li",{"aria-busy":!!i,"aria-selected":!!d,className:"group relative chat-list-item",children:(0,s.jsxs)("div",{ref:p,className:"grid grid-cols-[74px_1fr] rounded-md p-3 hover:bg-indigo-500 hover:bg-opacity-20 aria-selected:bg-white/10 w-full h-full active:bg-indigo-500 active:bg-opacity-30 touch-manipulation cursor-pointer select-none chat-item-clickable",onClick:e=>{e.preventDefault(),e.stopPropagation(),console.log("Chat item click detected (mouse)");let t=e.currentTarget;if(t.style.backgroundColor="rgba(99, 102, 241, 0.2)",setTimeout(()=>{t.style.backgroundColor=""},150),"function"==typeof c){console.log("Executing onClick handler from click");try{c()}catch(e){console.error("Error executing onClick handler:",e)}}else console.warn("No valid onClick handler provided:",c)},onTouchStart:e=>{console.log("Chat item touch start detected");let t=e.currentTarget;t.style.backgroundColor="rgba(99, 102, 241, 0.2)",t.style.transform="scale(0.98)"},onTouchMove:e=>{e.preventDefault(),e.stopPropagation()},onTouchEnd:e=>{console.log("Chat item touch end detected");let t=e.currentTarget;if(t.style.backgroundColor="",t.style.transform="","function"==typeof c){console.log("Executing onClick handler from touch");try{c()}catch(e){console.error("Error executing onClick handler:",e)}}else console.warn("No valid onClick handler provided:",c)},role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),"function"==typeof c&&c())},style:{WebkitTapHighlightColor:"transparent",WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none",touchAction:"manipulation",transition:"all 0.15s ease",position:"relative",zIndex:10,pointerEvents:"auto"},"data-testid":"chat-menu-item","data-clickable":"true",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)(K.A,{alt:t,src:l||"",sx:{width:64,height:64}})}),(0,s.jsxs)("div",{className:"flex flex-col gap-1 truncate",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("p",{className:"truncate text-sm leading-none text-gray-900 dark:text-slate-100",children:t}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-gray-700 dark:text-slate-300 group-aria-busy:text-orange-200",children:[(0,s.jsx)("p",{className:"text-xs",children:h}),i&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"h-3 w-3 rounded-full bg-red-600"}),"string"==typeof a&&function(e){if(!e||"string"!=typeof e)return!1;let t=e.match(/@(\d{6,})/g);if(!t)return!1;let l=t.map(e=>e.replace("@","")),s=new Set;(null==u?void 0:u.WHATSAPP)&&s.add(u.WHATSAPP.replace(/\D/g,""));let a=m.find(e=>e.CODIGO===(null==u?void 0:u.CODIGO));for(let e of((null==a?void 0:a.WHATSAPP)&&s.add(a.WHATSAPP.replace(/\D/g,"")),x))e.id===(null==u?void 0:u.CODIGO)&&e.phone&&s.add(e.phone.replace(/\D/g,""));return l.some(e=>s.has(e))}(a)&&(0,s.jsx)("span",{className:"text-xs font-bold text-indigo-600 leading-none",children:"@"})]})]})]}),(0,s.jsx)("div",{className:"truncate text-sm text-gray-700 dark:text-slate-300 font-emoji",children:a}),(0,s.jsx)("div",{className:"flex items-center justify-end gap-1",children:null==r?void 0:r.map(e=>(0,s.jsx)(Q,{name:e.name,color:e.color},e.name))})]})]})})}var $=l(25232);let ee=(e,t)=>{var l,s,a,n,r,i,o,d,c,u,m;if("wpp"===e.chatType){let m=t.replace(/\D/g,""),x=null===(s=e.customer)||void 0===s?void 0:null===(l=s.CPF_CNPJ)||void 0===l?void 0:l.includes(t),h=null===(n=e.customer)||void 0===n?void 0:null===(a=n.RAZAO)||void 0===a?void 0:a.toLowerCase().includes(t.toLowerCase()),p=(null===(r=e.customer)||void 0===r?void 0:r.COD_ERP)===t,f=(null===(o=e.customer)||void 0===o?void 0:null===(i=o.CODIGO)||void 0===i?void 0:i.toString())===t,g=null===(c=e.contact)||void 0===c?void 0:null===(d=c.name)||void 0===d?void 0:d.toLowerCase().includes(t.toLowerCase()),v=m&&(null===(u=e.contact)||void 0===u?void 0:u.phone)&&e.contact.phone.includes(m);return x||h||p||f||g||v}if("internal"===e.chatType){let l=e.users.some(e=>e.NOME.toLowerCase().includes(t.toLowerCase())),s=null==e?void 0:null===(m=e.groupName)||void 0===m?void 0:m.toLowerCase().includes(t.toLowerCase());return l||s}return!1};function et(){let{user:e}=(0,o.useContext)(D.c),{chats:t,openChat:l,currentChat:a,chatFilters:n}=(0,o.useContext)(N.ce),{internalChats:r,openInternalChat:i,users:d}=(0,o.useContext)(G.xI),{contacts:c}=(0,o.useContext)(X.Jj),u=(0,o.useMemo)(()=>{var e,t;let l=new Map;for(let t of d){let s=null===(e=t.WHATSAPP)||void 0===e?void 0:e.replace(/\D/g,"");s&&l.set(s,t.NOME)}for(let e of c){let s=null===(t=e.phone)||void 0===t?void 0:t.replace(/\D/g,"");s&&!l.has(s)&&l.set(s,e.name)}return l},[d,c]),m=e=>e.replace(/@(\d{6,})/g,(e,t)=>{let l=u.get(t);return l?"@".concat(l):e}),x=(0,o.useMemo)(()=>[...Array.isArray(t)?t:[],...Array.isArray(r)?r:[]].filter(e=>"scheduled"!==n.showingType&&("internal"!==n.showingType||"internal"===e.chatType)&&("unread"!==n.showingType||!!e.isUnread)&&(0===n.search.length||ee(e,n.search))),[t,r,n]),h=(0,o.useMemo)(()=>x.sort((e,t)=>{let l=e.lastMessage?Number(e.lastMessage.timestamp):0;return(t.lastMessage?Number(t.lastMessage.timestamp):0)-l}),[x]);return(0,s.jsx)("menu",{className:"flex flex-col gap-2 scrollbar-whatsapp bg-slate-300/5 dark:bg-slate-800/50 p-3",children:h.map(t=>{var n,r;if("internal"===t.chatType){let l;let n=t.isGroup?t.groupName:t.users.map(e=>e.NOME).join(" e "),r=t.isGroup?"Grupo Interno":"Chat Interno",o=t.isGroup?"green":"blue";if(t.isGroup&&t.groupImageFileId&&(l=$.A.getFileDownloadUrl(t.groupImageFileId)),!t.isGroup){let s=t.users.find(t=>t.CODIGO!==(null==e?void 0:e.CODIGO));l=(null==s?void 0:s.AVATAR_ID)&&$.A.getFileDownloadUrl(s.AVATAR_ID)||void 0}return(0,s.jsx)(Y,{isUnread:t.isUnread,isOpen:(null==a?void 0:a.id)===t.id&&(null==a?void 0:a.chatType)==="internal",name:n,message:t.lastMessage?"chat"!==t.lastMessage.type?Z(t.lastMessage.type):m(t.lastMessage.body):"Nenhuma mensagem",messageDate:t.lastMessage?new Date(+t.lastMessage.timestamp):null,tags:[{color:o,name:r}],onClick:()=>i(t),avatar:l},"internal-chat:".concat(t.id))}return(0,s.jsx)(Y,{isUnread:t.isUnread,isOpen:(null==a?void 0:a.id)===t.id&&(null==a?void 0:a.chatType)==="wpp",name:(null===(n=t.contact)||void 0===n?void 0:n.name)||"Contato exclu\xeddo",avatar:null!==(r=t.avatarUrl)&&void 0!==r?r:void 0,message:t.lastMessage?"chat"!==t.lastMessage.type?Z(t.lastMessage.type):t.lastMessage.body:"Nenhuma mensagem",messageDate:t.lastMessage?new Date(+t.lastMessage.timestamp):null,tags:[],onClick:()=>l(t)},"chat:".concat(t.id))})})}function el(){return(0,s.jsxs)("aside",{className:"flex flex-col h-full rounded-md bg-slate-200 text-black shadow-md dark:bg-slate-800 dark:text-slate-300",children:[(0,s.jsx)(_,{}),(0,s.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto",children:(0,s.jsx)(et,{})})]})}function es(){var e,t,l,a,n;let{currentChat:r,setCurrentChat:d}=(0,o.useContext)(N.ce),{user:c,instance:u}=(0,o.useContext)(D.c);return o.useEffect(()=>{if(r){console.log("currentChat",r),window.history.pushState({chatOpen:!0},"");let e=()=>{d(null)};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)}},[r,d]),(0,s.jsx)(i.A,{children:(0,s.jsxs)("div",{className:"md:p-2 box-border h-auto md:h-full w-full overflow-auto md:overflow-hidden grid grid-rows-1 md:gap-2 ".concat(r?"chat-open":""," grid-cols-1 md:grid-cols-[24rem_1fr]"),children:[(0,s.jsxs)("div",{className:"chats-menu ".concat(r?"hidden":"block"," md:block"),children:[" ",(0,s.jsx)(el,{})," "]}),(0,s.jsxs)("div",{className:"chat-panel-container w-full h-full flex flex-col overflow-hidden flex-1",children:[!1,(null==r?void 0:r.chatType)==="internal"&&(0,s.jsx)(f,{name:r.groupName||(null===(e=r.users.find(e=>e.CODIGO!==(null==c?void 0:c.CODIGO)))||void 0===e?void 0:e.NOME)||(null==c?void 0:c.NOME)||"Grupo exclu\xeddo",phone:null,avatarUrl:(()=>{let e;if(r.isGroup&&r.groupImageFileId&&(e=$.A.getFileDownloadUrl(r.groupImageFileId)),!r.isGroup){let t=r.users.find(e=>e.CODIGO!==(null==c?void 0:c.CODIGO));e=(null==t?void 0:t.AVATAR_ID)&&$.A.getFileDownloadUrl(t.AVATAR_ID)||void 0}return e})(),customerName:u[0].toUpperCase()+u.slice(1),chatType:"internal",codErp:null,cpfCnpj:null,customerId:null,startDate:r.startedAt?new Date(r.startedAt).toDateString():null}),(null==r?void 0:r.chatType)==="wpp"&&(0,s.jsx)(f,{name:r.contact.name||"Contao exclu\xeddo",phone:r.contact.phone,avatarUrl:r.avatarUrl,customerName:(null==r?void 0:null===(t=r.customer)||void 0===t?void 0:t.RAZAO)||null,chatType:null==r?void 0:r.chatType,codErp:(null==r?void 0:null===(l=r.customer)||void 0===l?void 0:l.COD_ERP)||null,cpfCnpj:(null==r?void 0:null===(a=r.customer)||void 0===a?void 0:a.CPF_CNPJ)||null,customerId:(null==r?void 0:null===(n=r.customer)||void 0===n?void 0:n.CODIGO)||null,startDate:new Date(null==r?void 0:r.startedAt).toDateString()||null})]})]})})}},71395:(e,t,l)=>{Promise.resolve().then(l.bind(l,28118))}},e=>{var t=t=>e(e.s=t);e.O(0,[2666,4488,9141,8534,1620,6805,4954,35,3729,4805,9952,6302,5244,8702,931,9595,8441,1684,7358],()=>t(71395)),_N_E=e.O()}]);