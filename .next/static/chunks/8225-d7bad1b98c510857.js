"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8225],{25232:(e,l,a)=>{a.d(l,{A:()=>t});let t=new(a(54607)).FilesClient("https://inpulse.infotecrs.inf.br")},52671:(e,l,a)=>{a.d(l,{A:()=>s});var t=a(57515),r=a(95155);let s=(0,t.A)((0,r.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image")},68225:(e,l,a)=>{a.d(l,{A:()=>I,default:()=>O});var t=a(95155),r=a(98892),s=a(54607),i=a(42732),n=a(12115),u=a(38543),o=a(27088),c=a(54492),d=a(68534),f=a(69242),h=a(73731),x=a(76380),A=a(52671);function m(e){let{onChange:l,initialImage:a}=e,[r,s]=(0,n.useState)(a||null),i=(0,n.useRef)(null);return(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{className:"borde h-32 w-32 overflow-hidden rounded-md border border-white/20 hover:border-white hover:bg-indigo-500/10",onClick:()=>{i.current&&i.current.click()},children:r?(0,t.jsx)("img",{src:r,alt:"Preview",className:"h-full w-full rounded-md border border-slate-600 object-cover"}):(0,t.jsx)(A.A,{fontSize:"large"})}),(0,t.jsx)("input",{type:"file",accept:"image/*",hidden:!0,onChange:e=>{var a;let t=(null===(a=e.target.files)||void 0===a?void 0:a[0])||null;if(l&&l(t),t){let e=new FileReader;e.onload=e=>{var l;return s(null===(l=e.target)||void 0===l?void 0:l.result)},e.readAsDataURL(t);return}s(null)},ref:i})]})}function p(e){let{formData:l,onFormChange:a,initialImage:r,onAvatarChange:s}=e,{sectors:i}=(0,n.useContext)(I);return(0,t.jsxs)("div",{className:"flex w-full flex-col gap-4 bg-white dark:bg-slate-800 text-black dark:text-white",children:[(0,t.jsxs)("div",{className:"flex w-full flex-row justify-center gap-4",children:[(0,t.jsx)(m,{initialImage:r,onChange:s}),(0,t.jsxs)("div",{className:"flex flex-grow flex-col gap-4",children:[(0,t.jsx)(h.A,{label:"Nome",name:"NOME",id:"NOME",type:"text",fullWidth:!0,required:!0,value:l.NOME,onChange:e=>a({NOME:e.target.value})}),(0,t.jsx)(h.A,{label:"Login",name:"LOGIN",id:"LOGIN",type:"text",fullWidth:!0,required:!0,value:l.LOGIN,onChange:e=>a({LOGIN:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"flex w-full flex-row justify-center gap-4",children:[(0,t.jsx)(h.A,{label:"Email",name:"EMAIL",id:"EMAIL",type:"email",fullWidth:!0,size:"small",value:l.EMAIL||"",onChange:e=>a({EMAIL:e.target.value})}),(0,t.jsx)(h.A,{label:"Senha",name:"SENHA",id:"SENHA",type:"password",fullWidth:!0,size:"small",required:!0,value:l.SENHA,onChange:e=>a({SENHA:e.target.value})})]}),(0,t.jsxs)("div",{className:"flex w-full flex-row justify-center gap-4",children:[(0,t.jsx)(h.A,{label:"Setor",name:"SETOR",id:"SETOR",select:!0,fullWidth:!0,size:"small",required:!0,value:l.SETOR||"",onChange:e=>a({SETOR:Number(e.target.value)}),children:null==i?void 0:i.map(e=>(0,t.jsx)(x.A,{value:e.id,children:e.name},e.id))}),(0,t.jsxs)(h.A,{label:"N\xedvel",name:"NIVEL",select:!0,fullWidth:!0,size:"small",required:!0,defaultValue:"",value:l.NIVEL,onChange:e=>a({NIVEL:e.target.value}),children:[(0,t.jsx)(x.A,{value:"ADMIN",children:"Supervisor"},"ADMIN"),(0,t.jsx)(x.A,{value:"ATIVO",children:"Usu\xe1rio (Ativo)"},"ATIVO"),(0,t.jsx)(x.A,{value:"RECEP",children:"Usu\xe1rio (Recep)"},"RECEP"),(0,t.jsx)(x.A,{value:"AMBOS",children:"Usu\xe1rio (Ambos)"},"AMBOS")]})]}),(0,t.jsxs)("div",{className:"flex w-full flex-row justify-center gap-4",children:[(0,t.jsx)(h.A,{label:"C\xf3digo ERP",name:"CODIGO_ERP",type:"text",fullWidth:!0,size:"small",value:l.CODIGO_ERP||"",onChange:e=>a({CODIGO_ERP:e.target.value})}),(0,t.jsx)(h.A,{label:"Whatsapp",name:"WHATSAPP",id:"WHATSAPP",fullWidth:!0,size:"small",value:l.WHATSAPP||"",onChange:e=>a({WHATSAPP:e.target.value})})]})]})}var v=a(75955),g=a(56278),b=a(3127),C=a(49994);let j=(0,v.Ay)(g.A)(e=>{let{theme:l}=e;return{"& .MuiPaper-root":{borderRadius:"10px",overflow:"hidden",backgroundColor:l.palette.background.paper,color:l.palette.text.primary}}});(0,v.Ay)(c.A)(e=>{let{theme:l}=e;return{display:"flex",color:l.palette.text.primary,backgroundColor:l.palette.background.default}});let N=(0,v.Ay)(b.A)(e=>{let{theme:l}=e;return{fontSize:18,color:"dark"===l.palette.mode?l.palette.primary.main:l.palette.primary.light}});(0,v.Ay)(C.A)(e=>{let{theme:l}=e;return{"& .MuiTabs-flexContainer":{justifyContent:"center",gap:2},"& .MuiTab-root":{flex:"1 0 0",color:l.palette.text.primary}}});var E=a(25232),w=a(49641).Buffer;function y(e){let{user:l}=e,{instance:a}=(0,r.Z)(),{closeModal:i,createUser:u,updateUser:h,modal:x}=(0,n.useContext)(I),[A,m]=(0,n.useState)({NOME:l?l.NOME:"",LOGIN:l?l.LOGIN:"",EMAIL:l?l.EMAIL||"":void 0,WHATSAPP:l?l.WHATSAPP||"":void 0,SENHA:l?l.SENHA:"",SETOR:l?l.SETOR:null,NIVEL:l?l.NIVEL:"",CODIGO_ERP:l?l.CODIGO_ERP:null,AVATAR_ID:l?l.AVATAR_ID:null}),[v,g]=(0,n.useState)(null),b=!!l,C=(null==l?void 0:l.AVATAR_ID)?E.A.getFileDownloadUrl(l.AVATAR_ID):null;async function y(){let e=null;if(v){let l=await v.arrayBuffer(),t=w.from(l);e=(await E.A.uploadFile({buffer:t,fileName:v.name,dirType:s.FileDirType.PUBLIC,instance:a,mimeType:v.type})).id}b?h(l.CODIGO,{...A,AVATAR_ID:e}):u({...A,AVATAR_ID:e})}return(0,t.jsx)(j,{onClose:(e,l)=>{"backdropClick"!==l&&i()},open:!!x,fullWidth:!0,maxWidth:"md",children:(0,t.jsx)("div",{className:"max-h-[85vh] ",children:(0,t.jsx)(o.A,{className:"h-full w-full",children:(0,t.jsxs)("div",{className:"flex h-full w-full flex-col gap-3 bg-white dark:bg-slate-800 p-4",children:[(0,t.jsx)("div",{className:"sticky top-0 z-30",children:(0,t.jsxs)("div",{className:"flex w-full items-center justify-between ",children:[(0,t.jsx)(c.A,{sx:{paddingX:"8px",paddingY:"4px"},children:b?"Editar Usu\xe1rio":"Cadastrar Usu\xe1rio"}),(0,t.jsx)(N,{"aria-label":"close",onClick:i,children:(0,t.jsx)(f.A,{})})]})}),(0,t.jsx)("div",{className:"flex-1 scrollbar-whatsapp py-2",children:(0,t.jsx)(p,{formData:A,initialImage:C,onFormChange:e=>{m(l=>({...l,...e}))},onAvatarChange:e=>{console.log("avatar",e),g(e)}})}),(0,t.jsxs)("div",{className:"sticky bottom-0 flex w-full flex-row items-center justify-end gap-4 border-t-[2px] border-blue-500 pt-[1rem]",children:[(0,t.jsx)(d.A,{color:"error",onClick:i,children:"Cancelar"}),(0,t.jsx)(d.A,{onClick:y,children:b?"Salvar":"Cadastrar"})]})]})})})})}var S=a(88702);let I=(0,n.createContext)({});function O(e){let{children:l}=e,{wppApi:a}=(0,n.useContext)(S.ce),{token:o}=(0,n.useContext)(r.c),[c,d]=(0,n.useState)([]),[f,h]=(0,n.useState)(null),[x,A]=(0,n.useState)(!0),[m,p]=(0,n.useState)("CODIGO"),[v,g]=(0,n.useState)("asc"),[b,C]=(0,n.useState)([]),j=(0,n.useRef)(new s.UsersClient("https://inpulse.infotecrs.inf.br")),N=(0,n.useMemo)(()=>[...c].sort((e,l)=>{let a=e[m],t=l[m];return a===t?0:null==a?1:null==t?-1:"string"==typeof a&&"string"==typeof t?"asc"===v?a.localeCompare(t):t.localeCompare(a):"asc"===v?Number(a)-Number(t):Number(t)-Number(a)}),[c,v,m]),E=(0,n.useCallback)(async e=>{try{let l=await j.current.createUser(e);d(e=>[...e,l]),k(),u.oR.success("Usu\xe1rio criado com sucesso!"),R()}catch(e){u.oR.error("Falha ao criar usu\xe1rio.\n".concat((0,i.sanitizeErrorMessage)(e)))}},[]),w=(0,n.useCallback)(async(e,l)=>{try{await j.current.updateUser(String(e),l),k(),u.oR.success("Usu\xe1rio atualizado com sucesso!"),R()}catch(e){u.oR.error("Falha ao atualizar usu\xe1rio.\n".concat((0,i.sanitizeErrorMessage)(e)))}},[]),O=(0,n.useCallback)(e=>{h((0,t.jsx)(y,{user:e}))},[E,w]),R=(0,n.useCallback)(()=>{h(null)},[]),k=(0,n.useCallback)(()=>{o&&(j.current.setAuth(o),A(!0),j.current.getUsers().then(e=>{d(e.data),A(!1)}).catch(()=>A(!1)))},[]);return(0,n.useEffect)(()=>{o&&(j.current.setAuth(o),A(!0),k())},[o]),(0,n.useEffect)(()=>{a.current&&o&&(a.current.setAuth(o),a.current.getSectors().then(e=>{C(e)}))},[a,o]),(0,t.jsxs)(I.Provider,{value:{users:c,modal:f,loading:x,order:v,orderBy:m,sortedUsers:N,sectors:b,handleSort:e=>{g(m===e&&"asc"===v?"desc":"asc"),p(e)},createUser:E,updateUser:w,openUserModal:O,closeModal:R,loadUsers:k},children:[l,f]})}}}]);